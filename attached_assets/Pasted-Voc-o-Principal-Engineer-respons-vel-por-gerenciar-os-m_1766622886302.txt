VocÃª Ã© o Principal Engineer responsÃ¡vel por gerenciar os modelos de geraÃ§Ã£o de imagens na VectraÂ AI. Foi solicitado ajustar o plano Free para usar **NanoÂ BananaÂ Pro** (nÃ£o a LoRA v1) como modelo de alta qualidade, com um limite de 5 geraÃ§Ãµes. Depois disso, o Free terÃ¡ direito a mais 5 geraÃ§Ãµes utilizando **Realistic VisionÂ 5.1**. O plano Pro permanecerÃ¡ com uso ilimitado do NanoÂ BananaÂ Pro. TambÃ©m devemos notificar o usuÃ¡rio quando o modelo mudar, por meio de um popâ€‘up. A pÃ¡gina de documentaÃ§Ã£o do NanoÂ BananaÂ Pro (Image Edit) confirma que o `model_id` Ã© `nano-banana-pro` e que o modelo oferece geraÃ§Ã£o de imagem de ultraâ€‘alta qualidade:contentReference[oaicite:0]{index=0}:contentReference[oaicite:1]{index=1}.

### ğŸ¯ Objetivo
Implementar quotas distintas no plano Free (5 HQ + 5 Standard) com roteamento automÃ¡tico de modelo, aplicar o modelo NanoÂ BananaÂ Pro para HQ, RealisticÂ VisionÂ 5.1 para Standard, e criar um popâ€‘up informativo quando a quota HQ expirar.

### ğŸ§© Tarefas tÃ©cnicas

1. **AtualizaÃ§Ã£o das quotas e controladores**  
   - Definir dois contadores para o plano Free:  
     - `hq_images_used`: mÃ¡ximo 5 por dia.  
     - `standard_images_used`: mÃ¡ximo 5 adicionais.  
   - Para planos Pro e Enterprise, `hq_images_used` Ã© ilimitado; `standard_images_used` nÃ£o se aplica.  
   - Persistir esses valores no banco (tabela `usage_logs` ou `profiles_usage`) e resetar diariamente (timezone: America/Sao_Paulo).

2. **Roteamento de modelo no backend**  
   - No endpoint `/api/generate` (geraÃ§Ã£o de imagem):  
     - Se `hq_images_used < 5` â†’ atribuir:
       ```json
       { 
         "model_id": "nano-banana-pro",
         "lora_model": null
       }
       ```
       (usar o endpoint `/api/v7/images/image-to-image` com `model_id` `nano-banana-pro`, conforme documentaÃ§Ã£o:contentReference[oaicite:2]{index=2}; se necessÃ¡rio, adaptar payload para aceitar `prompt` sem `init_image` ou usar o endpoint de text-to-image equivalente).  
       - Ajustar parÃ¢metros HQ: `steps = 40`, `guidance_scale = 8.0`.  
     - Caso contrÃ¡rio, se `standard_images_used < 5` â†’ atribuir:
       ```json
       {
         "model_id": "realistic-vision-51"
       }
       ```
       - ParÃ¢metros Standard: `steps = 30`, `guidance_scale = 7.5`.  
     - Caso ambos limites tenham sido alcanÃ§ados â†’ retornar erro 402 informando que o limite do plano Free foi atingido e sugerir upgrade.  
   - Registrar `imageQuality` como `"hq"` ou `"standard"` e persistir em `metadata`.  
   - Incrementar os contadores no banco apÃ³s cada geraÃ§Ã£o bem-sucedida.

3. **NotificaÃ§Ã£o e popâ€‘up no Frontâ€‘End**  
   - Adicionar um componente de `Modal` ou `Dialog` que exibe mensagem quando `hq_images_used` atinge 5:  
     - TÃ­tulo: â€œLimite de Imagens HQ Utilizadoâ€  
     - Corpo: â€œVocÃª utilizou suas 5 imagens de alta qualidade (Nano BananaÂ Pro). As prÃ³ximas 5 geraÃ§Ãµes gratuitas usarÃ£o o modelo RealisticÂ VisionÂ 5.1.â€  
     - BotÃµes: â€œOKâ€ e â€œUpgrade para Pro (ilimitado)â€  
   - Exibir esse modal automaticamente ao tentar gerar a 6Âª imagem HQ ou imediatamente quando o backend retornar que a quota HQ expirou.  
   - Desabilitar o popâ€‘up apÃ³s o usuÃ¡rio aceitar; nÃ£o mostrar mais atÃ© nova renovaÃ§Ã£o de quota (diÃ¡ria).

4. **AtualizaÃ§Ã£o de UI e mÃ©tricas**  
   - Mostrar no painel de â€œLIMITES DIÃRIOSâ€ dois contadores:  
     - â€œImagens HQ (NanoÂ BananaÂ Pro): {hq_used}/5â€  
     - â€œImagens Standard (RealisticÂ VisionÂ 5.1): {standard_used}/5â€  
   - Atualizar esses valores em tempo real apÃ³s cada geraÃ§Ã£o.  
   - Quando o usuÃ¡rio estiver no plano Pro, mostrar apenas â€œImagens HQ: Ilimitadasâ€ e ocultar o contador Standard.

5. **CritÃ©rios de aceitaÃ§Ã£o**  
   - UsuÃ¡rio Free gera no mÃ¡ximo 10 imagens por dia: as primeiras 5 com NanoÂ BananaÂ Pro, as 5 seguintes com RealisticÂ VisionÂ 5.1.  
   - UsuÃ¡rio Pro gera imagens ilimitadas com NanoÂ BananaÂ Pro.  
   - Popâ€‘up Ã© exibido exatamente uma vez quando a quota HQ Ã© atingida.  
   - O plano Free nÃ£o sofre regressÃµes em outras quotas (promptagens, vÃ­deos, LoRAs).  
   - Logs de geraÃ§Ã£o registram `model_id` e `imageQuality` para auditoria.

Implemente essas alteraÃ§Ãµes, ajuste a camada de serviÃ§o (generations), crie o popâ€‘up no front-end, atualize a UI de quotas e o modelo de dados, e realize testes unitÃ¡rios e de integraÃ§Ã£o para garantir que tudo funcione de ponta a ponta.

{"file_contents":{"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"server/lora-routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { storage } from \"./storage\";\nimport { storageProvider } from \"./lib/storage-provider\";\nimport { verifySignature, createJobPayload } from \"./lib/hmac\";\nimport { loraJobRateLimiter, webhookRateLimiter, datasetUploadRateLimiter } from \"./lib/rate-limiter\";\nimport {\n  createLoraModelRequestSchema,\n  initDatasetRequestSchema,\n  commitDatasetRequestSchema,\n  validateDatasetRequestSchema,\n  createLoraJobRequestSchema,\n  webhookPayloadSchema,\n  activateLoraRequestSchema,\n} from \"@shared/schema\";\nimport { ZodError } from \"zod\";\nimport { createHash } from \"crypto\";\n\nconst WORKER_URL = process.env.WORKER_URL || \"\";\nconst IS_PRO_OVERRIDE = process.env.ADMIN_OVERRIDE === \"true\" || process.env.PLAN_PRO_OVERRIDE === \"true\";\nconst FREE_LORA_JOBS = 0;\nconst PRO_LORA_JOBS = 10;\n\nfunction getUserId(req: Request): string {\n  // In development mode, use a fixed user ID for consistent experience\n  const isDev = process.env.NODE_ENV === \"development\";\n  if (isDev) {\n    return \"dev_user\";\n  }\n  return req.ip || \"anonymous\";\n}\n\nasync function checkLoraPermission(req: Request, res: Response, next: NextFunction) {\n  if (IS_PRO_OVERRIDE) {\n    return next();\n  }\n  \n  return res.status(403).json({\n    error: \"LoRA training requires a Pro subscription\",\n    isPremiumRequired: true,\n  });\n}\n\nexport function registerLoraRoutes(app: Express) {\n  app.get(\"/api/lora/models\", async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const models = await storage.getLoraModels(userId);\n      res.json(models);\n    } catch (error) {\n      console.error(\"Error fetching LoRA models:\", error);\n      res.status(500).json({ error: \"Failed to fetch LoRA models\" });\n    }\n  });\n\n  // Get all trained LoRA versions for use in prompt generation\n  app.get(\"/api/lora/trained\", async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const models = await storage.getLoraModels(userId);\n      \n      const trainedLoras = await Promise.all(\n        models.map(async (model) => {\n          const versions = await storage.getLoraVersions(model.id);\n          const trainedVersions = versions.filter(v => v.artifactUrl);\n          if (trainedVersions.length === 0) return null;\n          \n          return {\n            model,\n            versions: trainedVersions,\n          };\n        })\n      );\n      \n      res.json(trainedLoras.filter(Boolean));\n    } catch (error) {\n      console.error(\"Error fetching trained LoRAs:\", error);\n      res.status(500).json({ error: \"Failed to fetch trained LoRAs\" });\n    }\n  });\n\n  app.get(\"/api/lora/models/:id\", async (req, res) => {\n    try {\n      const model = await storage.getLoraModel(req.params.id);\n      if (!model) {\n        return res.status(404).json({ error: \"LoRA model not found\" });\n      }\n      \n      const datasets = await storage.getLoraDatasets(model.id);\n      const versions = await storage.getLoraVersions(model.id);\n      \n      res.json({ ...model, datasets, versions });\n    } catch (error) {\n      console.error(\"Error fetching LoRA model:\", error);\n      res.status(500).json({ error: \"Failed to fetch LoRA model\" });\n    }\n  });\n\n  app.post(\"/api/lora/models\", checkLoraPermission, async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const validated = createLoraModelRequestSchema.parse(req.body);\n      \n      const model = await storage.createLoraModel({\n        userId,\n        name: validated.name,\n        description: validated.description || null,\n        consentGiven: validated.consent ? 1 : 0,\n      });\n      \n      res.status(201).json(model);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error creating LoRA model:\", error);\n      res.status(500).json({ error: \"Failed to create LoRA model\" });\n    }\n  });\n\n  app.post(\"/api/lora/dataset/init\", checkLoraPermission, datasetUploadRateLimiter(), async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const validated = initDatasetRequestSchema.parse(req.body);\n      \n      const model = await storage.getLoraModel(validated.loraModelId);\n      if (!model) {\n        return res.status(404).json({ error: \"LoRA model not found\" });\n      }\n      \n      if (model.userId !== userId) {\n        return res.status(403).json({ error: \"Unauthorized\" });\n      }\n      \n      const dataset = await storage.createLoraDataset({\n        userId,\n        loraModelId: validated.loraModelId,\n        imageCount: validated.imageCount,\n        status: \"pending\",\n      });\n      \n      const uploadUrls: Array<{ filename: string; uploadUrl: string; storageKey: string }> = [];\n      \n      for (const filename of validated.filenames) {\n        const sanitizedFilename = filename.replace(/[^a-zA-Z0-9._-]/g, '_');\n        const storageKey = `datasets/${userId}/${dataset.id}/${Date.now()}_${sanitizedFilename}`;\n        const { uploadUrl } = await storageProvider.getPresignedUploadUrl(storageKey);\n        uploadUrls.push({ filename, uploadUrl, storageKey });\n      }\n      \n      res.status(201).json({\n        datasetId: dataset.id,\n        uploadUrls,\n      });\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error initializing dataset:\", error);\n      res.status(500).json({ error: \"Failed to initialize dataset\" });\n    }\n  });\n\n  app.post(\"/api/lora/dataset/commit\", checkLoraPermission, async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const validated = commitDatasetRequestSchema.parse(req.body);\n      \n      const dataset = await storage.getLoraDataset(validated.datasetId);\n      if (!dataset) {\n        return res.status(404).json({ error: \"Dataset not found\" });\n      }\n      \n      if (dataset.userId !== userId) {\n        return res.status(403).json({ error: \"Unauthorized\" });\n      }\n      \n      if (dataset.status !== \"pending\") {\n        return res.status(400).json({ error: \"Dataset already committed\" });\n      }\n      \n      const items = validated.items.map(item => ({\n        datasetId: validated.datasetId,\n        storageKey: item.storageKey,\n        sha256: item.sha256,\n        width: item.width,\n        height: item.height,\n        filename: item.filename,\n      }));\n      \n      await storage.createDatasetItems(items);\n      \n      await storage.updateLoraDataset(validated.datasetId, {\n        imageCount: items.length,\n        status: \"uploaded\",\n      });\n      \n      res.json({ \n        success: true, \n        datasetId: validated.datasetId,\n        imageCount: items.length,\n      });\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error committing dataset:\", error);\n      res.status(500).json({ error: \"Failed to commit dataset\" });\n    }\n  });\n\n  app.post(\"/api/lora/dataset/validate\", checkLoraPermission, async (req, res) => {\n    try {\n      const validated = validateDatasetRequestSchema.parse(req.body);\n      \n      const dataset = await storage.getLoraDataset(validated.datasetId);\n      if (!dataset) {\n        return res.status(404).json({ error: \"Dataset not found\" });\n      }\n      \n      const qualityReport = {\n        valid: true,\n        imageCount: dataset.imageCount,\n        minResolution: { width: 512, height: 512 },\n        duplicatesFound: 0,\n        varietyScore: 80,\n        issues: [] as string[],\n        score: 85,\n      };\n      \n      if (dataset.imageCount < 10) {\n        qualityReport.valid = false;\n        qualityReport.issues.push(\"Minimum 10 images required\");\n        qualityReport.score -= 30;\n      }\n      \n      if (dataset.imageCount > 30) {\n        qualityReport.issues.push(\"More than 30 images may slow training\");\n        qualityReport.score -= 5;\n      }\n      \n      const datasetHash = createHash(\"sha256\")\n        .update(`${dataset.id}-${dataset.imageCount}-${Date.now()}`)\n        .digest(\"hex\")\n        .substring(0, 16);\n      \n      await storage.updateLoraDataset(dataset.id, {\n        qualityReport,\n        datasetHash,\n        status: qualityReport.valid ? \"validated\" : \"invalid\",\n      });\n      \n      res.json({ datasetId: dataset.id, qualityReport, datasetHash });\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error validating dataset:\", error);\n      res.status(500).json({ error: \"Failed to validate dataset\" });\n    }\n  });\n\n  app.post(\"/api/lora/jobs\", checkLoraPermission, loraJobRateLimiter(), async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const validated = createLoraJobRequestSchema.parse(req.body);\n      \n      const model = await storage.getLoraModel(validated.loraModelId);\n      if (!model || model.userId !== userId) {\n        return res.status(404).json({ error: \"LoRA model not found\" });\n      }\n      \n      const dataset = await storage.getLoraDataset(validated.datasetId);\n      if (!dataset || dataset.status !== \"validated\") {\n        return res.status(400).json({ error: \"Dataset must be validated before training\" });\n      }\n      \n      if (!dataset.datasetHash) {\n        return res.status(400).json({ error: \"Dataset has no hash\" });\n      }\n      \n      const version = await storage.createLoraVersion({\n        loraModelId: validated.loraModelId,\n        baseModel: validated.baseModel,\n        params: validated.params,\n        datasetHash: dataset.datasetHash,\n      });\n      \n      const job = await storage.createLoraJob({\n        loraVersionId: version.id,\n        provider: \"webhook_worker\",\n        status: \"pending\",\n      });\n      \n      if (WORKER_URL) {\n        const callbackUrl = `${process.env.REPLIT_DEV_DOMAIN ? `https://${process.env.REPLIT_DEV_DOMAIN}` : \"http://localhost:5000\"}/api/lora/webhook`;\n        \n        const signedPayload = createJobPayload(\n          job.id,\n          dataset.datasetUrl || \"\",\n          validated.params,\n          callbackUrl\n        );\n        \n        try {\n          const response = await fetch(WORKER_URL, {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              \"X-Signature\": signedPayload.signature,\n              \"X-Timestamp\": String(signedPayload.timestamp),\n            },\n            body: JSON.stringify(signedPayload.payload),\n          });\n          \n          if (response.ok) {\n            const result = await response.json() as { externalJobId?: string };\n            await storage.updateLoraJob(job.id, {\n              status: \"processing\",\n              externalJobId: result.externalJobId || null,\n              startedAt: new Date(),\n            });\n          } else {\n            await storage.updateLoraJob(job.id, {\n              status: \"failed\",\n              error: \"Failed to start worker job\",\n            });\n          }\n        } catch (err) {\n          console.error(\"Worker request failed:\", err);\n          await storage.updateLoraJob(job.id, {\n            status: \"pending\",\n            error: \"Worker unavailable - job queued\",\n          });\n        }\n      } else {\n        // Development mode: Simulate training completion\n        const isDev = process.env.NODE_ENV === \"development\" || !WORKER_URL;\n        \n        if (isDev) {\n          // Start simulated training and complete immediately (dev mode)\n          await storage.updateLoraJob(job.id, {\n            status: \"processing\",\n            startedAt: new Date(),\n            error: null,\n          });\n          \n          // Simulate training completion immediately for better dev UX\n          const mockArtifactUrl = `simulated://lora/${version.id}/model.safetensors`;\n          \n          await storage.updateLoraJob(job.id, {\n            status: \"completed\",\n            finishedAt: new Date(),\n            error: null,\n          });\n          \n          await storage.updateLoraVersion(version.id, {\n            artifactUrl: mockArtifactUrl,\n            checksum: createHash(\"sha256\").update(version.id).digest(\"hex\"),\n            previewImages: [],\n          });\n          \n          console.log(`[LoRA] Simulated training completed for version ${version.id}`);\n        } else {\n          await storage.updateLoraJob(job.id, {\n            error: \"No worker configured - job in mock mode\",\n          });\n        }\n      }\n      \n      res.status(201).json({ job, version });\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error creating LoRA job:\", error);\n      res.status(500).json({ error: \"Failed to create LoRA job\" });\n    }\n  });\n\n  app.get(\"/api/lora/jobs/:id\", async (req, res) => {\n    try {\n      const job = await storage.getLoraJob(req.params.id);\n      if (!job) {\n        return res.status(404).json({ error: \"Job not found\" });\n      }\n      \n      const version = await storage.getLoraVersion(job.loraVersionId);\n      res.json({ job, version });\n    } catch (error) {\n      console.error(\"Error fetching LoRA job:\", error);\n      res.status(500).json({ error: \"Failed to fetch LoRA job\" });\n    }\n  });\n\n  app.post(\"/api/lora/webhook\", webhookRateLimiter(), async (req, res) => {\n    try {\n      const signature = req.headers[\"x-signature\"] as string;\n      const timestamp = parseInt(req.headers[\"x-timestamp\"] as string, 10);\n      \n      if (!signature || !timestamp) {\n        return res.status(401).json({ error: \"Missing authentication headers\" });\n      }\n      \n      const verification = verifySignature(signature, timestamp, req.body);\n      if (!verification.valid) {\n        return res.status(401).json({ error: verification.error });\n      }\n      \n      const validated = webhookPayloadSchema.parse(req.body);\n      \n      const job = await storage.getLoraJob(validated.jobId);\n      if (!job) {\n        return res.status(404).json({ error: \"Job not found\" });\n      }\n      \n      await storage.updateLoraJob(validated.jobId, {\n        status: validated.status,\n        logsUrl: validated.logsUrl || null,\n        error: validated.error || null,\n        finishedAt: validated.status === \"completed\" || validated.status === \"failed\" ? new Date() : null,\n      });\n      \n      if (validated.status === \"completed\" && validated.artifactUrl) {\n        await storage.updateLoraVersion(job.loraVersionId, {\n          artifactUrl: validated.artifactUrl,\n          checksum: validated.checksum || null,\n          previewImages: validated.previewImages || [],\n        });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid webhook payload\", details: error.errors });\n      }\n      console.error(\"Error processing webhook:\", error);\n      res.status(500).json({ error: \"Failed to process webhook\" });\n    }\n  });\n\n  app.post(\"/api/lora/activate\", checkLoraPermission, async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const validated = activateLoraRequestSchema.parse(req.body);\n      \n      const version = await storage.getLoraVersion(validated.loraVersionId);\n      if (!version) {\n        return res.status(404).json({ error: \"LoRA version not found\" });\n      }\n      \n      if (!version.artifactUrl) {\n        return res.status(400).json({ error: \"LoRA version has no trained artifact\" });\n      }\n      \n      const model = await storage.getLoraModel(version.loraModelId);\n      if (!model || model.userId !== userId) {\n        return res.status(403).json({ error: \"Unauthorized\" });\n      }\n      \n      const active = await storage.setUserActiveLora(\n        userId, \n        version.loraModelId, \n        validated.loraVersionId, \n        validated.weight,\n        validated.targetPlatform\n      );\n      \n      res.json(active);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error activating LoRA:\", error);\n      res.status(500).json({ error: \"Failed to activate LoRA\" });\n    }\n  });\n\n  app.get(\"/api/lora/active\", async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const active = await storage.getUserActiveLora(userId);\n      \n      if (!active) {\n        return res.json(null);\n      }\n      \n      const version = await storage.getLoraVersion(active.loraVersionId);\n      const model = version ? await storage.getLoraModel(version.loraModelId) : null;\n      \n      res.json({ ...active, version, model });\n    } catch (error) {\n      console.error(\"Error fetching active LoRA:\", error);\n      res.status(500).json({ error: \"Failed to fetch active LoRA\" });\n    }\n  });\n\n  app.delete(\"/api/lora/active\", checkLoraPermission, async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      await storage.clearUserActiveLora(userId);\n      res.json({ success: true, message: \"LoRA deactivated\" });\n    } catch (error) {\n      console.error(\"Error deactivating LoRA:\", error);\n      res.status(500).json({ error: \"Failed to deactivate LoRA\" });\n    }\n  });\n\n  app.get(\"/api/lora/base-models\", async (_req, res) => {\n    try {\n      const models = await storage.getBaseModels();\n      res.json(models);\n    } catch (error) {\n      console.error(\"Error fetching base models:\", error);\n      res.status(500).json({ error: \"Failed to fetch base models\" });\n    }\n  });\n}\n","path":null,"size_bytes":17746,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"server/prompt-engine/compiler.ts":{"content":"import { SYSTEM_PROMPT_CORE } from \"./system-prompt\";\nimport type { CompilerInput, CompilerOutput, BlockDefinition } from \"./types\";\nimport type { LlmProfile, PromptBlueprint, PromptBlock, Filter, LoraVersion } from \"@shared/schema\";\nimport { createHash } from \"crypto\";\n\nexport interface LoraContext {\n  version: LoraVersion;\n  weight: number;\n  triggerWord?: string;\n  modelName?: string;\n}\n\nexport interface CharacterPackOutput {\n  promptWithoutLora: string;\n  characterInstructions: string;\n  referenceImagesCount: number;\n  recommendedParams: {\n    aspectRatio: string;\n    duration?: number;\n    style?: string;\n  };\n  targetPlatform: string;\n}\n\nconst LORA_SUPPORTING_PROFILES = [\"flux\", \"sdxl\", \"stable_diffusion\", \"sd1.5\", \"sd_1.5\"];\nconst TARGET_PLATFORM_PROFILES = [\"sora\", \"veo\", \"grok\", \"higgsfield\", \"midjourney\", \"dall-e\", \"dalle\", \"runway\", \"pika\", \"kling\", \"luma\"];\n\nconst CHARACTER_PACK_PLATFORMS: Record<string, {\n  instructions: string;\n  aspectRatio: string;\n  duration?: number;\n  style?: string;\n  supportsImageUpload: boolean;\n}> = {\n  higgsfield: {\n    instructions: `For Higgsfield/Nano Banana: Upload reference images of the character directly to the platform. ` +\n      `In your prompt, describe the character's distinctive features in detail. ` +\n      `Use terms like \"the person in the reference image\" or describe specific features (hair color, facial structure, clothing style).`,\n    aspectRatio: \"9:16\",\n    duration: 5,\n    style: \"cinematic\",\n    supportsImageUpload: true,\n  },\n  midjourney: {\n    instructions: `For Midjourney: Use --cref (character reference) with an uploaded image URL. ` +\n      `Add --cw 100 for maximum character consistency. ` +\n      `Describe the character's distinctive features in detail within your prompt.`,\n    aspectRatio: \"1:1\",\n    supportsImageUpload: true,\n  },\n  dalle: {\n    instructions: `For DALL-E: Describe the character's features in extensive detail. ` +\n      `Include: face shape, eye color, hair style/color, skin tone, distinctive marks. ` +\n      `Use the same detailed description across all generations for consistency.`,\n    aspectRatio: \"1:1\",\n    supportsImageUpload: false,\n  },\n  sora: {\n    instructions: `For Sora: Upload reference images as \"character reference\" in the interface. ` +\n      `The character should maintain consistent appearance across all frames.`,\n    aspectRatio: \"16:9\",\n    duration: 10,\n    style: \"cinematic\",\n    supportsImageUpload: true,\n  },\n  veo: {\n    instructions: `For Veo: Use the subject reference feature with your uploaded images. ` +\n      `Describe the character in your prompt for consistency.`,\n    aspectRatio: \"16:9\",\n    duration: 8,\n    style: \"photorealistic\",\n    supportsImageUpload: true,\n  },\n  grok: {\n    instructions: `For Grok: Describe the character with specific visual details. ` +\n      `Reference the attached images for appearance consistency.`,\n    aspectRatio: \"1:1\",\n    supportsImageUpload: true,\n  },\n  runway: {\n    instructions: `For Runway Gen-3: Upload a reference image and use image-to-video mode. ` +\n      `The first frame should be your character reference for best consistency.`,\n    aspectRatio: \"16:9\",\n    duration: 5,\n    supportsImageUpload: true,\n  },\n  pika: {\n    instructions: `For Pika: Use an image of your character as the input. ` +\n      `The motion will be applied to the uploaded reference.`,\n    aspectRatio: \"16:9\",\n    duration: 3,\n    supportsImageUpload: true,\n  },\n  kling: {\n    instructions: `For Kling: Upload your character reference and use the face swap or character consistency feature. ` +\n      `Describe distinctive features for better results.`,\n    aspectRatio: \"16:9\",\n    duration: 5,\n    supportsImageUpload: true,\n  },\n  luma: {\n    instructions: `For Luma Dream Machine: Use image-to-video with your character as the input image. ` +\n      `The character will be preserved in the generated video.`,\n    aspectRatio: \"16:9\",\n    duration: 5,\n    supportsImageUpload: true,\n  },\n};\n\nexport class PromptCompiler {\n  private profiles: Map<string, LlmProfile> = new Map();\n  private blueprints: Map<string, PromptBlueprint> = new Map();\n  private blocks: Map<string, PromptBlock> = new Map();\n  private filters: Map<string, Filter> = new Map();\n  private activeLora: LoraContext | null = null;\n\n  setData(\n    profiles: LlmProfile[],\n    blueprints: PromptBlueprint[],\n    blocks: PromptBlock[],\n    filters: Filter[]\n  ) {\n    this.profiles = new Map(profiles.map(p => [p.id, p]));\n    this.blueprints = new Map(blueprints.map(b => [b.id, b]));\n    this.blocks = new Map(blocks.map(b => [b.key, b]));\n    this.filters = new Map(filters.map(f => [f.key, f]));\n  }\n\n  setActiveLora(lora: LoraContext | null) {\n    this.activeLora = lora;\n  }\n\n  getActiveLora(): LoraContext | null {\n    return this.activeLora;\n  }\n\n  registerUserBlueprint(blueprint: {\n    id: string;\n    name: string;\n    description: string;\n    category: string;\n    blocks: string[];\n    constraints: string[];\n  }) {\n    const virtualBlueprint: PromptBlueprint = {\n      id: blueprint.id,\n      name: blueprint.name,\n      description: blueprint.description,\n      category: blueprint.category,\n      blocks: blueprint.blocks,\n      constraints: blueprint.constraints,\n      createdAt: new Date(),\n      previewDescription: null,\n    };\n    this.blueprints.set(blueprint.id, virtualBlueprint);\n  }\n\n  profileSupportsLoraInjection(profileId: string): boolean {\n    const profile = this.profiles.get(profileId);\n    if (!profile) return false;\n    const profileName = profile.name.toLowerCase().replace(/[\\s.-]+/g, \"_\");\n    return LORA_SUPPORTING_PROFILES.some(id => profileName.includes(id));\n  }\n\n  isTargetPlatformProfile(targetPlatform: string): boolean {\n    const normalized = targetPlatform.toLowerCase();\n    return TARGET_PLATFORM_PROFILES.some(id => normalized.includes(id));\n  }\n\n  generateCharacterPack(input: CompilerInput, targetPlatform: string): CharacterPackOutput | null {\n    if (!this.activeLora) return null;\n\n    const output = this.compile(input);\n    const lora = this.activeLora;\n    const modelName = lora.modelName || \"Custom Identity\";\n    \n    // Find matching platform config\n    const normalizedPlatform = targetPlatform.toLowerCase().replace(/[\\s.-]+/g, \"\");\n    let platformConfig = CHARACTER_PACK_PLATFORMS[normalizedPlatform];\n    \n    // Try partial match if exact match not found\n    if (!platformConfig) {\n      for (const [key, config] of Object.entries(CHARACTER_PACK_PLATFORMS)) {\n        if (normalizedPlatform.includes(key) || key.includes(normalizedPlatform)) {\n          platformConfig = config;\n          break;\n        }\n      }\n    }\n    \n    // Default config if platform not found\n    if (!platformConfig) {\n      platformConfig = {\n        instructions: `For ${targetPlatform}: Describe the character \"${modelName}\" with specific visual details. ` +\n          `If the platform supports image upload, include reference images for character consistency.`,\n        aspectRatio: \"16:9\",\n        supportsImageUpload: true,\n      };\n    }\n\n    const previewImages = (lora.version.previewImages as string[]) || [];\n\n    return {\n      promptWithoutLora: output.compiledPrompt,\n      characterInstructions: platformConfig.instructions.replace(/the character/gi, `the character \"${modelName}\"`),\n      referenceImagesCount: previewImages.length || 20,\n      recommendedParams: {\n        aspectRatio: platformConfig.aspectRatio,\n        duration: platformConfig.duration,\n        style: platformConfig.style,\n      },\n      targetPlatform,\n    };\n  }\n\n  getPlatformConfig(targetPlatform: string): typeof CHARACTER_PACK_PLATFORMS[string] | null {\n    const normalizedPlatform = targetPlatform.toLowerCase().replace(/[\\s.-]+/g, \"\");\n    let platformConfig = CHARACTER_PACK_PLATFORMS[normalizedPlatform];\n    \n    if (!platformConfig) {\n      for (const [key, config] of Object.entries(CHARACTER_PACK_PLATFORMS)) {\n        if (normalizedPlatform.includes(key) || key.includes(normalizedPlatform)) {\n          return config;\n        }\n      }\n    }\n    \n    return platformConfig || null;\n  }\n\n  generateSeed(input: CompilerInput): string {\n    if (input.seed) return input.seed;\n    \n    const data = JSON.stringify({\n      profile: input.profileId,\n      blueprint: input.blueprintId,\n      filters: input.filters,\n      subject: input.subject,\n      timestamp: Date.now(),\n      random: Math.random(),\n    });\n    \n    return createHash(\"sha256\").update(data).digest(\"hex\").substring(0, 8);\n  }\n\n  compile(input: CompilerInput): CompilerOutput {\n    const warnings: string[] = [];\n    const profile = this.profiles.get(input.profileId);\n    const blueprint = this.blueprints.get(input.blueprintId);\n\n    if (!profile) {\n      throw new Error(`Profile not found: ${input.profileId}`);\n    }\n    if (!blueprint) {\n      throw new Error(`Blueprint not found: ${input.blueprintId}`);\n    }\n\n    const seed = this.generateSeed(input);\n    const parts: string[] = [];\n\n    parts.push(profile.basePrompt);\n    parts.push(SYSTEM_PROMPT_CORE);\n\n    if (this.activeLora && this.profileSupportsLoraInjection(input.profileId)) {\n      const loraBlock = this.buildLoraBlock(this.activeLora);\n      if (loraBlock) {\n        parts.push(loraBlock);\n      }\n    }\n\n    if (input.subject) {\n      parts.push(`Subject: ${input.subject}`);\n    }\n\n    if (input.environment) {\n      parts.push(`Environment: ${input.environment}`);\n    }\n\n    if (input.context) {\n      parts.push(`Context: ${input.context}`);\n    }\n\n    const blueprintBlocks = (blueprint.blocks as string[]) || [];\n    const preferredOrder = (profile.preferredOrder as string[]) || [];\n    \n    const orderedBlocks = this.orderBlocks(blueprintBlocks, preferredOrder);\n    let blockCount = 0;\n\n    for (const blockKey of orderedBlocks) {\n      const block = this.blocks.get(blockKey);\n      if (block) {\n        let template = block.template;\n        \n        template = this.applyFiltersToBlock(template, input.filters, block.type);\n        \n        if (input.items) {\n          template = template.replace(/\\{items\\}/g, input.items);\n        }\n        if (input.subject) {\n          template = template.replace(/\\{subject\\}/g, input.subject);\n        }\n        if (input.environment) {\n          template = template.replace(/\\{environment\\}/g, input.environment);\n        }\n        \n        parts.push(template);\n        blockCount++;\n      } else {\n        warnings.push(`Block not found: ${blockKey}`);\n      }\n    }\n\n    const constraints = (blueprint.constraints as string[]) || [];\n    if (constraints.length > 0) {\n      parts.push(`Constraints: ${constraints.join(\", \")}`);\n    }\n\n    if (input.restrictions) {\n      parts.push(`Avoid: ${input.restrictions}`);\n    }\n\n    let compiledPrompt = parts.filter(Boolean).join(\"\\n\\n\");\n\n    const forbiddenPatterns = (profile.forbiddenPatterns as string[]) || [];\n    for (const pattern of forbiddenPatterns) {\n      if (compiledPrompt.toLowerCase().includes(pattern.toLowerCase())) {\n        warnings.push(`Contains forbidden pattern: \"${pattern}\"`);\n        compiledPrompt = compiledPrompt.replace(new RegExp(pattern, \"gi\"), \"\");\n      }\n    }\n\n    if (compiledPrompt.length > profile.maxLength) {\n      warnings.push(`Prompt exceeds max length (${compiledPrompt.length}/${profile.maxLength})`);\n      compiledPrompt = compiledPrompt.substring(0, profile.maxLength);\n    }\n\n    const filterConflicts = this.detectFilterConflicts(input.filters);\n    warnings.push(...filterConflicts);\n\n    const score = this.calculateScore(compiledPrompt, input, warnings);\n\n    return {\n      compiledPrompt,\n      metadata: {\n        profileName: profile.name,\n        blueprintName: blueprint.name,\n        blockCount,\n        filterCount: Object.keys(input.filters).length,\n      },\n      score,\n      warnings,\n      seed,\n    };\n  }\n\n  private orderBlocks(blocks: string[], preferredOrder: string[]): string[] {\n    const typeOrder: Record<string, number> = {};\n    preferredOrder.forEach((type, i) => {\n      typeOrder[type] = i;\n    });\n\n    return [...blocks].sort((a, b) => {\n      const blockA = this.blocks.get(a);\n      const blockB = this.blocks.get(b);\n      const orderA = blockA ? (typeOrder[blockA.type] ?? 999) : 999;\n      const orderB = blockB ? (typeOrder[blockB.type] ?? 999) : 999;\n      return orderA - orderB;\n    });\n  }\n\n  private applyFiltersToBlock(template: string, filters: Record<string, string>, blockType: string): string {\n    let result = String(template);\n    const appliedEffects: string[] = [];\n\n    for (const [key, value] of Object.entries(filters)) {\n      const filter = this.filters.get(key);\n      if (filter && filter.effect) {\n        const effect = (filter.effect as Record<string, string>)[value];\n        if (effect) {\n          result = result.replace(`{${key}}`, effect);\n          appliedEffects.push(effect);\n        }\n      }\n    }\n\n    result = result.replace(/\\{[a-z_]+\\}/g, \"\");\n\n    if (appliedEffects.length > 0) {\n      result = `${result}, ${appliedEffects.join(\", \")}`;\n    }\n\n    return result;\n  }\n\n  private detectFilterConflicts(filters: Record<string, string>): string[] {\n    const conflicts: string[] = [];\n\n    if (filters.ugc_realism === \"phone\" && filters.camera_bias === \"dslr\") {\n      conflicts.push(\"Filter conflict: UGC phone style may conflict with DSLR camera bias\");\n    }\n\n    if (filters.aesthetic_intensity === \"extreme\" && filters.ugc_realism === \"ugc\") {\n      conflicts.push(\"Filter conflict: Extreme aesthetic intensity may override UGC realism\");\n    }\n\n    if (filters.temporal_style === \"y2k\" && filters.camera_bias === \"modern\") {\n      conflicts.push(\"Filter conflict: Y2K temporal style may conflict with modern camera\");\n    }\n\n    return conflicts;\n  }\n\n  private buildLoraBlock(lora: LoraContext): string | null {\n    const triggerWord = lora.triggerWord || \"lora_style\";\n    const weight = Math.max(0, Math.min(2, lora.weight));\n    const params = lora.version.params as { steps?: number; rank?: number } | null;\n    \n    let loraBlock = `<lora:${triggerWord}:${weight.toFixed(2)}>`;\n    \n    if (params?.rank && params.rank >= 32) {\n      loraBlock += \" (trained with high capacity adapter)\";\n    }\n    \n    if (!lora.version.artifactUrl) {\n      loraBlock += \" [pending training completion]\";\n    }\n    \n    return `LoRA Style Enhancement: ${loraBlock}`;\n  }\n\n  private calculateScore(prompt: string, input: CompilerInput, warnings: string[]): number {\n    let score = 100;\n\n    score -= warnings.length * 5;\n\n    if (!input.subject) {\n      score -= 15;\n    }\n\n    if (prompt.length < 100) {\n      score -= 10;\n    } else if (prompt.length > 1500) {\n      score -= 5;\n    }\n\n    const words = prompt.split(/\\s+/);\n    const uniqueWords = new Set(words.map(w => w.toLowerCase()));\n    const repetitionRatio = uniqueWords.size / words.length;\n    if (repetitionRatio < 0.5) {\n      score -= 10;\n    }\n\n    const qualityKeywords = [\"lighting\", \"camera\", \"composition\", \"texture\", \"atmosphere\", \"detail\"];\n    const hasQualityKeywords = qualityKeywords.some(kw => prompt.toLowerCase().includes(kw));\n    if (hasQualityKeywords) {\n      score += 5;\n    }\n\n    if (Object.keys(input.filters).length > 0) {\n      score += Math.min(Object.keys(input.filters).length * 2, 10);\n    }\n\n    return Math.max(0, Math.min(100, score));\n  }\n}\n\nexport const compiler = new PromptCompiler();\n","path":null,"size_bytes":15374,"size_tokens":null},"server/prompt-engine/system-prompt.ts":{"content":"export const SYSTEM_PROMPT_CORE = `You are a creative visual prompt generator. Follow these guidelines:\n\nQUALITY STANDARDS:\n- Be specific and detailed in visual descriptions\n- Use concrete, observable details rather than abstract concepts\n- Include lighting, atmosphere, and mood when relevant\n- Specify camera angles and compositional elements\n- Reference real-world materials, textures, and techniques\n\nSTYLE GUIDELINES:\n- Maintain consistency in aesthetic choices\n- Layer details from general to specific\n- Use professional terminology appropriate to the medium\n- Avoid conflicting or contradictory instructions\n- Balance creativity with technical precision\n\nOUTPUT FORMAT:\n- Write in clear, comma-separated phrases\n- Progress from subject to environment to style\n- End with technical parameters when applicable\n- Keep total length appropriate for the target model`;\n","path":null,"size_bytes":870,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"server/lib/hmac.ts":{"content":"import { createHmac, timingSafeEqual } from \"crypto\";\n\nconst HMAC_SECRET = process.env.WORKER_HMAC_SECRET || \"dev-secret-change-in-production\";\nconst TIMESTAMP_TOLERANCE_MS = 5 * 60 * 1000; // 5 minutes\n\nexport interface SignedPayload {\n  signature: string;\n  timestamp: number;\n  payload: unknown;\n}\n\nexport function signPayload(payload: unknown): SignedPayload {\n  const timestamp = Date.now();\n  const dataToSign = JSON.stringify({ payload, timestamp });\n  const signature = createHmac(\"sha256\", HMAC_SECRET)\n    .update(dataToSign)\n    .digest(\"hex\");\n  \n  return { signature, timestamp, payload };\n}\n\nexport function verifySignature(\n  signature: string,\n  timestamp: number,\n  payload: unknown\n): { valid: boolean; error?: string } {\n  const now = Date.now();\n  \n  if (Math.abs(now - timestamp) > TIMESTAMP_TOLERANCE_MS) {\n    return { valid: false, error: \"Timestamp expired or invalid\" };\n  }\n\n  const dataToSign = JSON.stringify({ payload, timestamp });\n  const expectedSignature = createHmac(\"sha256\", HMAC_SECRET)\n    .update(dataToSign)\n    .digest(\"hex\");\n\n  try {\n    const sigBuffer = Buffer.from(signature, \"hex\");\n    const expectedBuffer = Buffer.from(expectedSignature, \"hex\");\n    \n    if (sigBuffer.length !== expectedBuffer.length) {\n      return { valid: false, error: \"Invalid signature length\" };\n    }\n    \n    if (!timingSafeEqual(sigBuffer, expectedBuffer)) {\n      return { valid: false, error: \"Signature mismatch\" };\n    }\n    \n    return { valid: true };\n  } catch {\n    return { valid: false, error: \"Signature verification failed\" };\n  }\n}\n\nexport function createJobPayload(\n  jobId: string,\n  datasetUrl: string,\n  params: unknown,\n  callbackUrl: string\n): SignedPayload {\n  const payload = {\n    jobId,\n    datasetUrl,\n    params,\n    callbackUrl,\n  };\n  \n  return signPayload(payload);\n}\n","path":null,"size_bytes":1825,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/lib/i18n.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\n\ntype Language = \"en\" | \"pt-BR\";\n\nconst translations = {\n  \"en\": {\n    nav: {\n      home: \"Home\",\n      studio: \"Studio\",\n      library: \"Library\",\n      history: \"History\",\n      loraStudio: \"LoRA Studio\",\n      imageStudio: \"Image Studio\",\n    },\n    landing: {\n      heroTitle: \"Forge Perfect Prompts\",\n      heroSubtitle: \"Professional prompt engineering studio with blueprints, filters, and reproducible seeds for generating production-grade prompts for any LLM.\",\n      getStarted: \"Get Started\",\n      viewLibrary: \"View Library\",\n      featuresTitle: \"Everything You Need\",\n      featuresSubtitle: \"Build production-ready prompts with our comprehensive toolkit\",\n      feature1Title: \"Smart Blueprints\",\n      feature1Desc: \"Pre-built templates for common use cases with customizable blocks and constraints.\",\n      feature2Title: \"Powerful Filters\",\n      feature2Desc: \"Fine-tune your prompts with adjustable parameters for style, quality, and format.\",\n      feature3Title: \"Reproducible Seeds\",\n      feature3Desc: \"Generate consistent results with deterministic seeds for reliable prompt engineering.\",\n      feature4Title: \"Multi-LLM Support\",\n      feature4Desc: \"Optimized profiles for Midjourney, DALL-E, Stable Diffusion, and Flux Pro.\",\n      feature5Title: \"Quality Scoring\",\n      feature5Desc: \"Automatic quality assessment with conflict detection and optimization suggestions.\",\n      feature6Title: \"Version History\",\n      feature6Desc: \"Track all your generations and iterations with full history and replay capability.\",\n      pricingTitle: \"Simple Pricing\",\n      pricingSubtitle: \"Start free, upgrade when you need more\",\n      free: \"Free\",\n      freePriceMonth: \"/month\",\n      freeFeature1: \"3 generations per day\",\n      freeFeature2: \"Basic blueprints\",\n      freeFeature3: \"Up to 3 filters\",\n      freeFeature4: \"Generation history\",\n      startFree: \"Start Free\",\n      pro: \"Pro\",\n      proPriceMonth: \"/month\",\n      proFeature1: \"Unlimited generations\",\n      proFeature2: \"All blueprints\",\n      proFeature3: \"Unlimited filters\",\n      proFeature4: \"Priority support\",\n      proFeature5: \"API access\",\n      upgradePro: \"Upgrade to Pro\",\n      footer: \"Built for prompt engineers who demand precision.\",\n    },\n    studio: {\n      title: \"Prompt Studio\",\n      subtitle: \"Generate production-grade prompts with precision control\",\n      configuration: \"Configuration\",\n      llmProfile: \"LLM Profile\",\n      selectProfile: \"Select a profile\",\n      blueprint: \"Blueprint\",\n      selectBlueprint: \"Select a blueprint\",\n      seed: \"Seed\",\n      seedPlaceholder: \"Leave empty for random\",\n      randomize: \"Randomize\",\n      filters: \"Filters\",\n      filtersDesc: \"Adjust parameters to fine-tune your prompt\",\n      selectOption: \"Select option\",\n      inputFields: \"Input Fields\",\n      subject: \"Subject\",\n      subjectPlaceholder: \"Main subject of the prompt\",\n      context: \"Context\",\n      contextPlaceholder: \"Background context or setting\",\n      items: \"Items\",\n      itemsPlaceholder: \"Specific items to include\",\n      environment: \"Environment\",\n      environmentPlaceholder: \"Environmental details\",\n      restrictions: \"Restrictions\",\n      restrictionsPlaceholder: \"Things to avoid or exclude\",\n      generatePrompt: \"Generate Prompt\",\n      generating: \"Generating...\",\n      generatedPrompt: \"Generated Prompt\",\n      copyToClipboard: \"Copy to Clipboard\",\n      exportJson: \"Export JSON\",\n      saveVersion: \"Save Version\",\n      qualityScore: \"Quality Score\",\n      warnings: \"Warnings\",\n      metadata: \"Metadata\",\n      profile: \"Profile\",\n      blocksUsed: \"Blocks Used\",\n      filtersApplied: \"Filters Applied\",\n      selectProfileBlueprint: \"Select a profile and blueprint to begin\",\n      copied: \"Copied!\",\n      promptCopied: \"Prompt copied to clipboard\",\n      versionSaved: \"Version Saved\",\n      loraModel: \"LoRA Model\",\n      noTrainedLoras: \"No trained LoRAs available\",\n      trainLoraHint: \"Train a LoRA in the LoRA Studio\",\n      versionSavedDesc: \"Prompt version saved successfully\",\n      errorGenerating: \"Error generating prompt\",\n      targetPlatform: \"Target Platform\",\n      platformHint: \"Select where you'll use this prompt. Cloud platforms need Character Pack instead of LoRA syntax.\",\n      selectPlatform: \"Select platform...\",\n      localWithLora: \"Local (with LoRA)\",\n      cloudPlatforms: \"Cloud (Character Pack)\",\n      characterPackNote: \"This platform doesn't support LoRA. A Character Pack with reference image instructions will be generated instead.\",\n      characterPackTitle: \"Character Pack Instructions\",\n      uploadImages: \"Upload your reference images to the platform\",\n      recommendedSettings: \"Recommended Settings\",\n    },\n    library: {\n      title: \"Blueprint Library\",\n      subtitle: \"Browse and discover prompt blueprints for any use case\",\n      searchPlaceholder: \"Search blueprints...\",\n      allCategories: \"All Categories\",\n      noResults: \"No blueprints found matching your criteria\",\n      useBlueprint: \"Use Blueprint\",\n      blocks: \"blocks\",\n    },\n    history: {\n      title: \"Generation History\",\n      subtitle: \"View and replay your previous prompt generations\",\n      noHistory: \"No generation history yet\",\n      noHistoryDesc: \"Generate your first prompt to see it here\",\n      goToStudio: \"Go to Studio\",\n      replay: \"Replay\",\n      score: \"Score\",\n    },\n    common: {\n      loading: \"Loading...\",\n      error: \"Error\",\n      save: \"Save\",\n      cancel: \"Cancel\",\n      close: \"Close\",\n    },\n    loraStudio: {\n      title: \"LoRA Training Studio\",\n      subtitle: \"Train custom AI models with your own images\",\n      proRequired: \"Pro subscription required\",\n      proRequiredDesc: \"LoRA training is a Pro-only feature. Upgrade to access custom model training.\",\n      upgradePro: \"Upgrade to Pro\",\n      myModels: \"My Models\",\n      createModel: \"Create Model\",\n      noModels: \"No LoRA models yet\",\n      noModelsDesc: \"Create your first LoRA model to get started with custom training\",\n      modelName: \"Model Name\",\n      modelNamePlaceholder: \"e.g., My Art Style\",\n      description: \"Description\",\n      descriptionPlaceholder: \"Optional description of your model\",\n      consent: \"I confirm I have rights to use these images for AI training\",\n      create: \"Create Model\",\n      creating: \"Creating...\",\n      datasets: \"Datasets\",\n      uploadDataset: \"Upload Dataset\",\n      imageCount: \"Images\",\n      status: \"Status\",\n      pending: \"Pending\",\n      validated: \"Validated\",\n      invalid: \"Invalid\",\n      training: \"Training\",\n      completed: \"Completed\",\n      failed: \"Failed\",\n      versions: \"Versions\",\n      noVersions: \"No trained versions yet\",\n      startTraining: \"Start Training\",\n      trainingParams: \"Training Parameters\",\n      steps: \"Steps\",\n      learningRate: \"Learning Rate\",\n      resolution: \"Resolution\",\n      rank: \"Rank\",\n      baseModel: \"Base Model\",\n      selectBaseModel: \"Select base model\",\n      targetPlatform: \"Target Platform\",\n      targetPlatformDesc: \"Platform for prompt generation and Character Pack export\",\n      trainableBaseModel: \"Trainable Base Model\",\n      trainableBaseModelDesc: \"Base model for LoRA training (Flux, SDXL)\",\n      startJob: \"Start Training Job\",\n      jobStatus: \"Job Status\",\n      progress: \"Progress\",\n      activeLora: \"Active LoRA\",\n      noActiveLora: \"No LoRA active\",\n      activate: \"Activate\",\n      deactivate: \"Deactivate\",\n      weight: \"Weight\",\n      qualityScore: \"Quality Score\",\n      errorCreating: \"Error creating model\",\n      errorUploading: \"Error uploading dataset\",\n      errorTraining: \"Error starting training\",\n      modelCreated: \"Model created successfully\",\n      trainingStarted: \"Training job started\",\n      loraActivated: \"LoRA activated for prompt generation\",\n      loraDeactivated: \"LoRA deactivated\",\n    },\n    blueprintBuilder: {\n      createTitle: \"Create Blueprint\",\n      editTitle: \"Edit Blueprint\",\n      created: \"Blueprint created\",\n      updated: \"Blueprint updated\",\n      error: \"Error\",\n      name: \"Name\",\n      namePlaceholder: \"My Custom Blueprint\",\n      description: \"Description\",\n      descriptionPlaceholder: \"Describe what this blueprint generates...\",\n      category: \"Category\",\n      tags: \"Tags\",\n      tagPlaceholder: \"Add tag...\",\n      compatibleProfiles: \"Compatible Profiles\",\n      allProfilesHint: \"Leave empty to support all profiles\",\n      selectedBlocks: \"Selected Blocks\",\n      noBlocksHint: \"Add blocks from below to define your blueprint structure\",\n      availableBlocks: \"Available Blocks\",\n      loading: \"Loading...\",\n      cancel: \"Cancel\",\n      save: \"Save Blueprint\",\n      update: \"Update\",\n      myBlueprints: \"My Blueprints\",\n      systemBlueprints: \"System Blueprints\",\n      createNew: \"Create New\",\n      noUserBlueprints: \"No custom blueprints yet\",\n      createFirstHint: \"Create your first custom blueprint\",\n      edit: \"Edit\",\n      duplicate: \"Duplicate\",\n      delete: \"Delete\",\n      confirmDelete: \"Are you sure you want to delete this blueprint?\",\n      deleted: \"Blueprint deleted\",\n      duplicated: \"Blueprint duplicated\",\n      limitReached: \"Blueprint limit reached\",\n      upgradeHint: \"Upgrade to Pro for unlimited blueprints\",\n    },\n    modelslab: {\n      title: \"Image Studio\",\n      subtitle: \"Generate high-fidelity images with multi-image fusion and 95%+ character consistency\",\n      inputTitle: \"Input\",\n      inputDescription: \"Add reference images and describe your desired output\",\n      outputTitle: \"Result\",\n      outputDescription: \"Your generated image will appear here\",\n      referenceImages: \"Reference Images\",\n      imageUrls: \"Reference Images\",\n      imagePlaceholder: \"Image URL\",\n      addImage: \"Add Another Image\",\n      dropOrClick: \"Drop images here or click to upload\",\n      pasteHint: \"You can also paste images (Ctrl+V)\",\n      invalidFileType: \"Invalid file type. Only images allowed.\",\n      fileTooLarge: \"File too large. Maximum 10MB.\",\n      warning: \"Warning\",\n      maxImagesReached: \"Maximum of 14 images reached\",\n      prompt: \"Prompt\",\n      promptPlaceholder: \"Describe how you want the images to be combined or transformed...\",\n      aspectRatio: \"Aspect Ratio\",\n      generate: \"Generate Image\",\n      generating: \"Generating...\",\n      processing: \"Processing...\",\n      success: \"Success\",\n      imageGenerated: \"Image generated successfully\",\n      error: \"Error\",\n      generationFailed: \"Failed to generate image\",\n      pollingFailed: \"Failed to check generation status\",\n      noImages: \"Please add at least one image\",\n      waitingResult: \"Waiting for result...\",\n      noResult: \"Generated image will appear here\",\n      generatedIn: \"Generated in\",\n      timeout: \"Generation timed out. Please try again.\",\n      aboutTitle: \"About Nano Banana Pro\",\n      resolution: \"Max Resolution\",\n      maxImages: \"Max Input Images\",\n      consistency: \"Character Consistency\",\n      model: \"Model\",\n    },\n  },\n  \"pt-BR\": {\n    nav: {\n      home: \"Incio\",\n      studio: \"Estdio\",\n      library: \"Biblioteca\",\n      history: \"Histrico\",\n      loraStudio: \"Estdio LoRA\",\n      imageStudio: \"Estdio de Imagem\",\n    },\n    landing: {\n      heroTitle: \"Forje Prompts Perfeitos\",\n      heroSubtitle: \"Estdio profissional de engenharia de prompts com blueprints, filtros e seeds reproduzveis para gerar prompts de nvel profissional para qualquer LLM.\",\n      getStarted: \"Comear\",\n      viewLibrary: \"Ver Biblioteca\",\n      featuresTitle: \"Tudo que Voc Precisa\",\n      featuresSubtitle: \"Construa prompts prontos para produo com nosso kit de ferramentas completo\",\n      feature1Title: \"Blueprints Inteligentes\",\n      feature1Desc: \"Templates pr-construdos para casos de uso comuns com blocos e restries personalizveis.\",\n      feature2Title: \"Filtros Poderosos\",\n      feature2Desc: \"Ajuste fino dos seus prompts com parmetros ajustveis para estilo, qualidade e formato.\",\n      feature3Title: \"Seeds Reproduzveis\",\n      feature3Desc: \"Gere resultados consistentes com seeds determinsticas para engenharia de prompts confivel.\",\n      feature4Title: \"Suporte Multi-LLM\",\n      feature4Desc: \"Perfis otimizados para Midjourney, DALL-E, Stable Diffusion e Flux Pro.\",\n      feature5Title: \"Pontuao de Qualidade\",\n      feature5Desc: \"Avaliao automtica de qualidade com deteco de conflitos e sugestes de otimizao.\",\n      feature6Title: \"Histrico de Verses\",\n      feature6Desc: \"Acompanhe todas as suas geraes e iteraes com histrico completo e capacidade de replay.\",\n      pricingTitle: \"Preos Simples\",\n      pricingSubtitle: \"Comece grtis, faa upgrade quando precisar de mais\",\n      free: \"Grtis\",\n      freePriceMonth: \"/ms\",\n      freeFeature1: \"3 geraes por dia\",\n      freeFeature2: \"Blueprints bsicos\",\n      freeFeature3: \"At 3 filtros\",\n      freeFeature4: \"Histrico de geraes\",\n      startFree: \"Comear Grtis\",\n      pro: \"Pro\",\n      proPriceMonth: \"/ms\",\n      proFeature1: \"Geraes ilimitadas\",\n      proFeature2: \"Todos os blueprints\",\n      proFeature3: \"Filtros ilimitados\",\n      proFeature4: \"Suporte prioritrio\",\n      proFeature5: \"Acesso  API\",\n      upgradePro: \"Fazer Upgrade para Pro\",\n      footer: \"Feito para engenheiros de prompt que exigem preciso.\",\n    },\n    studio: {\n      title: \"Estdio de Prompts\",\n      subtitle: \"Gere prompts de nvel profissional com controle preciso\",\n      configuration: \"Configurao\",\n      llmProfile: \"Perfil LLM\",\n      selectProfile: \"Selecione um perfil\",\n      blueprint: \"Blueprint\",\n      selectBlueprint: \"Selecione um blueprint\",\n      seed: \"Seed\",\n      seedPlaceholder: \"Deixe vazio para aleatrio\",\n      randomize: \"Aleatorizar\",\n      filters: \"Filtros\",\n      filtersDesc: \"Ajuste os parmetros para refinar seu prompt\",\n      selectOption: \"Selecione uma opo\",\n      inputFields: \"Campos de Entrada\",\n      subject: \"Assunto\",\n      subjectPlaceholder: \"Assunto principal do prompt\",\n      context: \"Contexto\",\n      contextPlaceholder: \"Contexto ou cenrio de fundo\",\n      items: \"Itens\",\n      itemsPlaceholder: \"Itens especficos para incluir\",\n      environment: \"Ambiente\",\n      environmentPlaceholder: \"Detalhes do ambiente\",\n      restrictions: \"Restries\",\n      restrictionsPlaceholder: \"Coisas a evitar ou excluir\",\n      generatePrompt: \"Gerar Prompt\",\n      generating: \"Gerando...\",\n      generatedPrompt: \"Prompt Gerado\",\n      copyToClipboard: \"Copiar para rea de Transferncia\",\n      exportJson: \"Exportar JSON\",\n      saveVersion: \"Salvar Verso\",\n      qualityScore: \"Pontuao de Qualidade\",\n      warnings: \"Avisos\",\n      metadata: \"Metadados\",\n      profile: \"Perfil\",\n      blocksUsed: \"Blocos Usados\",\n      filtersApplied: \"Filtros Aplicados\",\n      selectProfileBlueprint: \"Selecione um perfil e blueprint para comear\",\n      copied: \"Copiado!\",\n      promptCopied: \"Prompt copiado para a rea de transferncia\",\n      versionSaved: \"Verso Salva\",\n      loraModel: \"Modelo LoRA\",\n      noTrainedLoras: \"Nenhum LoRA treinado disponvel\",\n      trainLoraHint: \"Treine um LoRA no Estdio LoRA\",\n      versionSavedDesc: \"Verso do prompt salva com sucesso\",\n      errorGenerating: \"Erro ao gerar prompt\",\n      targetPlatform: \"Plataforma Alvo\",\n      platformHint: \"Selecione onde voc usar este prompt. Plataformas na nuvem precisam de Character Pack em vez de sintaxe LoRA.\",\n      selectPlatform: \"Selecionar plataforma...\",\n      localWithLora: \"Local (com LoRA)\",\n      cloudPlatforms: \"Nuvem (Character Pack)\",\n      characterPackNote: \"Esta plataforma no suporta LoRA. Um Character Pack com instrues de imagem de referncia ser gerado.\",\n      characterPackTitle: \"Instrues do Character Pack\",\n      uploadImages: \"Envie suas imagens de referncia para a plataforma\",\n      recommendedSettings: \"Configuraes Recomendadas\",\n    },\n    library: {\n      title: \"Biblioteca de Blueprints\",\n      subtitle: \"Navegue e descubra blueprints de prompts para qualquer uso\",\n      searchPlaceholder: \"Buscar blueprints...\",\n      allCategories: \"Todas as Categorias\",\n      noResults: \"Nenhum blueprint encontrado com seus critrios\",\n      useBlueprint: \"Usar Blueprint\",\n      blocks: \"blocos\",\n    },\n    history: {\n      title: \"Histrico de Geraes\",\n      subtitle: \"Veja e replique suas geraes de prompts anteriores\",\n      noHistory: \"Nenhum histrico de geraes ainda\",\n      noHistoryDesc: \"Gere seu primeiro prompt para v-lo aqui\",\n      goToStudio: \"Ir para o Estdio\",\n      replay: \"Repetir\",\n      score: \"Pontuao\",\n    },\n    common: {\n      loading: \"Carregando...\",\n      error: \"Erro\",\n      save: \"Salvar\",\n      cancel: \"Cancelar\",\n      close: \"Fechar\",\n    },\n    loraStudio: {\n      title: \"Estdio de Treinamento LoRA\",\n      subtitle: \"Treine modelos de IA personalizados com suas prprias imagens\",\n      proRequired: \"Assinatura Pro necessria\",\n      proRequiredDesc: \"O treinamento LoRA  um recurso exclusivo Pro. Faa upgrade para acessar o treinamento de modelos personalizados.\",\n      upgradePro: \"Fazer Upgrade para Pro\",\n      myModels: \"Meus Modelos\",\n      createModel: \"Criar Modelo\",\n      noModels: \"Nenhum modelo LoRA ainda\",\n      noModelsDesc: \"Crie seu primeiro modelo LoRA para comear com o treinamento personalizado\",\n      modelName: \"Nome do Modelo\",\n      modelNamePlaceholder: \"ex., Meu Estilo de Arte\",\n      description: \"Descrio\",\n      descriptionPlaceholder: \"Descrio opcional do seu modelo\",\n      consent: \"Confirmo que tenho direitos de usar estas imagens para treinamento de IA\",\n      create: \"Criar Modelo\",\n      creating: \"Criando...\",\n      datasets: \"Conjuntos de Dados\",\n      uploadDataset: \"Enviar Conjunto de Dados\",\n      imageCount: \"Imagens\",\n      status: \"Status\",\n      pending: \"Pendente\",\n      validated: \"Validado\",\n      invalid: \"Invlido\",\n      training: \"Treinando\",\n      completed: \"Concludo\",\n      failed: \"Falhou\",\n      versions: \"Verses\",\n      noVersions: \"Nenhuma verso treinada ainda\",\n      startTraining: \"Iniciar Treinamento\",\n      trainingParams: \"Parmetros de Treinamento\",\n      steps: \"Passos\",\n      learningRate: \"Taxa de Aprendizado\",\n      resolution: \"Resoluo\",\n      rank: \"Rank\",\n      baseModel: \"Modelo Base\",\n      selectBaseModel: \"Selecione o modelo base\",\n      targetPlatform: \"Plataforma Alvo\",\n      targetPlatformDesc: \"Plataforma para gerao de prompts e exportao de Character Pack\",\n      trainableBaseModel: \"Modelo Base Treinvel\",\n      trainableBaseModelDesc: \"Modelo base para treinamento LoRA (Flux, SDXL)\",\n      startJob: \"Iniciar Job de Treinamento\",\n      jobStatus: \"Status do Job\",\n      progress: \"Progresso\",\n      activeLora: \"LoRA Ativo\",\n      noActiveLora: \"Nenhum LoRA ativo\",\n      activate: \"Ativar\",\n      deactivate: \"Desativar\",\n      weight: \"Peso\",\n      qualityScore: \"Pontuao de Qualidade\",\n      errorCreating: \"Erro ao criar modelo\",\n      errorUploading: \"Erro ao enviar conjunto de dados\",\n      errorTraining: \"Erro ao iniciar treinamento\",\n      modelCreated: \"Modelo criado com sucesso\",\n      trainingStarted: \"Job de treinamento iniciado\",\n      loraActivated: \"LoRA ativado para gerao de prompts\",\n      loraDeactivated: \"LoRA desativado\",\n    },\n    blueprintBuilder: {\n      createTitle: \"Criar Blueprint\",\n      editTitle: \"Editar Blueprint\",\n      created: \"Blueprint criado\",\n      updated: \"Blueprint atualizado\",\n      error: \"Erro\",\n      name: \"Nome\",\n      namePlaceholder: \"Meu Blueprint Personalizado\",\n      description: \"Descrio\",\n      descriptionPlaceholder: \"Descreva o que este blueprint gera...\",\n      category: \"Categoria\",\n      tags: \"Tags\",\n      tagPlaceholder: \"Adicionar tag...\",\n      compatibleProfiles: \"Perfis Compatveis\",\n      allProfilesHint: \"Deixe vazio para suportar todos os perfis\",\n      selectedBlocks: \"Blocos Selecionados\",\n      noBlocksHint: \"Adicione blocos abaixo para definir a estrutura do seu blueprint\",\n      availableBlocks: \"Blocos Disponveis\",\n      loading: \"Carregando...\",\n      cancel: \"Cancelar\",\n      save: \"Salvar Blueprint\",\n      update: \"Atualizar\",\n      myBlueprints: \"Meus Blueprints\",\n      systemBlueprints: \"Blueprints do Sistema\",\n      createNew: \"Criar Novo\",\n      noUserBlueprints: \"Nenhum blueprint personalizado ainda\",\n      createFirstHint: \"Crie seu primeiro blueprint personalizado\",\n      edit: \"Editar\",\n      duplicate: \"Duplicar\",\n      delete: \"Excluir\",\n      confirmDelete: \"Tem certeza que deseja excluir este blueprint?\",\n      deleted: \"Blueprint excludo\",\n      duplicated: \"Blueprint duplicado\",\n      limitReached: \"Limite de blueprints atingido\",\n      upgradeHint: \"Faa upgrade para Pro para blueprints ilimitados\",\n    },\n    modelslab: {\n      title: \"Estdio de Imagem\",\n      subtitle: \"Gere imagens de alta fidelidade com fuso de mltiplas imagens e 95%+ de consistncia de personagem\",\n      inputTitle: \"Entrada\",\n      inputDescription: \"Adicione imagens de referncia e descreva o resultado desejado\",\n      outputTitle: \"Resultado\",\n      outputDescription: \"Sua imagem gerada aparecer aqui\",\n      referenceImages: \"Imagens de Referncia\",\n      imageUrls: \"Imagens de Referncia\",\n      imagePlaceholder: \"URL da Imagem\",\n      addImage: \"Adicionar Outra Imagem\",\n      dropOrClick: \"Arraste imagens aqui ou clique para enviar\",\n      pasteHint: \"Voc tambm pode colar imagens (Ctrl+V)\",\n      invalidFileType: \"Tipo de arquivo invlido. Apenas imagens so permitidas.\",\n      fileTooLarge: \"Arquivo muito grande. Mximo 10MB.\",\n      warning: \"Aviso\",\n      maxImagesReached: \"Mximo de 14 imagens atingido\",\n      prompt: \"Prompt\",\n      promptPlaceholder: \"Descreva como voc quer que as imagens sejam combinadas ou transformadas...\",\n      aspectRatio: \"Proporo\",\n      generate: \"Gerar Imagem\",\n      generating: \"Gerando...\",\n      processing: \"Processando...\",\n      success: \"Sucesso\",\n      imageGenerated: \"Imagem gerada com sucesso\",\n      error: \"Erro\",\n      generationFailed: \"Falha ao gerar imagem\",\n      pollingFailed: \"Falha ao verificar status da gerao\",\n      noImages: \"Por favor adicione pelo menos uma imagem\",\n      waitingResult: \"Aguardando resultado...\",\n      noResult: \"A imagem gerada aparecer aqui\",\n      generatedIn: \"Gerado em\",\n      timeout: \"A gerao expirou. Por favor, tente novamente.\",\n      aboutTitle: \"Sobre Nano Banana Pro\",\n      resolution: \"Resoluo Mxima\",\n      maxImages: \"Mximo de Imagens\",\n      consistency: \"Consistncia de Personagem\",\n      model: \"Modelo\",\n    },\n  },\n};\n\ntype TranslationKey = keyof typeof translations[\"en\"];\ntype Translations = typeof translations[\"en\"];\n\ninterface I18nContextType {\n  language: Language;\n  setLanguage: (lang: Language) => void;\n  t: Translations;\n}\n\nconst I18nContext = createContext<I18nContextType | null>(null);\n\nexport function I18nProvider({ children }: { children: ReactNode }) {\n  const [language, setLanguage] = useState<Language>(() => {\n    if (typeof window !== \"undefined\") {\n      const saved = localStorage.getItem(\"language\") as Language;\n      if (saved && (saved === \"en\" || saved === \"pt-BR\")) return saved;\n      const browserLang = navigator.language;\n      if (browserLang.startsWith(\"pt\")) return \"pt-BR\";\n    }\n    return \"en\";\n  });\n\n  useEffect(() => {\n    localStorage.setItem(\"language\", language);\n  }, [language]);\n\n  const t = translations[language];\n\n  return (\n    <I18nContext.Provider value={{ language, setLanguage, t }}>\n      {children}\n    </I18nContext.Provider>\n  );\n}\n\nexport function useI18n() {\n  const context = useContext(I18nContext);\n  if (!context) {\n    throw new Error(\"useI18n must be used within an I18nProvider\");\n  }\n  return context;\n}\n\nexport function LanguageToggle() {\n  const { language, setLanguage } = useI18n();\n  \n  return (\n    <button\n      onClick={() => setLanguage(language === \"en\" ? \"pt-BR\" : \"en\")}\n      className=\"text-xs font-medium px-2 py-1 rounded-md bg-muted hover-elevate\"\n      data-testid=\"button-language-toggle\"\n    >\n      {language === \"en\" ? \"PT\" : \"EN\"}\n    </button>\n  );\n}\n","path":null,"size_bytes":24366,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"server/prompt-engine/types.ts":{"content":"export interface CompilerInput {\n  profileId: string;\n  blueprintId: string;\n  filters: Record<string, string>;\n  seed: string;\n  subject: string;\n  context: string;\n  items: string;\n  environment: string;\n  restrictions: string;\n}\n\nexport interface CompilerOutput {\n  compiledPrompt: string;\n  metadata: {\n    profileName: string;\n    blueprintName: string;\n    blockCount: number;\n    filterCount: number;\n  };\n  score: number;\n  warnings: string[];\n  seed: string;\n}\n\nexport interface BlockDefinition {\n  key: string;\n  label: string;\n  template: string;\n  type: \"style\" | \"camera\" | \"layout\" | \"constraint\" | \"postfx\" | \"subject\";\n}\n\nexport interface FilterDefinition {\n  key: string;\n  label: string;\n  schema: { type: string; options?: string[]; min?: number; max?: number };\n  effect: Record<string, string>;\n}\n\nexport interface ProfileDefinition {\n  name: string;\n  basePrompt: string;\n  preferredOrder: string[];\n  forbiddenPatterns: string[];\n  maxLength: number;\n  capabilities: string[];\n}\n\nexport interface BlueprintDefinition {\n  name: string;\n  category: string;\n  description: string;\n  blocks: string[];\n  constraints: string[];\n  previewDescription?: string;\n}\n\nexport interface BaseModelDefinition {\n  name: string;\n  displayName: string;\n  loraFormat: string;\n  defaultResolution: number;\n  isActive: number;\n}\n","path":null,"size_bytes":1331,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"server/lib/rate-limiter.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\n\ninterface RateLimitStore {\n  [key: string]: {\n    count: number;\n    resetAt: number;\n  };\n}\n\nconst store: RateLimitStore = {};\n\nexport interface RateLimitConfig {\n  windowMs: number;\n  maxRequests: number;\n  keyGenerator?: (req: Request) => string;\n  message?: string;\n}\n\nexport function rateLimit(config: RateLimitConfig) {\n  const {\n    windowMs,\n    maxRequests,\n    keyGenerator = (req) => req.ip || \"anonymous\",\n    message = \"Too many requests, please try again later\",\n  } = config;\n\n  return (req: Request, res: Response, next: NextFunction) => {\n    const key = keyGenerator(req);\n    const now = Date.now();\n\n    if (!store[key] || store[key].resetAt < now) {\n      store[key] = {\n        count: 0,\n        resetAt: now + windowMs,\n      };\n    }\n\n    store[key].count++;\n\n    const remaining = Math.max(0, maxRequests - store[key].count);\n    const resetAt = store[key].resetAt;\n\n    res.setHeader(\"X-RateLimit-Limit\", maxRequests);\n    res.setHeader(\"X-RateLimit-Remaining\", remaining);\n    res.setHeader(\"X-RateLimit-Reset\", Math.ceil(resetAt / 1000));\n\n    if (store[key].count > maxRequests) {\n      return res.status(429).json({\n        error: message,\n        retryAfter: Math.ceil((resetAt - now) / 1000),\n      });\n    }\n\n    next();\n  };\n}\n\nexport function loraJobRateLimiter() {\n  return rateLimit({\n    windowMs: 60 * 60 * 1000, // 1 hour\n    maxRequests: 5,\n    keyGenerator: (req) => `lora-job:${req.ip || \"anonymous\"}`,\n    message: \"LoRA job limit exceeded. Pro users get more capacity.\",\n  });\n}\n\nexport function webhookRateLimiter() {\n  return rateLimit({\n    windowMs: 60 * 1000, // 1 minute\n    maxRequests: 100,\n    keyGenerator: (req) => `webhook:${req.ip || \"anonymous\"}`,\n    message: \"Webhook rate limit exceeded\",\n  });\n}\n\nexport function datasetUploadRateLimiter() {\n  return rateLimit({\n    windowMs: 60 * 60 * 1000, // 1 hour\n    maxRequests: 10,\n    keyGenerator: (req) => `dataset:${req.ip || \"anonymous\"}`,\n    message: \"Dataset upload limit exceeded\",\n  });\n}\n\nsetInterval(() => {\n  const now = Date.now();\n  for (const key in store) {\n    if (store[key].resetAt < now) {\n      delete store[key];\n    }\n  }\n}, 60 * 1000);\n","path":null,"size_bytes":2231,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 0 0% 9%;\n  --border: 0 0% 91%;\n  --card: 0 0% 98%;\n  --card-foreground: 0 0% 9%;\n  --card-border: 0 0% 94%;\n  --sidebar: 0 0% 96%;\n  --sidebar-foreground: 0 0% 9%;\n  --sidebar-border: 0 0% 92%;\n  --sidebar-primary: 262 83% 58%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 0 0% 92%;\n  --sidebar-accent-foreground: 0 0% 9%;\n  --sidebar-ring: 262 83% 58%;\n  --popover: 0 0% 94%;\n  --popover-foreground: 0 0% 9%;\n  --popover-border: 0 0% 90%;\n  --primary: 262 83% 58%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 0 0% 90%;\n  --secondary-foreground: 0 0% 9%;\n  --muted: 0 0% 88%;\n  --muted-foreground: 0 0% 35%;\n  --accent: 260 8% 91%;\n  --accent-foreground: 0 0% 9%;\n  --destructive: 0 84% 45%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 0 0% 75%;\n  --ring: 262 83% 58%;\n  --chart-1: 262 83% 35%;\n  --chart-2: 280 75% 40%;\n  --chart-3: 245 70% 42%;\n  --chart-4: 290 65% 38%;\n  --chart-5: 255 80% 37%;\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.07);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.08);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.09);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 0 0% 7%;\n  --foreground: 0 0% 98%;\n  --border: 0 0% 16%;\n  --card: 0 0% 9%;\n  --card-foreground: 0 0% 98%;\n  --card-border: 0 0% 12%;\n  --sidebar: 0 0% 11%;\n  --sidebar-foreground: 0 0% 98%;\n  --sidebar-border: 0 0% 14%;\n  --sidebar-primary: 262 83% 58%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 0 0% 15%;\n  --sidebar-accent-foreground: 0 0% 98%;\n  --sidebar-ring: 262 83% 58%;\n  --popover: 0 0% 13%;\n  --popover-foreground: 0 0% 98%;\n  --popover-border: 0 0% 16%;\n  --primary: 262 83% 58%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 0 0% 17%;\n  --secondary-foreground: 0 0% 98%;\n  --muted: 0 0% 19%;\n  --muted-foreground: 0 0% 68%;\n  --accent: 260 8% 18%;\n  --accent-foreground: 0 0% 98%;\n  --destructive: 0 84% 45%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 0 0% 28%;\n  --ring: 262 83% 58%;\n  --chart-1: 262 90% 75%;\n  --chart-2: 280 85% 78%;\n  --chart-3: 245 88% 76%;\n  --chart-4: 290 82% 77%;\n  --chart-5: 255 92% 74%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.07);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.08);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.09);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10536,"size_tokens":null},"client/src/pages/history.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useI18n } from \"@/lib/i18n\";\nimport type { GeneratedPrompt } from \"@shared/schema\";\nimport { \n  History as HistoryIcon, Play, Copy, Gauge, Clock, Zap, \n  ChevronRight, FileText\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\n\nexport default function HistoryPage() {\n  const { toast } = useToast();\n  const { t } = useI18n();\n\n  const { data: history, isLoading } = useQuery<GeneratedPrompt[]>({\n    queryKey: [\"/api/history\"],\n  });\n\n  const handleCopy = async (prompt: string) => {\n    await navigator.clipboard.writeText(prompt);\n    toast({ title: t.studio.promptCopied });\n  };\n\n  const formatDate = (dateStr: string | Date) => {\n    try {\n      return format(new Date(dateStr), \"MMM d, yyyy 'at' h:mm a\");\n    } catch {\n      return \"Unknown date\";\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen pt-16\">\n      <div className=\"max-w-5xl mx-auto px-4 md:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-semibold mb-2\" data-testid=\"text-history-title\">{t.history.title}</h1>\n          <p className=\"text-muted-foreground\">{t.history.subtitle}</p>\n        </div>\n\n        {isLoading ? (\n          <div className=\"space-y-4\">\n            {[...Array(5)].map((_, i) => (\n              <Card key={i}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start gap-4\">\n                    <Skeleton className=\"w-10 h-10 rounded-lg shrink-0\" />\n                    <div className=\"flex-1 space-y-2\">\n                      <Skeleton className=\"h-5 w-1/3\" />\n                      <Skeleton className=\"h-4 w-full\" />\n                      <Skeleton className=\"h-4 w-2/3\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : !history || history.length === 0 ? (\n          <Card className=\"text-center py-16\">\n            <CardContent>\n              <HistoryIcon className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-medium mb-2\">{t.history.noHistory}</h3>\n              <p className=\"text-muted-foreground mb-6\">\n                {t.history.noHistoryDesc}\n              </p>\n              <Link href=\"/studio\">\n                <Button className=\"gap-2\">\n                  <Zap className=\"w-4 h-4\" />\n                  {t.history.goToStudio}\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        ) : (\n          <ScrollArea className=\"h-[calc(100vh-250px)]\">\n            <div className=\"space-y-4 pr-4\">\n              {history.map((item) => (\n                <Card key={item.id} className=\"group\" data-testid={`card-history-${item.id}`}>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-start gap-4\">\n                      <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0\">\n                        <FileText className=\"w-5 h-5 text-primary\" />\n                      </div>\n                      \n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n                          <h3 className=\"font-medium truncate\">\n                            {item.metadata?.blueprintName || \"Untitled\"}\n                          </h3>\n                          <Badge variant=\"secondary\" className=\"shrink-0\">\n                            {item.metadata?.profileName}\n                          </Badge>\n                          <Badge \n                            variant={item.score >= 80 ? \"default\" : item.score >= 60 ? \"secondary\" : \"outline\"}\n                            className=\"gap-1 shrink-0\"\n                          >\n                            <Gauge className=\"w-3 h-3\" />\n                            {t.history.score}: {item.score}\n                          </Badge>\n                        </div>\n                        \n                        <p className=\"text-sm text-muted-foreground line-clamp-2 mb-3 font-mono\">\n                          {item.compiledPrompt}\n                        </p>\n                        \n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\">\n                            <Clock className=\"w-3 h-3\" />\n                            {formatDate(item.createdAt)}\n                          </span>\n                          <span>Seed: <code className=\"font-mono bg-muted px-1 rounded\">{item.seed}</code></span>\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleCopy(item.compiledPrompt)}\n                          data-testid={`button-copy-${item.id}`}\n                        >\n                          <Copy className=\"w-4 h-4\" />\n                        </Button>\n                        <Link href={`/studio?seed=${item.seed}&blueprint=${item.blueprintId}&profile=${item.profileId}`}>\n                          <Button variant=\"ghost\" size=\"icon\" data-testid={`button-replay-${item.id}`}>\n                            <Play className=\"w-4 h-4\" />\n                          </Button>\n                        </Link>\n                        <ChevronRight className=\"w-4 h-4 text-muted-foreground\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </ScrollArea>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6194,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/pages/library.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useI18n } from \"@/lib/i18n\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { BlueprintBuilder } from \"@/components/blueprint-builder\";\nimport type { PromptBlueprint } from \"@shared/schema\";\nimport { Search, ArrowRight, Layers, Grid3X3, Camera, Tv, Palette, Gamepad2, Frame, Monitor, Plus, MoreVertical, Pencil, Copy, Trash2, User } from \"lucide-react\";\n\ninterface UserBlueprint {\n  id: string;\n  userId: string;\n  name: string;\n  description: string | null;\n  category: string;\n  tags: string[];\n  blocks: string[];\n  constraints: Record<string, unknown>;\n  compatibleProfiles: string[];\n  version: number;\n  isActive: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nconst categoryIcons: Record<string, React.ElementType> = {\n  aesthetic: Palette,\n  layout: Grid3X3,\n  surveillance: Camera,\n  retro: Tv,\n  gaming: Gamepad2,\n  fashion: Frame,\n  ui: Monitor,\n  custom: User,\n  product: Layers,\n  portrait: User,\n  scene: Palette,\n  technical: Monitor,\n};\n\nconst categories = [\"all\", \"aesthetic\", \"layout\", \"surveillance\", \"retro\", \"gaming\", \"fashion\", \"ui\", \"custom\", \"product\", \"portrait\", \"scene\", \"technical\"];\n\nexport default function LibraryPage() {\n  const { t } = useI18n();\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [activeCategory, setActiveCategory] = useState(\"all\");\n  const [activeTab, setActiveTab] = useState(\"system\");\n  const [builderOpen, setBuilderOpen] = useState(false);\n  const [editingBlueprint, setEditingBlueprint] = useState<UserBlueprint | null>(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [blueprintToDelete, setBlueprintToDelete] = useState<UserBlueprint | null>(null);\n\n  const { data: blueprints, isLoading } = useQuery<PromptBlueprint[]>({\n    queryKey: [\"/api/blueprints\"],\n  });\n\n  const { data: userBlueprints, isLoading: loadingUserBlueprints } = useQuery<UserBlueprint[]>({\n    queryKey: [\"/api/user-blueprints\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/user-blueprints/${id}`);\n    },\n    onSuccess: () => {\n      toast({ title: t.blueprintBuilder?.deleted || \"Blueprint deleted\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-blueprints\"] });\n      setDeleteDialogOpen(false);\n      setBlueprintToDelete(null);\n    },\n    onError: (error: Error) => {\n      toast({ title: t.blueprintBuilder?.error || \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const duplicateMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"POST\", `/api/user-blueprints/${id}/duplicate`);\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: t.blueprintBuilder?.duplicated || \"Blueprint duplicated\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-blueprints\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: t.blueprintBuilder?.error || \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const filteredBlueprints = blueprints?.filter((bp) => {\n    const matchesSearch = bp.name.toLowerCase().includes(search.toLowerCase()) ||\n      bp.description.toLowerCase().includes(search.toLowerCase());\n    const matchesCategory = activeCategory === \"all\" || bp.category === activeCategory;\n    return matchesSearch && matchesCategory;\n  });\n\n  const filteredUserBlueprints = userBlueprints?.filter((bp) => {\n    const matchesSearch = bp.name.toLowerCase().includes(search.toLowerCase()) ||\n      (bp.description?.toLowerCase().includes(search.toLowerCase()) || false);\n    const matchesCategory = activeCategory === \"all\" || bp.category === activeCategory;\n    return matchesSearch && matchesCategory;\n  });\n\n  const handleEdit = (bp: UserBlueprint) => {\n    setEditingBlueprint(bp);\n    setBuilderOpen(true);\n  };\n\n  const handleCreate = () => {\n    setEditingBlueprint(null);\n    setBuilderOpen(true);\n  };\n\n  const handleDelete = (bp: UserBlueprint) => {\n    setBlueprintToDelete(bp);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = () => {\n    if (blueprintToDelete) {\n      deleteMutation.mutate(blueprintToDelete.id);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen pt-16\">\n      <div className=\"max-w-7xl mx-auto px-4 md:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-semibold mb-2\" data-testid=\"text-library-title\">{t.library.title}</h1>\n          <p className=\"text-muted-foreground\">{t.library.subtitle}</p>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"mb-6\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4\">\n            <TabsList>\n              <TabsTrigger value=\"system\" data-testid=\"tab-system-blueprints\">\n                {t.blueprintBuilder?.systemBlueprints || \"System Blueprints\"}\n              </TabsTrigger>\n              <TabsTrigger value=\"my\" data-testid=\"tab-my-blueprints\">\n                {t.blueprintBuilder?.myBlueprints || \"My Blueprints\"}\n                {userBlueprints && userBlueprints.length > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2\">{userBlueprints.length}</Badge>\n                )}\n              </TabsTrigger>\n            </TabsList>\n            \n            {activeTab === \"my\" && (\n              <Button onClick={handleCreate} className=\"gap-2\" data-testid=\"button-create-blueprint\">\n                <Plus className=\"w-4 h-4\" />\n                {t.blueprintBuilder?.createNew || \"Create New\"}\n              </Button>\n            )}\n          </div>\n\n          <div className=\"sticky top-16 z-40 bg-background/80 backdrop-blur-md -mx-4 md:-mx-8 px-4 md:px-8 py-4 border-b border-border mb-8\">\n            <div className=\"flex flex-col md:flex-row gap-4\">\n              <div className=\"relative flex-1 max-w-md\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                <Input\n                  placeholder={t.library.searchPlaceholder}\n                  value={search}\n                  onChange={(e) => setSearch(e.target.value)}\n                  className=\"pl-10\"\n                  data-testid=\"input-search\"\n                />\n              </div>\n              <div className=\"flex gap-2 flex-wrap\">\n                {categories.slice(0, 8).map((cat) => (\n                  <Button\n                    key={cat}\n                    variant={activeCategory === cat ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setActiveCategory(cat)}\n                    data-testid={`button-category-${cat}`}\n                  >\n                    {cat === \"all\" ? t.library.allCategories : cat.charAt(0).toUpperCase() + cat.slice(1)}\n                  </Button>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          <TabsContent value=\"system\" className=\"mt-0\">\n            {isLoading ? (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {[...Array(6)].map((_, i) => (\n                  <Card key={i}>\n                    <Skeleton className=\"h-40 rounded-t-lg\" />\n                    <CardHeader>\n                      <Skeleton className=\"h-6 w-3/4\" />\n                    </CardHeader>\n                    <CardContent>\n                      <Skeleton className=\"h-4 w-full mb-2\" />\n                      <Skeleton className=\"h-4 w-2/3\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : filteredBlueprints?.length === 0 ? (\n              <div className=\"text-center py-16\">\n                <Layers className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-medium mb-2\">{t.library.noResults}</h3>\n                <Button variant=\"outline\" onClick={() => { setSearch(\"\"); setActiveCategory(\"all\"); }}>\n                  Clear filters\n                </Button>\n              </div>\n            ) : (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {filteredBlueprints?.map((blueprint) => {\n                  const IconComponent = categoryIcons[blueprint.category] || Layers;\n                  return (\n                    <Card key={blueprint.id} className=\"group overflow-visible\" data-testid={`card-blueprint-${blueprint.id}`}>\n                      <div className=\"aspect-video bg-gradient-to-br from-primary/10 via-primary/5 to-transparent flex items-center justify-center relative overflow-hidden\">\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent\" />\n                        <IconComponent className=\"w-12 h-12 text-primary/30 group-hover:scale-110 transition-transform\" />\n                      </div>\n                      <CardHeader className=\"pb-2\">\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <CardTitle className=\"text-lg leading-tight\">{blueprint.name}</CardTitle>\n                          <Badge variant=\"secondary\" className=\"shrink-0\">\n                            {blueprint.category}\n                          </Badge>\n                        </div>\n                      </CardHeader>\n                      <CardContent className=\"pb-2\">\n                        <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                          {blueprint.description}\n                        </p>\n                        <div className=\"flex items-center gap-4 mt-3 text-xs text-muted-foreground\">\n                          <span>{(blueprint.blocks as string[])?.length || 0} {t.library.blocks}</span>\n                          <span>{(blueprint.constraints as string[])?.length || 0} constraints</span>\n                        </div>\n                      </CardContent>\n                      <CardFooter>\n                        <Link href={`/studio?blueprint=${blueprint.id}`} className=\"w-full\">\n                          <Button variant=\"outline\" className=\"w-full gap-2\" data-testid={`button-use-blueprint-${blueprint.id}`}>\n                            {t.library.useBlueprint}\n                            <ArrowRight className=\"w-4 h-4\" />\n                          </Button>\n                        </Link>\n                      </CardFooter>\n                    </Card>\n                  );\n                })}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"my\" className=\"mt-0\">\n            {loadingUserBlueprints ? (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {[...Array(3)].map((_, i) => (\n                  <Card key={i}>\n                    <Skeleton className=\"h-40 rounded-t-lg\" />\n                    <CardHeader>\n                      <Skeleton className=\"h-6 w-3/4\" />\n                    </CardHeader>\n                    <CardContent>\n                      <Skeleton className=\"h-4 w-full mb-2\" />\n                      <Skeleton className=\"h-4 w-2/3\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : filteredUserBlueprints?.length === 0 ? (\n              <div className=\"text-center py-16\">\n                <Layers className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-medium mb-2\">\n                  {search || activeCategory !== \"all\" \n                    ? t.library.noResults \n                    : (t.blueprintBuilder?.noUserBlueprints || \"No custom blueprints yet\")}\n                </h3>\n                {!search && activeCategory === \"all\" && (\n                  <p className=\"text-muted-foreground mb-4\">\n                    {t.blueprintBuilder?.createFirstHint || \"Create your first custom blueprint\"}\n                  </p>\n                )}\n                <Button onClick={search || activeCategory !== \"all\" ? () => { setSearch(\"\"); setActiveCategory(\"all\"); } : handleCreate}>\n                  {search || activeCategory !== \"all\" ? \"Clear filters\" : (t.blueprintBuilder?.createNew || \"Create New\")}\n                </Button>\n              </div>\n            ) : (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {filteredUserBlueprints?.map((blueprint) => {\n                  const IconComponent = categoryIcons[blueprint.category] || User;\n                  return (\n                    <Card key={blueprint.id} className=\"group overflow-visible\" data-testid={`card-user-blueprint-${blueprint.id}`}>\n                      <div className=\"aspect-video bg-gradient-to-br from-accent/20 via-accent/10 to-transparent flex items-center justify-center relative overflow-hidden\">\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent\" />\n                        <IconComponent className=\"w-12 h-12 text-accent-foreground/30 group-hover:scale-110 transition-transform\" />\n                        <Badge variant=\"outline\" className=\"absolute top-2 right-2 text-xs\">\n                          v{blueprint.version}\n                        </Badge>\n                      </div>\n                      <CardHeader className=\"pb-2\">\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <CardTitle className=\"text-lg leading-tight\">{blueprint.name}</CardTitle>\n                          <div className=\"flex items-center gap-1\">\n                            <Badge variant=\"secondary\" className=\"shrink-0\">\n                              {blueprint.category}\n                            </Badge>\n                            <DropdownMenu>\n                              <DropdownMenuTrigger asChild>\n                                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid={`button-menu-${blueprint.id}`}>\n                                  <MoreVertical className=\"w-4 h-4\" />\n                                </Button>\n                              </DropdownMenuTrigger>\n                              <DropdownMenuContent align=\"end\">\n                                <DropdownMenuItem onClick={() => handleEdit(blueprint)} data-testid={`button-edit-${blueprint.id}`}>\n                                  <Pencil className=\"w-4 h-4 mr-2\" />\n                                  {t.blueprintBuilder?.edit || \"Edit\"}\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => duplicateMutation.mutate(blueprint.id)} data-testid={`button-duplicate-${blueprint.id}`}>\n                                  <Copy className=\"w-4 h-4 mr-2\" />\n                                  {t.blueprintBuilder?.duplicate || \"Duplicate\"}\n                                </DropdownMenuItem>\n                                <DropdownMenuItem \n                                  onClick={() => handleDelete(blueprint)} \n                                  className=\"text-destructive\"\n                                  data-testid={`button-delete-${blueprint.id}`}\n                                >\n                                  <Trash2 className=\"w-4 h-4 mr-2\" />\n                                  {t.blueprintBuilder?.delete || \"Delete\"}\n                                </DropdownMenuItem>\n                              </DropdownMenuContent>\n                            </DropdownMenu>\n                          </div>\n                        </div>\n                      </CardHeader>\n                      <CardContent className=\"pb-2\">\n                        <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                          {blueprint.description || \"No description\"}\n                        </p>\n                        <div className=\"flex items-center gap-4 mt-3 text-xs text-muted-foreground\">\n                          <span>{blueprint.blocks?.length || 0} {t.library.blocks}</span>\n                          {blueprint.tags?.length > 0 && (\n                            <div className=\"flex gap-1\">\n                              {blueprint.tags.slice(0, 2).map(tag => (\n                                <Badge key={tag} variant=\"outline\" className=\"text-xs\">{tag}</Badge>\n                              ))}\n                              {blueprint.tags.length > 2 && (\n                                <span>+{blueprint.tags.length - 2}</span>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </CardContent>\n                      <CardFooter>\n                        <Link href={`/studio?userBlueprint=${blueprint.id}`} className=\"w-full\">\n                          <Button variant=\"outline\" className=\"w-full gap-2\" data-testid={`button-use-user-blueprint-${blueprint.id}`}>\n                            {t.library.useBlueprint}\n                            <ArrowRight className=\"w-4 h-4\" />\n                          </Button>\n                        </Link>\n                      </CardFooter>\n                    </Card>\n                  );\n                })}\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <BlueprintBuilder \n        open={builderOpen} \n        onOpenChange={(open) => {\n          setBuilderOpen(open);\n          if (!open) setEditingBlueprint(null);\n        }}\n        editData={editingBlueprint}\n      />\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t.blueprintBuilder?.delete || \"Delete\"}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t.blueprintBuilder?.confirmDelete || \"Are you sure you want to delete this blueprint?\"}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">\n              {t.common?.cancel || \"Cancel\"}\n            </AlertDialogCancel>\n            <AlertDialogAction \n              onClick={confirmDelete}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {t.blueprintBuilder?.delete || \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19447,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { compiler } from \"./prompt-engine/compiler\";\nimport { defaultProfiles, defaultBlueprints, defaultBlocks, defaultFilters, defaultBaseModels } from \"./prompt-engine/presets\";\nimport { generateRequestSchema, createUserBlueprintRequestSchema, updateUserBlueprintRequestSchema } from \"@shared/schema\";\nimport { ZodError } from \"zod\";\nimport { registerLoraRoutes } from \"./lora-routes\";\n\nconst DEV_USER_ID = \"dev_user\";\n\nasync function seedDatabase() {\n  const existingProfiles = await storage.getProfiles();\n  if (existingProfiles.length === 0) {\n    console.log(\"Seeding database with initial data...\");\n    \n    for (const profile of defaultProfiles) {\n      await storage.createProfile(profile);\n    }\n    \n    for (const blueprint of defaultBlueprints) {\n      await storage.createBlueprint(blueprint);\n    }\n    \n    for (const block of defaultBlocks) {\n      await storage.createBlock(block);\n    }\n    \n    for (const filter of defaultFilters) {\n      await storage.createFilter({\n        key: filter.key,\n        label: filter.label,\n        schema: filter.schema,\n        effect: filter.effect,\n        isPremium: 0,\n      });\n    }\n    \n    for (const baseModel of defaultBaseModels) {\n      await storage.createBaseModel(baseModel);\n    }\n    \n    console.log(\"Database seeded successfully!\");\n  }\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  await seedDatabase();\n\n  const profiles = await storage.getProfiles();\n  const blueprints = await storage.getBlueprints();\n  const blocks = await storage.getBlocks();\n  const filters = await storage.getFilters();\n  compiler.setData(profiles, blueprints, blocks, filters);\n\n  registerLoraRoutes(app);\n\n  app.get(\"/api/profiles\", async (_req, res) => {\n    try {\n      const profiles = await storage.getProfiles();\n      res.json(profiles);\n    } catch (error) {\n      console.error(\"Error fetching profiles:\", error);\n      res.status(500).json({ error: \"Failed to fetch profiles\" });\n    }\n  });\n\n  app.get(\"/api/blueprints\", async (_req, res) => {\n    try {\n      const blueprints = await storage.getBlueprints();\n      res.json(blueprints);\n    } catch (error) {\n      console.error(\"Error fetching blueprints:\", error);\n      res.status(500).json({ error: \"Failed to fetch blueprints\" });\n    }\n  });\n\n  app.get(\"/api/filters\", async (_req, res) => {\n    try {\n      const filters = await storage.getFilters();\n      res.json(filters);\n    } catch (error) {\n      console.error(\"Error fetching filters:\", error);\n      res.status(500).json({ error: \"Failed to fetch filters\" });\n    }\n  });\n\n  app.get(\"/api/history\", async (_req, res) => {\n    try {\n      const history = await storage.getHistory();\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching history:\", error);\n      res.status(500).json({ error: \"Failed to fetch history\" });\n    }\n  });\n\n  app.post(\"/api/generate\", async (req, res) => {\n    try {\n      const rateLimitKey = req.ip || \"anonymous\";\n      const isAdminOverride = process.env.ADMIN_OVERRIDE === \"true\";\n      \n      const freeGenerationsPerDay = 3;\n      const freeFilterLimit = 3;\n      \n      if (!isAdminOverride) {\n        const canProceed = await storage.checkRateLimit(rateLimitKey, freeGenerationsPerDay, 24 * 60 * 60 * 1000);\n        if (!canProceed) {\n          return res.status(429).json({ \n            error: \"Daily generation limit reached. Upgrade to Pro for unlimited generations.\",\n            isPremiumRequired: true\n          });\n        }\n      }\n\n      const validated = generateRequestSchema.parse(req.body);\n      \n      if (!isAdminOverride) {\n        const premiumFilters = await storage.getFilters();\n        const premiumFilterKeys = premiumFilters.filter(f => f.isPremium === 1).map(f => f.key);\n        const appliedPremiumFilters = Object.keys(validated.filters).filter(k => premiumFilterKeys.includes(k));\n        \n        if (appliedPremiumFilters.length > 0) {\n          return res.status(403).json({ \n            error: `Premium filters detected: ${appliedPremiumFilters.join(\", \")}. Upgrade to Pro to use these filters.`,\n            isPremiumRequired: true\n          });\n        }\n        \n        if (Object.keys(validated.filters).length > freeFilterLimit) {\n          return res.status(403).json({ \n            error: `Free plan limited to ${freeFilterLimit} filters. Upgrade to Pro for unlimited filters.`,\n            isPremiumRequired: true\n          });\n        }\n      }\n\n      const latestProfiles = await storage.getProfiles();\n      const latestBlueprints = await storage.getBlueprints();\n      const latestBlocks = await storage.getBlocks();\n      const latestFilters = await storage.getFilters();\n      compiler.setData(latestProfiles, latestBlueprints, latestBlocks, latestFilters);\n\n      // Handle user blueprints - convert to virtual system blueprint format\n      let effectiveBlueprintId = validated.blueprintId || \"\";\n      if (validated.userBlueprintId) {\n        const userBlueprint = await storage.getUserBlueprint(validated.userBlueprintId);\n        if (!userBlueprint) {\n          return res.status(400).json({ error: \"User blueprint not found\" });\n        }\n        // Get the latest version to access blocks and constraints\n        const latestVersion = await storage.getUserBlueprintLatestVersion(validated.userBlueprintId);\n        if (!latestVersion) {\n          return res.status(400).json({ error: \"User blueprint has no versions\" });\n        }\n        // Register user blueprint in compiler as a virtual system blueprint\n        compiler.registerUserBlueprint({\n          id: userBlueprint.id,\n          name: userBlueprint.name,\n          description: userBlueprint.description || \"\",\n          category: userBlueprint.category,\n          blocks: latestVersion.blocks as string[],\n          constraints: latestVersion.constraints as string[],\n        });\n        effectiveBlueprintId = userBlueprint.id;\n      }\n\n      // Always reset LoRA state before each request to prevent leaking between requests\n      compiler.setActiveLora(null);\n      \n      // Activate LoRA if provided and valid\n      if (validated.loraVersionId) {\n        const loraVersion = await storage.getLoraVersion(validated.loraVersionId);\n        if (!loraVersion) {\n          return res.status(400).json({ error: \"LoRA version not found\" });\n        }\n        if (!loraVersion.artifactUrl) {\n          return res.status(400).json({ error: \"LoRA version not trained yet\" });\n        }\n        const loraModel = await storage.getLoraModel(loraVersion.loraModelId);\n        compiler.setActiveLora({\n          version: loraVersion,\n          weight: validated.loraWeight || 1,\n          triggerWord: loraModel?.name?.toLowerCase().replace(/\\s+/g, \"_\") || \"custom_style\",\n          modelName: loraModel?.name || \"Custom Model\",\n        });\n      }\n\n      const compileInput = {\n        profileId: validated.profileId,\n        blueprintId: effectiveBlueprintId,\n        filters: validated.filters,\n        seed: validated.seed || \"\",\n        subject: validated.subject,\n        context: validated.context,\n        items: validated.items,\n        environment: validated.environment,\n        restrictions: validated.restrictions,\n      };\n\n      // Check if target platform needs Character Pack instead of LoRA syntax\n      let characterPack = null;\n      const loraSupportingPlatforms = [\"flux\", \"sdxl\", \"stable_diffusion\", \"sd1.5\", \"sd_1.5\"];\n      const targetPlatform = validated.targetPlatform?.toLowerCase() || \"\";\n      const platformSupportsLora = loraSupportingPlatforms.some(p => targetPlatform.includes(p));\n      \n      if (validated.loraVersionId && validated.targetPlatform && !platformSupportsLora) {\n        // Generate Character Pack for non-LoRA platforms\n        characterPack = compiler.generateCharacterPack(compileInput, validated.targetPlatform);\n        // Clear LoRA so it doesn't inject syntax into the prompt\n        compiler.setActiveLora(null);\n      }\n\n      const result = compiler.compile(compileInput);\n\n      const savedPrompt = await storage.createGeneratedPrompt({\n        userId: null,\n        profileId: validated.profileId,\n        blueprintId: validated.blueprintId || null,\n        userBlueprintId: validated.userBlueprintId || null,\n        seed: result.seed,\n        input: {\n          subject: validated.subject,\n          context: validated.context,\n          items: validated.items,\n          environment: validated.environment,\n          restrictions: validated.restrictions,\n        },\n        appliedFilters: validated.filters,\n        compiledPrompt: result.compiledPrompt,\n        metadata: result.metadata,\n        score: result.score,\n        warnings: result.warnings,\n      });\n\n      await storage.incrementRateLimit(rateLimitKey);\n\n      // Include Character Pack if generated\n      const response: Record<string, unknown> = { ...savedPrompt };\n      if (characterPack) {\n        response.characterPack = characterPack;\n      }\n\n      res.json(response);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error generating prompt:\", error);\n      res.status(500).json({ error: \"Failed to generate prompt\" });\n    }\n  });\n\n  app.post(\"/api/save-version\", async (req, res) => {\n    try {\n      const { promptId } = req.body;\n      \n      if (!promptId) {\n        return res.status(400).json({ error: \"promptId is required\" });\n      }\n\n      const prompt = await storage.getGeneratedPrompt(promptId);\n      if (!prompt) {\n        return res.status(404).json({ error: \"Prompt not found\" });\n      }\n\n      const existingVersions = await storage.getVersions(promptId);\n      const nextVersion = existingVersions.length + 1;\n\n      const version = await storage.createPromptVersion({\n        generatedPromptId: promptId,\n        version: nextVersion,\n        compiledPrompt: prompt.compiledPrompt,\n        metadata: prompt.metadata as Record<string, unknown>,\n      });\n\n      res.json(version);\n    } catch (error) {\n      console.error(\"Error saving version:\", error);\n      res.status(500).json({ error: \"Failed to save version\" });\n    }\n  });\n\n  app.get(\"/api/prompt/:id\", async (req, res) => {\n    try {\n      const prompt = await storage.getGeneratedPrompt(req.params.id);\n      if (!prompt) {\n        return res.status(404).json({ error: \"Prompt not found\" });\n      }\n      res.json(prompt);\n    } catch (error) {\n      console.error(\"Error fetching prompt:\", error);\n      res.status(500).json({ error: \"Failed to fetch prompt\" });\n    }\n  });\n\n  app.get(\"/api/prompt/:id/versions\", async (req, res) => {\n    try {\n      const versions = await storage.getVersions(req.params.id);\n      res.json(versions);\n    } catch (error) {\n      console.error(\"Error fetching versions:\", error);\n      res.status(500).json({ error: \"Failed to fetch versions\" });\n    }\n  });\n\n  // User Custom Blueprints API\n  const FREE_BLUEPRINT_LIMIT = 2;\n\n  app.get(\"/api/user-blueprints\", async (_req, res) => {\n    try {\n      const userId = DEV_USER_ID;\n      const blueprints = await storage.getUserBlueprints(userId);\n      \n      const blueprintsWithVersions = await Promise.all(\n        blueprints.map(async (bp) => {\n          const latestVersion = await storage.getUserBlueprintLatestVersion(bp.id);\n          return {\n            ...bp,\n            blocks: latestVersion?.blocks || [],\n            constraints: latestVersion?.constraints || [],\n          };\n        })\n      );\n      \n      res.json(blueprintsWithVersions);\n    } catch (error) {\n      console.error(\"Error fetching user blueprints:\", error);\n      res.status(500).json({ error: \"Failed to fetch user blueprints\" });\n    }\n  });\n\n  app.get(\"/api/user-blueprints/:id\", async (req, res) => {\n    try {\n      const userId = DEV_USER_ID;\n      const blueprint = await storage.getUserBlueprint(req.params.id);\n      \n      if (!blueprint) {\n        return res.status(404).json({ error: \"Blueprint not found\" });\n      }\n      \n      if (blueprint.userId !== userId) {\n        return res.status(403).json({ error: \"Access denied\" });\n      }\n      \n      const latestVersion = await storage.getUserBlueprintLatestVersion(blueprint.id);\n      \n      res.json({\n        ...blueprint,\n        blocks: latestVersion?.blocks || [],\n        constraints: latestVersion?.constraints || [],\n      });\n    } catch (error) {\n      console.error(\"Error fetching user blueprint:\", error);\n      res.status(500).json({ error: \"Failed to fetch user blueprint\" });\n    }\n  });\n\n  app.post(\"/api/user-blueprints\", async (req, res) => {\n    try {\n      const userId = DEV_USER_ID;\n      const isAdminOverride = process.env.ADMIN_OVERRIDE === \"true\";\n      \n      if (!isAdminOverride) {\n        const count = await storage.countUserBlueprints(userId);\n        if (count >= FREE_BLUEPRINT_LIMIT) {\n          return res.status(403).json({\n            error: `Free plan limited to ${FREE_BLUEPRINT_LIMIT} custom blueprints. Upgrade to Pro for unlimited.`,\n            isPremiumRequired: true,\n          });\n        }\n      }\n      \n      const validated = createUserBlueprintRequestSchema.parse(req.body);\n      \n      const allBlocks = await storage.getBlocks();\n      const validBlockKeys = allBlocks.map(b => b.key);\n      const invalidBlocks = validated.blocks.filter(b => !validBlockKeys.includes(b));\n      \n      if (invalidBlocks.length > 0) {\n        return res.status(400).json({\n          error: `Invalid block keys: ${invalidBlocks.join(\", \")}`,\n        });\n      }\n      \n      const result = await storage.createUserBlueprint(\n        {\n          userId,\n          name: validated.name,\n          description: validated.description || null,\n          category: validated.category,\n          tags: validated.tags,\n          compatibleProfiles: validated.compatibleProfiles,\n          isActive: 1,\n        },\n        validated.blocks,\n        validated.constraints\n      );\n      \n      res.json({\n        ...result.blueprint,\n        blocks: result.version.blocks,\n        constraints: result.version.constraints,\n      });\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error creating user blueprint:\", error);\n      res.status(500).json({ error: \"Failed to create user blueprint\" });\n    }\n  });\n\n  app.patch(\"/api/user-blueprints/:id\", async (req, res) => {\n    try {\n      const userId = DEV_USER_ID;\n      const validated = updateUserBlueprintRequestSchema.parse(req.body);\n      \n      if (validated.blocks) {\n        const allBlocks = await storage.getBlocks();\n        const validBlockKeys = allBlocks.map(b => b.key);\n        const invalidBlocks = validated.blocks.filter(b => !validBlockKeys.includes(b));\n        \n        if (invalidBlocks.length > 0) {\n          return res.status(400).json({\n            error: `Invalid block keys: ${invalidBlocks.join(\", \")}`,\n          });\n        }\n      }\n      \n      const result = await storage.updateUserBlueprint(\n        req.params.id,\n        userId,\n        {\n          name: validated.name,\n          description: validated.description,\n          category: validated.category,\n          tags: validated.tags,\n          compatibleProfiles: validated.compatibleProfiles,\n        },\n        validated.blocks,\n        validated.constraints\n      );\n      \n      if (!result) {\n        return res.status(404).json({ error: \"Blueprint not found or access denied\" });\n      }\n      \n      res.json({\n        ...result.blueprint,\n        blocks: result.version.blocks,\n        constraints: result.version.constraints,\n      });\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: \"Invalid request\", details: error.errors });\n      }\n      console.error(\"Error updating user blueprint:\", error);\n      res.status(500).json({ error: \"Failed to update user blueprint\" });\n    }\n  });\n\n  app.delete(\"/api/user-blueprints/:id\", async (req, res) => {\n    try {\n      const userId = DEV_USER_ID;\n      const deleted = await storage.deleteUserBlueprint(req.params.id, userId);\n      \n      if (!deleted) {\n        return res.status(404).json({ error: \"Blueprint not found or access denied\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting user blueprint:\", error);\n      res.status(500).json({ error: \"Failed to delete user blueprint\" });\n    }\n  });\n\n  app.get(\"/api/user-blueprints/:id/versions\", async (req, res) => {\n    try {\n      const userId = DEV_USER_ID;\n      const blueprint = await storage.getUserBlueprint(req.params.id);\n      \n      if (!blueprint) {\n        return res.status(404).json({ error: \"Blueprint not found\" });\n      }\n      \n      if (blueprint.userId !== userId) {\n        return res.status(403).json({ error: \"Access denied\" });\n      }\n      \n      const versions = await storage.getUserBlueprintVersions(req.params.id);\n      res.json(versions);\n    } catch (error) {\n      console.error(\"Error fetching blueprint versions:\", error);\n      res.status(500).json({ error: \"Failed to fetch blueprint versions\" });\n    }\n  });\n\n  app.post(\"/api/user-blueprints/:id/duplicate\", async (req, res) => {\n    try {\n      const userId = DEV_USER_ID;\n      const isAdminOverride = process.env.ADMIN_OVERRIDE === \"true\";\n      \n      if (!isAdminOverride) {\n        const count = await storage.countUserBlueprints(userId);\n        if (count >= FREE_BLUEPRINT_LIMIT) {\n          return res.status(403).json({\n            error: `Free plan limited to ${FREE_BLUEPRINT_LIMIT} custom blueprints. Upgrade to Pro for unlimited.`,\n            isPremiumRequired: true,\n          });\n        }\n      }\n      \n      const blueprint = await storage.getUserBlueprint(req.params.id);\n      \n      if (!blueprint) {\n        return res.status(404).json({ error: \"Blueprint not found\" });\n      }\n      \n      if (blueprint.userId !== userId) {\n        return res.status(403).json({ error: \"Access denied\" });\n      }\n      \n      const latestVersion = await storage.getUserBlueprintLatestVersion(blueprint.id);\n      \n      const result = await storage.createUserBlueprint(\n        {\n          userId,\n          name: `${blueprint.name} (Copy)`,\n          description: blueprint.description,\n          category: blueprint.category,\n          tags: blueprint.tags,\n          compatibleProfiles: blueprint.compatibleProfiles,\n          isActive: 1,\n        },\n        latestVersion?.blocks || [],\n        latestVersion?.constraints || []\n      );\n      \n      res.json({\n        ...result.blueprint,\n        blocks: result.version.blocks,\n        constraints: result.version.constraints,\n      });\n    } catch (error) {\n      console.error(\"Error duplicating blueprint:\", error);\n      res.status(500).json({ error: \"Failed to duplicate blueprint\" });\n    }\n  });\n\n  app.get(\"/api/blocks\", async (_req, res) => {\n    try {\n      const blocks = await storage.getBlocks();\n      res.json(blocks);\n    } catch (error) {\n      console.error(\"Error fetching blocks:\", error);\n      res.status(500).json({ error: \"Failed to fetch blocks\" });\n    }\n  });\n\n  // ModelsLab Nano Banana Pro API\n  app.post(\"/api/modelslab/generate\", async (req, res) => {\n    try {\n      const { prompt, images, aspectRatio } = req.body;\n      \n      if (!prompt) {\n        return res.status(400).json({ error: \"Prompt is required\" });\n      }\n      \n      if (!images || !Array.isArray(images) || images.length === 0) {\n        return res.status(400).json({ error: \"At least one image is required\" });\n      }\n      \n      const apiKey = process.env.MODELSLAB_API_KEY;\n      if (!apiKey) {\n        return res.status(500).json({ error: \"ModelsLab API key not configured\" });\n      }\n      \n      // Process images - ModelsLab accepts both URLs and base64\n      // For base64, keep the data URL format as ModelsLab supports it\n      const processedImages = images.map((img: string) => {\n        if (typeof img !== 'string') return '';\n        return img;\n      }).filter((img: string) => img.length > 0);\n      \n      if (processedImages.length === 0) {\n        return res.status(400).json({ error: \"No valid images provided\" });\n      }\n      \n      const response = await fetch(\"https://modelslab.com/api/v7/images/image-to-image\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          key: apiKey,\n          model_id: \"nano-banana-pro\",\n          prompt,\n          init_image: processedImages,\n          aspect_ratio: aspectRatio || \"1:1\",\n        }),\n      });\n      \n      const data = await response.json();\n      \n      if (data.status === \"error\") {\n        console.error(\"ModelsLab error:\", data);\n        return res.status(400).json({ error: data.message || \"ModelsLab API error\" });\n      }\n      \n      res.json(data);\n    } catch (error) {\n      console.error(\"Error calling ModelsLab API:\", error);\n      res.status(500).json({ error: \"Failed to generate image\" });\n    }\n  });\n\n  // Check generation status (for async generation)\n  // Security: Only allow fetching from trusted ModelsLab domains\n  const ALLOWED_MODELSLAB_HOSTS = [\n    \"modelslab.com\",\n    \"api.modelslab.com\",\n    \"stablediffusionapi.com\",\n  ];\n  \n  app.post(\"/api/modelslab/status\", async (req, res) => {\n    try {\n      const { fetchUrl } = req.body;\n      \n      if (!fetchUrl) {\n        return res.status(400).json({ error: \"Fetch URL is required\" });\n      }\n      \n      // Validate URL is from trusted ModelsLab domain\n      let parsedUrl: URL;\n      try {\n        parsedUrl = new URL(fetchUrl);\n      } catch {\n        return res.status(400).json({ error: \"Invalid URL format\" });\n      }\n      \n      const isAllowedHost = ALLOWED_MODELSLAB_HOSTS.some(\n        host => parsedUrl.hostname === host || parsedUrl.hostname.endsWith(`.${host}`)\n      );\n      \n      if (!isAllowedHost) {\n        console.warn(`Blocked SSRF attempt to: ${parsedUrl.hostname}`);\n        return res.status(403).json({ error: \"URL not from trusted ModelsLab domain\" });\n      }\n      \n      const apiKey = process.env.MODELSLAB_API_KEY;\n      if (!apiKey) {\n        return res.status(500).json({ error: \"ModelsLab API key not configured\" });\n      }\n      \n      const response = await fetch(fetchUrl, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          key: apiKey,\n        }),\n      });\n      \n      const data = await response.json();\n      res.json(data);\n    } catch (error) {\n      console.error(\"Error checking ModelsLab status:\", error);\n      res.status(500).json({ error: \"Failed to check status\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":22985,"size_tokens":null},"server/prompt-engine/presets.ts":{"content":"import type { ProfileDefinition, BlueprintDefinition, BlockDefinition, FilterDefinition, BaseModelDefinition } from \"./types\";\n\nexport const defaultProfiles: ProfileDefinition[] = [\n  {\n    name: \"Midjourney V6\",\n    basePrompt: \"Create a highly detailed, professional quality image with cinematic composition.\",\n    preferredOrder: [\"subject\", \"style\", \"camera\", \"layout\", \"postfx\", \"constraint\"],\n    forbiddenPatterns: [\"nsfw\", \"gore\", \"violence\"],\n    maxLength: 2000,\n    capabilities: [\"photorealistic\", \"artistic\", \"stylized\"],\n  },\n  {\n    name: \"DALL-E 3\",\n    basePrompt: \"Gere uma imagem visualmente impactante com ateno cuidadosa aos detalhes e qualidade artstica.\",\n    preferredOrder: [\"subject\", \"layout\", \"style\", \"camera\", \"constraint\", \"postfx\"],\n    forbiddenPatterns: [\"nsfw\", \"gore\"],\n    maxLength: 4000,\n    capabilities: [\"fotorrealista\", \"ilustrao\", \"3d\"],\n  },\n  {\n    name: \"Stable Diffusion XL\",\n    basePrompt: \"Uma imagem magistralmente elaborada demonstrando qualidade tcnica e artstica excepcional.\",\n    preferredOrder: [\"subject\", \"style\", \"postfx\", \"camera\", \"layout\", \"constraint\"],\n    forbiddenPatterns: [],\n    maxLength: 1500,\n    capabilities: [\"fotorrealista\", \"anime\", \"artstico\"],\n  },\n  {\n    name: \"Flux Pro\",\n    basePrompt: \"Ultra high quality, professional grade imagery with exceptional detail and composition.\",\n    preferredOrder: [\"subject\", \"camera\", \"style\", \"layout\", \"postfx\", \"constraint\"],\n    forbiddenPatterns: [\"nsfw\"],\n    maxLength: 2500,\n    capabilities: [\"photorealistic\", \"cinematic\", \"editorial\"],\n  },\n];\n\nexport const defaultBlueprints: BlueprintDefinition[] = [\n  {\n    name: \"Minecraft Style Food\",\n    category: \"gaming\",\n    description: \"Itens de comida em pixel art com esttica Minecraft, texturas blocadas e cores vibrantes\",\n    blocks: [\"pixelart_base\", \"food_subject\", \"minecraft_lighting\", \"game_ui_frame\"],\n    constraints: [\"maintain_blocky_aesthetic\", \"no_smooth_gradients\"],\n    previewDescription: \"Fotografia de comida inspirada em 8-bit\",\n  },\n  {\n    name: \"Analog Collage Refrigerator\",\n    category: \"retro\",\n    description: \"Esttica de colagem vintage com ms de geladeira e estilo de recorte de revista\",\n    blocks: [\"collage_base\", \"vintage_texture\", \"magnet_elements\", \"paper_cutout\"],\n    constraints: [\"visible_paper_edges\", \"imperfect_alignment\"],\n    previewDescription: \"Colagem de recortes de revista anos 70\",\n  },\n  {\n    name: \"Gothic Car Wrap\",\n    category: \"aesthetic\",\n    description: \"Esttica gtica sombria aplicada a envelopamentos de veculos com padres intrincados\",\n    blocks: [\"gothic_pattern\", \"vehicle_surface\", \"dark_lighting\", \"ornate_details\"],\n    constraints: [\"seamless_pattern\", \"vehicle_contour_respect\"],\n    previewDescription: \"Design ornamental escuro para veculos\",\n  },\n  {\n    name: \"Weightless Phone Photo\",\n    category: \"aesthetic\",\n    description: \"Objetos flutuantes e esttica de fotografia de smartphone em gravidade zero\",\n    blocks: [\"floating_objects\", \"smartphone_camera\", \"soft_shadows\", \"clean_background\"],\n    constraints: [\"natural_lighting\", \"physics_defying_but_believable\"],\n    previewDescription: \"Fotografia de produto levitando\",\n  },\n  {\n    name: \"Lookbook 9-Frame\",\n    category: \"fashion\",\n    description: \"Grade de lookbook de moda com 9 poses coordenadas e estilo consistente\",\n    blocks: [\"grid_layout_9\", \"fashion_poses\", \"editorial_lighting\", \"minimal_background\"],\n    constraints: [\"consistent_model\", \"cohesive_color_palette\"],\n    previewDescription: \"Grade editorial de moda 3x3\",\n  },\n  {\n    name: \"CCTV Detection\",\n    category: \"surveillance\",\n    description: \"Esttica de filmagem de cmera de segurana com sobreposies de deteco e marcadores de tempo\",\n    blocks: [\"cctv_camera\", \"detection_overlay\", \"timestamp_hud\", \"grainy_texture\"],\n    constraints: [\"fixed_camera_angle\", \"low_quality_authentic\"],\n    previewDescription: \"Esttica de filmagem de segurana\",\n  },\n  {\n    name: \"MS Paint Screen\",\n    category: \"retro\",\n    description: \"Interface clssica do MS Paint do Windows com esttica de arte digital amadora\",\n    blocks: [\"mspaint_interface\", \"crude_drawing\", \"limited_palette\", \"aliased_edges\"],\n    constraints: [\"16_color_maximum\", \"no_antialiasing\"],\n    previewDescription: \"Esttica do Paint do Windows 95\",\n  },\n  {\n    name: \"Character Creator Screen\",\n    category: \"ui\",\n    description: \"Interface de criao de personagem de videogame com controles deslizantes e opes de customizao\",\n    blocks: [\"ui_panels\", \"character_turntable\", \"customization_sliders\", \"stat_display\"],\n    constraints: [\"game_ui_consistency\", \"readable_interface\"],\n    previewDescription: \"Interface de customizao de RPG\",\n  },\n  {\n    name: \"IG Realistic UGC\",\n    category: \"ugc\",\n    description: \"Selfie ultra-realista de Instagram Story com esttica handheld, poses casuais e textura lo-fi autntica\",\n    blocks: [\"ig_story_base\", \"ig_framing_selfie\", \"ig_story_aesthetic\", \"ig_appearance_neutral\", \"ig_accessory_details\"],\n    constraints: [\"no_text_stickers\", \"raw_story_only\"],\n    previewDescription: \"Selfie autntica de IG Story\",\n  },\n];\n\nexport const defaultBlocks: BlockDefinition[] = [\n  // Minecraft Style Food\n  { key: \"pixelart_base\", label: \"Base Pixel Art\", template: \"estilo pixel art, esttica 8-bit, pixels blocados visveis\", type: \"style\" },\n  { key: \"food_subject\", label: \"Assunto Comida\", template: \"{subject}, apresentao apetitosa, fotografia de comida\", type: \"subject\" },\n  { key: \"minecraft_lighting\", label: \"Iluminao Minecraft\", template: \"sombreamento plano, ocluso de ambiente, iluminao estilo jogo\", type: \"postfx\" },\n  { key: \"game_ui_frame\", label: \"Moldura UI de Jogo\", template: \"moldura de slot de inventrio, borda de interface de jogo\", type: \"layout\" },\n  \n  // Analog Collage Refrigerator\n  { key: \"collage_base\", label: \"Base de Colagem\", template: \"colagem de papel recortado, elementos em camadas, mdia mista\", type: \"style\" },\n  { key: \"vintage_texture\", label: \"Textura Vintage\", template: \"textura de papel envelhecido, leve amarelamento, bordas gastas\", type: \"postfx\" },\n  { key: \"magnet_elements\", label: \"Elementos de m\", template: \"ms de geladeira, ms de letras, clipes magnticos\", type: \"subject\" },\n  { key: \"paper_cutout\", label: \"Recorte de Papel\", template: \"recortes de revista, bordas de tesoura, cola visvel\", type: \"style\" },\n  \n  // Gothic Car Wrap\n  { key: \"gothic_pattern\", label: \"Padro Gtico\", template: \"padres gticos intrincados, design ornamental escuro, inspirado em catedral\", type: \"style\" },\n  { key: \"vehicle_surface\", label: \"Superfcie de Veculo\", template: \"envelopamento de carroceria, contornos do veculo, superfcie automotiva\", type: \"subject\" },\n  { key: \"dark_lighting\", label: \"Iluminao Escura\", template: \"iluminao dramtica low-key, sombras profundas, atmosfera sombria\", type: \"camera\" },\n  { key: \"ornate_details\", label: \"Detalhes Ornamentais\", template: \"padres de filigrana, elementos barrocos, embelezamentos detalhados\", type: \"style\" },\n  \n  // Weightless Phone Photo\n  { key: \"floating_objects\", label: \"Objetos Flutuantes\", template: \"objetos levitando, gravidade zero, suspensos no ar\", type: \"subject\" },\n  { key: \"smartphone_camera\", label: \"Cmera de Smartphone\", template: \"fotografia de smartphone, qualidade de cmera mobile, enquadramento casual\", type: \"camera\" },\n  { key: \"soft_shadows\", label: \"Sombras Suaves\", template: \"sombras difusas suaves, queda de luz gentil\", type: \"postfx\" },\n  { key: \"clean_background\", label: \"Fundo Limpo\", template: \"fundo minimalista, pano de fundo de cor slida, ambiente de estdio\", type: \"layout\" },\n  \n  // Lookbook 9-Frame\n  { key: \"grid_layout_9\", label: \"Grade de 9 Quadros\", template: \"layout de grade 3x3, nove quadros iguais, espaamento consistente\", type: \"layout\" },\n  { key: \"fashion_poses\", label: \"Poses de Moda\", template: \"poses editoriais, postura de modelo de moda, poses profissionais\", type: \"subject\" },\n  { key: \"editorial_lighting\", label: \"Iluminao Editorial\", template: \"iluminao de fotografia de moda, beauty dish, luz de contorno\", type: \"camera\" },\n  { key: \"minimal_background\", label: \"Fundo Minimalista\", template: \"fundo limpo, papel seamless, tons neutros\", type: \"layout\" },\n  \n  // CCTV Detection\n  { key: \"cctv_camera\", label: \"Cmera CCTV\", template: \"viso de cmera de segurana, distoro grande angular, ngulo superior\", type: \"camera\" },\n  { key: \"detection_overlay\", label: \"Sobreposio de Deteco\", template: \"caixas delimitadoras, indicadores de rastreamento, marcadores de deteco\", type: \"postfx\" },\n  { key: \"timestamp_hud\", label: \"HUD de Timestamp\", template: \"sobreposio de data e hora, ID da cmera, indicador de gravao\", type: \"postfx\" },\n  { key: \"grainy_texture\", label: \"Textura Granulada\", template: \"rudo de vdeo, artefatos de compresso, baixa resoluo\", type: \"postfx\" },\n  \n  // MS Paint Screen\n  { key: \"mspaint_interface\", label: \"Interface MS Paint\", template: \"Interface do Paint do Windows 95, barra de ferramentas visvel, rea de tela\", type: \"layout\" },\n  { key: \"crude_drawing\", label: \"Desenho Amador\", template: \"desenho digital amador, linhas tremidas, formas bsicas\", type: \"style\" },\n  { key: \"limited_palette\", label: \"Paleta Limitada\", template: \"paleta de 16 cores, cores padro do Windows, tons bsicos\", type: \"style\" },\n  { key: \"aliased_edges\", label: \"Bordas Serrilhadas\", template: \"sem anti-aliasing, bordas serrilhadas, linhas pixel-perfect\", type: \"postfx\" },\n  \n  // Character Creator Screen\n  { key: \"ui_panels\", label: \"Painis de Interface\", template: \"painis de interface de jogo, janelas de menu, caixas de opes\", type: \"layout\" },\n  { key: \"character_turntable\", label: \"Visualizao do Personagem\", template: \"pr-visualizao do personagem, viso rotativa, exibio de modelo 3D\", type: \"subject\" },\n  { key: \"customization_sliders\", label: \"Controles Deslizantes\", template: \"controles deslizantes, barras de ajuste, indicadores de valor\", type: \"layout\" },\n  { key: \"stat_display\", label: \"Exibio de Atributos\", template: \"estatsticas do personagem, valores de atributos, nmeros de habilidade\", type: \"layout\" },\n  \n  // IG Realistic UGC\n  { key: \"ig_story_base\", label: \"Base IG Story\", template: \"selfie vertical 9:16 ultra-realista handheld, estilo autntico de IG-story, leve desfoque de movimento, textura lo-fi suave, iluminao interna quente, textura de pele fotorrealista, imperfeies naturais\", type: \"style\" },\n  { key: \"ig_framing_selfie\", label: \"Enquadramento Selfie IG\", template: \"selfie vertical close-up preenchendo a maior parte do frame do story, cmera muito prxima do rosto, ngulo handheld imperfeito, pose casual relaxada, expresso natural confiante, contato visual direto com a cmera\", type: \"camera\" },\n  { key: \"ig_story_aesthetic\", label: \"Esttica IG Story\", template: \"realismo de IG-story, exposio levemente varivel, profundidade de campo rasa, gro sutil, bordas levemente suavizadas de smartphone, sem polimento cinematogrfico, qualidade autntica de cmera de celular\", type: \"postfx\" },\n  { key: \"ig_appearance_neutral\", label: \"Aparncia Neutra IG\", template: \"pessoa fotorrealista, textura de pele natural com poros e imperfeies sutis, identidade e caractersticas determinadas apenas pela imagem de referncia, sem estilizao\", type: \"subject\" },\n  { key: \"ig_accessory_details\", label: \"Detalhes Acessrios IG\", template: \"acessrios casuais conforme apropriado, roupas naturais visveis nos ombros, fundo interno neutro suavemente desfocado, iluminao ambiente autntica\", type: \"subject\" },\n  { key: \"no_text_stickers\", label: \"Sem Texto/Stickers\", template: \"sem texto na tela, sem stickers, apenas a selfie crua estilo story\", type: \"constraint\" },\n  { key: \"raw_story_only\", label: \"Apenas Story Bruto\", template: \"captura de story autntica sem edio, sem filtros aplicados, sem sobreposies\", type: \"constraint\" },\n];\n\nexport const defaultFilters: FilterDefinition[] = [\n  {\n    key: \"aesthetic_intensity\",\n    label: \"Aesthetic Intensity\",\n    schema: { type: \"select\", options: [\"low\", \"medium\", \"high\", \"extreme\"] },\n    effect: {\n      low: \"subtle stylization\",\n      medium: \"moderate artistic enhancement\",\n      high: \"strong aesthetic treatment\",\n      extreme: \"maximum stylization, highly artistic\",\n    },\n  },\n  {\n    key: \"ugc_realism\",\n    label: \"UGC Realism\",\n    schema: { type: \"select\", options: [\"phone\", \"ugc\", \"pro\", \"cinematic\"] },\n    effect: {\n      phone: \"smartphone quality, casual snapshot\",\n      ugc: \"user generated content look, authentic amateur\",\n      pro: \"professional photography quality\",\n      cinematic: \"cinema camera quality, film look\",\n    },\n  },\n  {\n    key: \"layout_entropy\",\n    label: \"Layout Entropy\",\n    schema: { type: \"select\", options: [\"strict\", \"balanced\", \"loose\"] },\n    effect: {\n      strict: \"rigid composition, rule of thirds\",\n      balanced: \"harmonious arrangement, natural flow\",\n      loose: \"organic placement, creative chaos\",\n    },\n  },\n  {\n    key: \"camera_bias\",\n    label: \"Camera Bias\",\n    schema: { type: \"select\", options: [\"iphone\", \"cctv\", \"dslr\", \"camcorder_2000s\"] },\n    effect: {\n      iphone: \"iPhone camera characteristics, portrait mode\",\n      cctv: \"security camera look, fisheye distortion\",\n      dslr: \"professional DSLR quality, shallow depth of field\",\n      camcorder_2000s: \"early 2000s camcorder, SD quality\",\n    },\n  },\n  {\n    key: \"temporal_style\",\n    label: \"Temporal Style\",\n    schema: { type: \"select\", options: [\"y2k\", \"2000s_jp_tv\", \"modern\", \"retro_future\"] },\n    effect: {\n      y2k: \"Y2K aesthetic, early internet era\",\n      \"2000s_jp_tv\": \"Japanese TV broadcast 2000s, variety show aesthetic\",\n      modern: \"contemporary clean aesthetic\",\n      retro_future: \"retrofuturism, vintage sci-fi\",\n    },\n  },\n  {\n    key: \"prompt_length\",\n    label: \"Prompt Length\",\n    schema: { type: \"select\", options: [\"short\", \"normal\", \"long\"] },\n    effect: {\n      short: \"concise description\",\n      normal: \"standard detail level\",\n      long: \"extended detailed description\",\n    },\n  },\n];\n\nexport const defaultBaseModels: BaseModelDefinition[] = [\n  {\n    name: \"sdxl_1.0\",\n    displayName: \"Stable Diffusion XL 1.0\",\n    loraFormat: \"safetensors\",\n    defaultResolution: 1024,\n    isActive: 1,\n  },\n  {\n    name: \"flux_pro\",\n    displayName: \"Flux Pro\",\n    loraFormat: \"safetensors\",\n    defaultResolution: 1024,\n    isActive: 1,\n  },\n  {\n    name: \"sd_1.5\",\n    displayName: \"Stable Diffusion 1.5\",\n    loraFormat: \"safetensors\",\n    defaultResolution: 512,\n    isActive: 1,\n  },\n];\n","path":null,"size_bytes":14829,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, jsonb, timestamp, pgEnum, real } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const userPlanEnum = pgEnum(\"user_plan\", [\"free\", \"pro\"]);\nexport const blockTypeEnum = pgEnum(\"block_type\", [\"style\", \"camera\", \"layout\", \"constraint\", \"postfx\", \"subject\"]);\nexport const loraJobStatusEnum = pgEnum(\"lora_job_status\", [\"pending\", \"processing\", \"completed\", \"failed\", \"cancelled\"]);\nexport const loraProviderEnum = pgEnum(\"lora_provider\", [\"webhook_worker\", \"replicate\", \"runpod\"]);\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  plan: userPlanEnum(\"plan\").default(\"free\").notNull(),\n  generationsToday: integer(\"generations_today\").default(0).notNull(),\n  lastGenerationDate: text(\"last_generation_date\"),\n});\n\nexport const llmProfiles = pgTable(\"llm_profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().unique(),\n  basePrompt: text(\"base_prompt\").notNull(),\n  preferredOrder: jsonb(\"preferred_order\").$type<string[]>().default([]),\n  forbiddenPatterns: jsonb(\"forbidden_patterns\").$type<string[]>().default([]),\n  maxLength: integer(\"max_length\").default(2000).notNull(),\n  capabilities: jsonb(\"capabilities\").$type<string[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const promptBlueprints = pgTable(\"prompt_blueprints\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().unique(),\n  category: text(\"category\").notNull(),\n  description: text(\"description\").notNull(),\n  blocks: jsonb(\"blocks\").$type<string[]>().notNull(),\n  constraints: jsonb(\"constraints\").$type<string[]>().default([]),\n  previewDescription: text(\"preview_description\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const promptBlocks = pgTable(\"prompt_blocks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").notNull().unique(),\n  label: text(\"label\").notNull(),\n  template: text(\"template\").notNull(),\n  type: blockTypeEnum(\"type\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const filters = pgTable(\"filters\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").notNull().unique(),\n  label: text(\"label\").notNull(),\n  schema: jsonb(\"schema\").$type<{ type: string; options?: string[]; min?: number; max?: number }>().notNull(),\n  effect: jsonb(\"effect\").$type<Record<string, string>>().notNull(),\n  isPremium: integer(\"is_premium\").default(0).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const generatedPrompts = pgTable(\"generated_prompts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\"),\n  profileId: varchar(\"profile_id\").notNull(),\n  blueprintId: varchar(\"blueprint_id\"),\n  userBlueprintId: varchar(\"user_blueprint_id\"),\n  seed: text(\"seed\").notNull(),\n  input: jsonb(\"input\").$type<{\n    subject?: string;\n    context?: string;\n    items?: string;\n    environment?: string;\n    restrictions?: string;\n  }>().notNull(),\n  appliedFilters: jsonb(\"applied_filters\").$type<Record<string, string>>().default({}),\n  compiledPrompt: text(\"compiled_prompt\").notNull(),\n  metadata: jsonb(\"metadata\").$type<{\n    profileName: string;\n    blueprintName: string;\n    blockCount: number;\n    filterCount: number;\n  }>().notNull(),\n  score: integer(\"score\").notNull(),\n  warnings: jsonb(\"warnings\").$type<string[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const promptVersions = pgTable(\"prompt_versions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  generatedPromptId: varchar(\"generated_prompt_id\").notNull(),\n  version: integer(\"version\").notNull(),\n  compiledPrompt: text(\"compiled_prompt\").notNull(),\n  metadata: jsonb(\"metadata\").$type<Record<string, unknown>>().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const rateLimits = pgTable(\"rate_limits\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").notNull().unique(),\n  windowStart: timestamp(\"window_start\").notNull(),\n  count: integer(\"count\").default(0).notNull(),\n});\n\nexport const loraModels = pgTable(\"lora_models\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  consentGiven: integer(\"consent_given\").default(0).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const loraDatasets = pgTable(\"lora_datasets\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  loraModelId: varchar(\"lora_model_id\").notNull(),\n  datasetUrl: text(\"dataset_url\"),\n  datasetHash: text(\"dataset_hash\"),\n  imageCount: integer(\"image_count\").default(0).notNull(),\n  qualityReport: jsonb(\"quality_report\").$type<{\n    valid: boolean;\n    imageCount: number;\n    minResolution: { width: number; height: number };\n    duplicatesFound: number;\n    varietyScore: number;\n    issues: string[];\n    score: number;\n  }>(),\n  status: text(\"status\").default(\"pending\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const loraDatasetItems = pgTable(\"lora_dataset_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  datasetId: varchar(\"dataset_id\").notNull(),\n  storageKey: text(\"storage_key\").notNull(),\n  sha256: text(\"sha256\").notNull(),\n  width: integer(\"width\").notNull(),\n  height: integer(\"height\").notNull(),\n  filename: text(\"filename\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const loraVersions = pgTable(\"lora_versions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  loraModelId: varchar(\"lora_model_id\").notNull(),\n  baseModel: text(\"base_model\").notNull(),\n  params: jsonb(\"params\").$type<{\n    steps: number;\n    learningRate: number;\n    resolution: number;\n    rank: number;\n    networkAlpha?: number;\n  }>().notNull(),\n  datasetHash: text(\"dataset_hash\").notNull(),\n  artifactUrl: text(\"artifact_url\"),\n  checksum: text(\"checksum\"),\n  previewImages: jsonb(\"preview_images\").$type<string[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const loraJobs = pgTable(\"lora_jobs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  loraVersionId: varchar(\"lora_version_id\").notNull(),\n  provider: loraProviderEnum(\"provider\").default(\"webhook_worker\").notNull(),\n  status: loraJobStatusEnum(\"status\").default(\"pending\").notNull(),\n  externalJobId: text(\"external_job_id\"),\n  logsUrl: text(\"logs_url\"),\n  error: text(\"error\"),\n  startedAt: timestamp(\"started_at\"),\n  finishedAt: timestamp(\"finished_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const userLoraActive = pgTable(\"user_lora_active\", {\n  userId: varchar(\"user_id\").primaryKey(),\n  loraModelId: varchar(\"lora_model_id\").notNull(),\n  loraVersionId: varchar(\"lora_version_id\").notNull(),\n  weight: real(\"weight\").default(0.8).notNull(),\n  targetPlatform: text(\"target_platform\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const baseModels = pgTable(\"base_models\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().unique(),\n  displayName: text(\"display_name\").notNull(),\n  loraFormat: text(\"lora_format\").notNull(),\n  defaultResolution: integer(\"default_resolution\").default(1024).notNull(),\n  isActive: integer(\"is_active\").default(1).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// User Custom Blueprints\nexport const userBlueprints = pgTable(\"user_blueprints\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  category: text(\"category\").notNull(),\n  tags: jsonb(\"tags\").$type<string[]>().default([]),\n  compatibleProfiles: jsonb(\"compatible_profiles\").$type<string[]>().default([]),\n  version: integer(\"version\").default(1).notNull(),\n  isActive: integer(\"is_active\").default(1).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const userBlueprintVersions = pgTable(\"user_blueprint_versions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  blueprintId: varchar(\"blueprint_id\").notNull(),\n  version: integer(\"version\").notNull(),\n  blocks: jsonb(\"blocks\").$type<string[]>().notNull(),\n  constraints: jsonb(\"constraints\").$type<string[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const usersRelations = relations(users, ({ many, one }) => ({\n  generatedPrompts: many(generatedPrompts),\n  loraModels: many(loraModels),\n  activeLora: one(userLoraActive, { fields: [users.id], references: [userLoraActive.userId] }),\n}));\n\nexport const generatedPromptsRelations = relations(generatedPrompts, ({ one, many }) => ({\n  user: one(users, { fields: [generatedPrompts.userId], references: [users.id] }),\n  profile: one(llmProfiles, { fields: [generatedPrompts.profileId], references: [llmProfiles.id] }),\n  blueprint: one(promptBlueprints, { fields: [generatedPrompts.blueprintId], references: [promptBlueprints.id] }),\n  versions: many(promptVersions),\n}));\n\nexport const promptVersionsRelations = relations(promptVersions, ({ one }) => ({\n  generatedPrompt: one(generatedPrompts, { fields: [promptVersions.generatedPromptId], references: [generatedPrompts.id] }),\n}));\n\nexport const loraModelsRelations = relations(loraModels, ({ one, many }) => ({\n  user: one(users, { fields: [loraModels.userId], references: [users.id] }),\n  datasets: many(loraDatasets),\n  versions: many(loraVersions),\n}));\n\nexport const loraDatasetsRelations = relations(loraDatasets, ({ one, many }) => ({\n  user: one(users, { fields: [loraDatasets.userId], references: [users.id] }),\n  loraModel: one(loraModels, { fields: [loraDatasets.loraModelId], references: [loraModels.id] }),\n  items: many(loraDatasetItems),\n}));\n\nexport const loraDatasetItemsRelations = relations(loraDatasetItems, ({ one }) => ({\n  dataset: one(loraDatasets, { fields: [loraDatasetItems.datasetId], references: [loraDatasets.id] }),\n}));\n\nexport const loraVersionsRelations = relations(loraVersions, ({ one, many }) => ({\n  loraModel: one(loraModels, { fields: [loraVersions.loraModelId], references: [loraModels.id] }),\n  jobs: many(loraJobs),\n}));\n\nexport const loraJobsRelations = relations(loraJobs, ({ one }) => ({\n  loraVersion: one(loraVersions, { fields: [loraJobs.loraVersionId], references: [loraVersions.id] }),\n}));\n\nexport const userLoraActiveRelations = relations(userLoraActive, ({ one }) => ({\n  user: one(users, { fields: [userLoraActive.userId], references: [users.id] }),\n  loraVersion: one(loraVersions, { fields: [userLoraActive.loraVersionId], references: [loraVersions.id] }),\n}));\n\nexport const userBlueprintsRelations = relations(userBlueprints, ({ one, many }) => ({\n  user: one(users, { fields: [userBlueprints.userId], references: [users.id] }),\n  versions: many(userBlueprintVersions),\n}));\n\nexport const userBlueprintVersionsRelations = relations(userBlueprintVersions, ({ one }) => ({\n  blueprint: one(userBlueprints, { fields: [userBlueprintVersions.blueprintId], references: [userBlueprints.id] }),\n}));\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport const insertLlmProfileSchema = createInsertSchema(llmProfiles).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertBlueprintSchema = createInsertSchema(promptBlueprints).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertBlockSchema = createInsertSchema(promptBlocks).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertFilterSchema = createInsertSchema(filters).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertGeneratedPromptSchema = createInsertSchema(generatedPrompts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertPromptVersionSchema = createInsertSchema(promptVersions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const generateRequestSchema = z.object({\n  profileId: z.string().min(1),\n  blueprintId: z.string().optional(),\n  userBlueprintId: z.string().optional(),\n  filters: z.record(z.string(), z.string()).optional().default({}),\n  seed: z.string().optional(),\n  subject: z.string().optional().default(\"\"),\n  context: z.string().optional().default(\"\"),\n  items: z.string().optional().default(\"\"),\n  environment: z.string().optional().default(\"\"),\n  restrictions: z.string().optional().default(\"\"),\n  loraVersionId: z.string().optional(),\n  loraWeight: z.number().min(0).max(2).optional().default(1),\n  targetPlatform: z.string().optional(),\n}).refine(data => data.blueprintId || data.userBlueprintId, {\n  message: \"Either blueprintId or userBlueprintId is required\",\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type LlmProfile = typeof llmProfiles.$inferSelect;\nexport type InsertLlmProfile = z.infer<typeof insertLlmProfileSchema>;\nexport type PromptBlueprint = typeof promptBlueprints.$inferSelect;\nexport type InsertBlueprint = z.infer<typeof insertBlueprintSchema>;\nexport type PromptBlock = typeof promptBlocks.$inferSelect;\nexport type InsertBlock = z.infer<typeof insertBlockSchema>;\nexport type Filter = typeof filters.$inferSelect;\nexport type InsertFilter = z.infer<typeof insertFilterSchema>;\nexport type GeneratedPrompt = typeof generatedPrompts.$inferSelect;\nexport type InsertGeneratedPrompt = z.infer<typeof insertGeneratedPromptSchema>;\nexport type PromptVersion = typeof promptVersions.$inferSelect;\nexport type InsertPromptVersion = z.infer<typeof insertPromptVersionSchema>;\nexport type GenerateRequest = z.infer<typeof generateRequestSchema>;\n\nexport const insertLoraModelSchema = createInsertSchema(loraModels).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLoraDatasetSchema = createInsertSchema(loraDatasets).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLoraVersionSchema = createInsertSchema(loraVersions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLoraJobSchema = createInsertSchema(loraJobs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertBaseModelSchema = createInsertSchema(baseModels).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const createLoraModelRequestSchema = z.object({\n  name: z.string().min(1).max(100),\n  description: z.string().max(500).optional(),\n  consent: z.boolean().refine(val => val === true, {\n    message: \"You must confirm that you have rights to use these images\",\n  }),\n});\n\nexport const initDatasetRequestSchema = z.object({\n  loraModelId: z.string().min(1),\n  imageCount: z.number().min(15).max(50),\n  filenames: z.array(z.string()).min(15).max(50),\n});\n\nexport const commitDatasetRequestSchema = z.object({\n  datasetId: z.string().min(1),\n  items: z.array(z.object({\n    storageKey: z.string().min(1),\n    sha256: z.string().min(1),\n    width: z.number().min(256).max(4096),\n    height: z.number().min(256).max(4096),\n    filename: z.string().optional(),\n  })).min(15).max(50),\n});\n\nexport const validateDatasetRequestSchema = z.object({\n  datasetId: z.string().min(1),\n});\n\nexport const createLoraJobRequestSchema = z.object({\n  loraModelId: z.string().min(1),\n  datasetId: z.string().min(1),\n  baseModel: z.string().min(1),\n  params: z.object({\n    steps: z.number().min(100).max(5000).default(1000),\n    learningRate: z.number().min(0.00001).max(0.01).default(0.0001),\n    resolution: z.number().min(512).max(2048).default(1024),\n    rank: z.number().min(4).max(128).default(32),\n    networkAlpha: z.number().optional(),\n  }),\n});\n\nexport const webhookPayloadSchema = z.object({\n  jobId: z.string().min(1),\n  status: z.enum([\"processing\", \"completed\", \"failed\"]),\n  artifactUrl: z.string().url().optional(),\n  checksum: z.string().optional(),\n  logsUrl: z.string().url().optional(),\n  error: z.string().optional(),\n  previewImages: z.array(z.string().url()).optional(),\n});\n\nexport const activateLoraRequestSchema = z.object({\n  loraVersionId: z.string().min(1),\n  weight: z.number().min(0).max(1.5).default(0.8),\n  targetPlatform: z.string().optional(),\n});\n\nexport type LoraModel = typeof loraModels.$inferSelect;\nexport type InsertLoraModel = z.infer<typeof insertLoraModelSchema>;\nexport type LoraDataset = typeof loraDatasets.$inferSelect;\nexport type InsertLoraDataset = z.infer<typeof insertLoraDatasetSchema>;\nexport type LoraVersion = typeof loraVersions.$inferSelect;\nexport type InsertLoraVersion = z.infer<typeof insertLoraVersionSchema>;\nexport type LoraJob = typeof loraJobs.$inferSelect;\nexport type InsertLoraJob = z.infer<typeof insertLoraJobSchema>;\nexport type UserLoraActive = typeof userLoraActive.$inferSelect;\nexport type BaseModel = typeof baseModels.$inferSelect;\nexport type InsertBaseModel = z.infer<typeof insertBaseModelSchema>;\nexport type LoraDatasetItem = typeof loraDatasetItems.$inferSelect;\nexport type CreateLoraModelRequest = z.infer<typeof createLoraModelRequestSchema>;\nexport type InitDatasetRequest = z.infer<typeof initDatasetRequestSchema>;\nexport type CommitDatasetRequest = z.infer<typeof commitDatasetRequestSchema>;\nexport type CreateLoraJobRequest = z.infer<typeof createLoraJobRequestSchema>;\nexport type WebhookPayload = z.infer<typeof webhookPayloadSchema>;\nexport type ActivateLoraRequest = z.infer<typeof activateLoraRequestSchema>;\n\n// User Blueprint schemas\nexport const insertUserBlueprintSchema = createInsertSchema(userBlueprints).omit({\n  id: true,\n  version: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserBlueprintVersionSchema = createInsertSchema(userBlueprintVersions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const createUserBlueprintRequestSchema = z.object({\n  name: z.string().min(1).max(100),\n  description: z.string().max(500).optional(),\n  category: z.string().min(1),\n  tags: z.array(z.string()).default([]),\n  blocks: z.array(z.string()).min(1),\n  constraints: z.array(z.string()).default([]),\n  compatibleProfiles: z.array(z.string()).default([]),\n});\n\nexport const updateUserBlueprintRequestSchema = z.object({\n  name: z.string().min(1).max(100).optional(),\n  description: z.string().max(500).optional(),\n  category: z.string().min(1).optional(),\n  tags: z.array(z.string()).optional(),\n  blocks: z.array(z.string()).min(1).optional(),\n  constraints: z.array(z.string()).optional(),\n  compatibleProfiles: z.array(z.string()).optional(),\n});\n\nexport type UserBlueprint = typeof userBlueprints.$inferSelect;\nexport type InsertUserBlueprint = z.infer<typeof insertUserBlueprintSchema>;\nexport type UserBlueprintVersion = typeof userBlueprintVersions.$inferSelect;\nexport type InsertUserBlueprintVersion = z.infer<typeof insertUserBlueprintVersionSchema>;\nexport type CreateUserBlueprintRequest = z.infer<typeof createUserBlueprintRequestSchema>;\nexport type UpdateUserBlueprintRequest = z.infer<typeof updateUserBlueprintRequestSchema>;\n","path":null,"size_bytes":19554,"size_tokens":null},"replit.md":{"content":"# PromptForge - Infinite Prompt Generator\n\n## Overview\nPromptForge is a professional prompt engineering studio with blueprints, filters, and reproducible seeds for generating production-grade prompts for any LLM.\n\n## Tech Stack\n- **Frontend**: React + Vite + TypeScript\n- **Backend**: Express.js\n- **Database**: PostgreSQL with Drizzle ORM\n- **UI**: Tailwind CSS + shadcn/ui components\n- **Fonts**: Inter (UI), JetBrains Mono (code/technical)\n\n## Project Structure\n```\n client/src/\n    components/     # Reusable UI components\n       ui/         # shadcn components\n       header.tsx  # Navigation header\n       theme-provider.tsx\n    pages/          # Route pages\n       landing.tsx # Home page with hero/features/pricing\n       studio.tsx  # Main prompt generation workspace\n       library.tsx # Blueprint browser\n       history.tsx # Generation history\n    hooks/          # Custom React hooks\n    lib/            # Utilities\n    App.tsx         # Main router\n server/\n    prompt-engine/  # Core engine\n       compiler.ts # Prompt compilation logic\n       presets.ts  # Default profiles, blueprints, blocks, filters\n       types.ts    # TypeScript interfaces\n       system-prompt.ts\n    routes.ts       # API endpoints\n    storage.ts      # Database operations\n    db.ts           # Database connection\n shared/\n    schema.ts       # Drizzle schema + Zod validation\n design_guidelines.md\n```\n\n## Environment Variables\n- `DATABASE_URL` - PostgreSQL connection string (auto-configured)\n- `ADMIN_OVERRIDE` - Set to \"true\" to bypass premium limits (development)\n- `MODELSLAB_API_KEY` - API key for ModelsLab image generation\n\n## API Endpoints\n\n### Prompt Generation\n- `GET /api/profiles` - List LLM profiles\n- `GET /api/blueprints` - List prompt blueprints\n- `GET /api/filters` - List available filters\n- `GET /api/history` - Get generation history\n- `POST /api/generate` - Generate a prompt\n- `POST /api/save-version` - Save a prompt version\n- `GET /api/prompt/:id` - Get specific prompt\n- `GET /api/prompt/:id/versions` - Get prompt versions\n\n### ModelsLab Image Generation\n- `POST /api/modelslab/generate` - Generate images using Nano Banana Pro model\n- `POST /api/modelslab/status` - Check async generation status (SSRF-protected)\n\n### LoRA Training (Pro-only)\n- `GET /api/lora/models` - List user's LoRA models\n- `GET /api/lora/models/:id` - Get LoRA model with datasets and versions\n- `POST /api/lora/models` - Create new LoRA model\n- `POST /api/lora/dataset/init` - Initialize dataset upload (returns presigned URL)\n- `POST /api/lora/dataset/validate` - Validate uploaded dataset\n- `POST /api/lora/jobs` - Start LoRA training job\n- `GET /api/lora/jobs/:id` - Get training job status\n- `POST /api/lora/webhook` - GPU worker webhook callback\n- `POST /api/lora/activate` - Activate a trained LoRA for prompt generation\n- `GET /api/lora/active` - Get currently active LoRA\n- `DELETE /api/lora/active` - Deactivate LoRA\n- `GET /api/lora/base-models` - List available base models\n\n## Core Concepts\n\n### LLM Profiles\nPre-configured settings for different LLMs (Midjourney, DALL-E, Stable Diffusion, Flux Pro) with base prompts, preferred block ordering, and output limits.\n\n### Blueprints\nTemplate collections defining prompt structure for specific use cases:\n- Minecraft Style Food\n- Analog Collage Refrigerator\n- Gothic Car Wrap\n- Weightless Phone Photo\n- Lookbook 9-Frame\n- CCTV Detection\n- MS Paint Screen\n- Character Creator Screen\n- IG Realistic UGC (Instagram Story selfie with handheld aesthetic)\n\n### Filters\nAdjustable parameters that modify prompt output:\n- aesthetic_intensity (low/medium/high/extreme)\n- ugc_realism (phone/ugc/pro/cinematic)\n- layout_entropy (strict/balanced/loose)\n- camera_bias (iphone/cctv/dslr/camcorder_2000s)\n- temporal_style (y2k/2000s_jp_tv/modern/retro_future)\n- prompt_length (short/normal/long)\n\n### Seeds\nDeterministic seeds enable reproducible prompt generation.\n\n## Premium Gating (MVP)\n- Free tier: 3 generations/day, max 3 filters\n- Pro tier: Unlimited (via ADMIN_OVERRIDE=true)\n\n## Running Locally\n```bash\nnpm run dev          # Start development server\nnpm run db:push      # Push schema changes to database\n```\n\n## Adding New Content\n\n### Adding an LLM Profile\nAdd to `server/prompt-engine/presets.ts`:\n```typescript\n{\n  name: \"Profile Name\",\n  basePrompt: \"Base instruction...\",\n  preferredOrder: [\"subject\", \"style\", ...],\n  forbiddenPatterns: [],\n  maxLength: 2000,\n  capabilities: [\"photorealistic\", \"artistic\"]\n}\n```\n\n### Adding a Blueprint\nAdd to `server/prompt-engine/presets.ts`:\n```typescript\n{\n  name: \"Blueprint Name\",\n  category: \"aesthetic\",\n  description: \"Description...\",\n  blocks: [\"block_key1\", \"block_key2\"],\n  constraints: [\"constraint1\"]\n}\n```\n\n### Adding a Filter\nAdd to `server/prompt-engine/presets.ts`:\n```typescript\n{\n  key: \"filter_key\",\n  label: \"Display Name\",\n  schema: { type: \"select\", options: [\"opt1\", \"opt2\"] },\n  effect: { opt1: \"effect text\", opt2: \"other effect\" }\n}\n```\n\n## LoRA Training Infrastructure\n\n### Database Tables\n- `lora_models` - User's LoRA model projects\n- `lora_datasets` - Training datasets with quality reports\n- `lora_versions` - Trained versions with params and artifacts\n- `lora_jobs` - Training job status and progress\n- `user_lora_active` - Currently active LoRA per user\n- `base_models` - Supported base models (SDXL, Flux, SD1.5)\n\n### Architecture\n- **Storage Abstraction**: `server/lib/storage-provider.ts` supports S3/R2/local\n- **HMAC Security**: `server/lib/hmac.ts` for webhook authentication\n- **Rate Limiting**: `server/lib/rate-limiter.ts` (5 jobs/hr, 100 webhooks/min, 10 uploads/hr)\n- **Compiler Integration**: LoRA blocks are injected via `compiler.setActiveLora()`\n\n### GPU Worker Contract\nWorkers receive signed payloads with:\n- `jobId`: Unique job identifier\n- `datasetUrl`: Presigned URL for training images\n- `params`: Training parameters (steps, learning rate, resolution, rank)\n- `callbackUrl`: Webhook URL for progress updates\n\nWorkers must sign responses with HMAC and include `X-Signature` + `X-Timestamp` headers.\n\n## Recent Changes\n- 2024-12-22: Added ModelsLab Nano Banana Pro integration for image generation (Image Studio page)\n- 2024-12-22: Added SSRF protection on ModelsLab status endpoint (only allows trusted domains)\n- 2024-12-22: Added development mode training simulation - training completes instantly in dev\n- 2024-12-22: Fixed user ID handling in development for consistent LoRA visibility\n- 2024-12-22: Added training status badges (Training/Completed) in LoRA Studio UI\n- 2024-12-22: Integrated trained LoRA models into Prompt Studio with selector UI and weight slider (0-2)\n- 2024-12-22: Added `/api/lora/trained` endpoint to fetch all trained LoRA versions\n- 2024-12-22: Extended generate endpoint to accept `loraVersionId` and `loraWeight` parameters\n- 2024-12-22: Added 400 error responses for invalid/untrained LoRA versions\n- 2024-12-22: Added Character Pack generation for non-LoRA platforms (Sora/Veo/Grok)\n- 2024-12-22: Implemented profileSupportsLoraInjection() for conditional LoRA syntax injection\n- 2024-12-22: Added dual-dropdown architecture: Target Platform (for export) vs Trainable Base Model (for training)\n- 2024-12-22: Added lora_dataset_items table for individual file tracking with SHA256 hashes\n- 2024-12-22: Added real dataset upload workflow: init  presigned URLs  commit  validate\n- 2024-12-22: Added Portuguese translations for new LoRA Studio fields\n- 2024-12-21: Added LoRA training infrastructure (routes, storage, compiler integration)\n- 2024-12-21: Initial MVP release with full prompt generation workflow\n","path":null,"size_bytes":7919,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/storage.ts":{"content":"import { \n  users, llmProfiles, promptBlueprints, promptBlocks, filters, \n  generatedPrompts, promptVersions, rateLimits,\n  loraModels, loraDatasets, loraDatasetItems, loraVersions, loraJobs, userLoraActive, baseModels,\n  userBlueprints, userBlueprintVersions,\n  type User, type InsertUser, type LlmProfile, type InsertLlmProfile,\n  type PromptBlueprint, type InsertBlueprint, type PromptBlock, type InsertBlock,\n  type Filter, type InsertFilter, type GeneratedPrompt, type InsertGeneratedPrompt,\n  type PromptVersion, type InsertPromptVersion,\n  type LoraModel, type InsertLoraModel, type LoraDataset, type InsertLoraDataset,\n  type LoraVersion, type InsertLoraVersion, type LoraJob, type InsertLoraJob,\n  type UserLoraActive, type BaseModel, type InsertBaseModel, type LoraDatasetItem,\n  type UserBlueprint, type InsertUserBlueprint, type UserBlueprintVersion, type InsertUserBlueprintVersion\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  getProfiles(): Promise<LlmProfile[]>;\n  getProfile(id: string): Promise<LlmProfile | undefined>;\n  createProfile(profile: InsertLlmProfile): Promise<LlmProfile>;\n  \n  getBlueprints(): Promise<PromptBlueprint[]>;\n  getBlueprint(id: string): Promise<PromptBlueprint | undefined>;\n  createBlueprint(blueprint: InsertBlueprint): Promise<PromptBlueprint>;\n  \n  getBlocks(): Promise<PromptBlock[]>;\n  getBlock(key: string): Promise<PromptBlock | undefined>;\n  createBlock(block: InsertBlock): Promise<PromptBlock>;\n  \n  getFilters(): Promise<Filter[]>;\n  getFilter(key: string): Promise<Filter | undefined>;\n  createFilter(filter: InsertFilter): Promise<Filter>;\n  \n  getHistory(userId?: string): Promise<GeneratedPrompt[]>;\n  getGeneratedPrompt(id: string): Promise<GeneratedPrompt | undefined>;\n  createGeneratedPrompt(prompt: InsertGeneratedPrompt): Promise<GeneratedPrompt>;\n  \n  createPromptVersion(version: InsertPromptVersion): Promise<PromptVersion>;\n  getVersions(promptId: string): Promise<PromptVersion[]>;\n  \n  checkRateLimit(key: string, limit: number, windowMs: number): Promise<boolean>;\n  incrementRateLimit(key: string): Promise<void>;\n  \n  getLoraModels(userId: string): Promise<LoraModel[]>;\n  getLoraModel(id: string): Promise<LoraModel | undefined>;\n  createLoraModel(model: InsertLoraModel): Promise<LoraModel>;\n  \n  getLoraDatasets(loraModelId: string): Promise<LoraDataset[]>;\n  getLoraDataset(id: string): Promise<LoraDataset | undefined>;\n  createLoraDataset(dataset: InsertLoraDataset): Promise<LoraDataset>;\n  updateLoraDataset(id: string, data: Partial<InsertLoraDataset>): Promise<LoraDataset | undefined>;\n  \n  getLoraVersions(loraModelId: string): Promise<LoraVersion[]>;\n  getLoraVersion(id: string): Promise<LoraVersion | undefined>;\n  createLoraVersion(version: InsertLoraVersion): Promise<LoraVersion>;\n  updateLoraVersion(id: string, data: Partial<InsertLoraVersion>): Promise<LoraVersion | undefined>;\n  \n  getLoraJobs(loraVersionId: string): Promise<LoraJob[]>;\n  getLoraJob(id: string): Promise<LoraJob | undefined>;\n  createLoraJob(job: InsertLoraJob): Promise<LoraJob>;\n  updateLoraJob(id: string, data: Partial<InsertLoraJob>): Promise<LoraJob | undefined>;\n  \n  getUserActiveLora(userId: string): Promise<UserLoraActive | undefined>;\n  setUserActiveLora(userId: string, loraModelId: string, loraVersionId: string, weight: number, targetPlatform?: string): Promise<UserLoraActive>;\n  clearUserActiveLora(userId: string): Promise<void>;\n  \n  getDatasetItems(datasetId: string): Promise<LoraDatasetItem[]>;\n  createDatasetItem(item: { datasetId: string; storageKey: string; sha256: string; width: number; height: number; filename?: string }): Promise<LoraDatasetItem>;\n  createDatasetItems(items: Array<{ datasetId: string; storageKey: string; sha256: string; width: number; height: number; filename?: string }>): Promise<LoraDatasetItem[]>;\n  \n  getBaseModels(): Promise<BaseModel[]>;\n  createBaseModel(model: InsertBaseModel): Promise<BaseModel>;\n  \n  // User Blueprints\n  getUserBlueprints(userId: string): Promise<UserBlueprint[]>;\n  getUserBlueprint(id: string): Promise<UserBlueprint | undefined>;\n  createUserBlueprint(blueprint: InsertUserBlueprint, blocks: string[], constraints: string[]): Promise<{ blueprint: UserBlueprint; version: UserBlueprintVersion }>;\n  updateUserBlueprint(id: string, userId: string, data: Partial<InsertUserBlueprint>, blocks?: string[], constraints?: string[]): Promise<{ blueprint: UserBlueprint; version: UserBlueprintVersion } | undefined>;\n  deleteUserBlueprint(id: string, userId: string): Promise<boolean>;\n  getUserBlueprintVersions(blueprintId: string): Promise<UserBlueprintVersion[]>;\n  getUserBlueprintLatestVersion(blueprintId: string): Promise<UserBlueprintVersion | undefined>;\n  countUserBlueprints(userId: string): Promise<number>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(insertUser).returning();\n    return user;\n  }\n\n  async getProfiles(): Promise<LlmProfile[]> {\n    return db.select().from(llmProfiles);\n  }\n\n  async getProfile(id: string): Promise<LlmProfile | undefined> {\n    const [profile] = await db.select().from(llmProfiles).where(eq(llmProfiles.id, id));\n    return profile || undefined;\n  }\n\n  async createProfile(profile: InsertLlmProfile): Promise<LlmProfile> {\n    const [created] = await db.insert(llmProfiles).values(profile).returning();\n    return created;\n  }\n\n  async getBlueprints(): Promise<PromptBlueprint[]> {\n    return db.select().from(promptBlueprints);\n  }\n\n  async getBlueprint(id: string): Promise<PromptBlueprint | undefined> {\n    const [blueprint] = await db.select().from(promptBlueprints).where(eq(promptBlueprints.id, id));\n    return blueprint || undefined;\n  }\n\n  async createBlueprint(blueprint: InsertBlueprint): Promise<PromptBlueprint> {\n    const [created] = await db.insert(promptBlueprints).values(blueprint).returning();\n    return created;\n  }\n\n  async getBlocks(): Promise<PromptBlock[]> {\n    return db.select().from(promptBlocks);\n  }\n\n  async getBlock(key: string): Promise<PromptBlock | undefined> {\n    const [block] = await db.select().from(promptBlocks).where(eq(promptBlocks.key, key));\n    return block || undefined;\n  }\n\n  async createBlock(block: InsertBlock): Promise<PromptBlock> {\n    const [created] = await db.insert(promptBlocks).values(block).returning();\n    return created;\n  }\n\n  async getFilters(): Promise<Filter[]> {\n    return db.select().from(filters);\n  }\n\n  async getFilter(key: string): Promise<Filter | undefined> {\n    const [filter] = await db.select().from(filters).where(eq(filters.key, key));\n    return filter || undefined;\n  }\n\n  async createFilter(filter: InsertFilter): Promise<Filter> {\n    const [created] = await db.insert(filters).values(filter).returning();\n    return created;\n  }\n\n  async getHistory(userId?: string): Promise<GeneratedPrompt[]> {\n    if (userId) {\n      return db.select().from(generatedPrompts)\n        .where(eq(generatedPrompts.userId, userId))\n        .orderBy(desc(generatedPrompts.createdAt))\n        .limit(50);\n    }\n    return db.select().from(generatedPrompts)\n      .orderBy(desc(generatedPrompts.createdAt))\n      .limit(50);\n  }\n\n  async getGeneratedPrompt(id: string): Promise<GeneratedPrompt | undefined> {\n    const [prompt] = await db.select().from(generatedPrompts).where(eq(generatedPrompts.id, id));\n    return prompt || undefined;\n  }\n\n  async createGeneratedPrompt(prompt: InsertGeneratedPrompt): Promise<GeneratedPrompt> {\n    const [created] = await db.insert(generatedPrompts).values(prompt).returning();\n    return created;\n  }\n\n  async createPromptVersion(version: InsertPromptVersion): Promise<PromptVersion> {\n    const [created] = await db.insert(promptVersions).values(version).returning();\n    return created;\n  }\n\n  async getVersions(promptId: string): Promise<PromptVersion[]> {\n    return db.select().from(promptVersions)\n      .where(eq(promptVersions.generatedPromptId, promptId))\n      .orderBy(desc(promptVersions.version));\n  }\n\n  async checkRateLimit(key: string, limit: number, windowMs: number): Promise<boolean> {\n    const [record] = await db.select().from(rateLimits).where(eq(rateLimits.key, key));\n    \n    if (!record) {\n      return true;\n    }\n    \n    const windowStart = new Date(record.windowStart);\n    const now = new Date();\n    \n    if (now.getTime() - windowStart.getTime() > windowMs) {\n      await db.update(rateLimits)\n        .set({ windowStart: now, count: 0 })\n        .where(eq(rateLimits.key, key));\n      return true;\n    }\n    \n    return record.count < limit;\n  }\n\n  async incrementRateLimit(key: string): Promise<void> {\n    const [existing] = await db.select().from(rateLimits).where(eq(rateLimits.key, key));\n    \n    if (existing) {\n      await db.update(rateLimits)\n        .set({ count: existing.count + 1 })\n        .where(eq(rateLimits.key, key));\n    } else {\n      await db.insert(rateLimits).values({\n        key,\n        windowStart: new Date(),\n        count: 1,\n      });\n    }\n  }\n\n  async getLoraModels(userId: string): Promise<LoraModel[]> {\n    return db.select().from(loraModels)\n      .where(eq(loraModels.userId, userId))\n      .orderBy(desc(loraModels.createdAt));\n  }\n\n  async getLoraModel(id: string): Promise<LoraModel | undefined> {\n    const [model] = await db.select().from(loraModels).where(eq(loraModels.id, id));\n    return model || undefined;\n  }\n\n  async createLoraModel(model: InsertLoraModel): Promise<LoraModel> {\n    const [created] = await db.insert(loraModels).values(model).returning();\n    return created;\n  }\n\n  async getLoraDatasets(loraModelId: string): Promise<LoraDataset[]> {\n    return db.select().from(loraDatasets)\n      .where(eq(loraDatasets.loraModelId, loraModelId))\n      .orderBy(desc(loraDatasets.createdAt));\n  }\n\n  async getLoraDataset(id: string): Promise<LoraDataset | undefined> {\n    const [dataset] = await db.select().from(loraDatasets).where(eq(loraDatasets.id, id));\n    return dataset || undefined;\n  }\n\n  async createLoraDataset(dataset: InsertLoraDataset): Promise<LoraDataset> {\n    const [created] = await db.insert(loraDatasets).values(dataset).returning();\n    return created;\n  }\n\n  async updateLoraDataset(id: string, data: Partial<InsertLoraDataset>): Promise<LoraDataset | undefined> {\n    const [updated] = await db.update(loraDatasets)\n      .set(data)\n      .where(eq(loraDatasets.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async getLoraVersions(loraModelId: string): Promise<LoraVersion[]> {\n    return db.select().from(loraVersions)\n      .where(eq(loraVersions.loraModelId, loraModelId))\n      .orderBy(desc(loraVersions.createdAt));\n  }\n\n  async getLoraVersion(id: string): Promise<LoraVersion | undefined> {\n    const [version] = await db.select().from(loraVersions).where(eq(loraVersions.id, id));\n    return version || undefined;\n  }\n\n  async createLoraVersion(version: InsertLoraVersion): Promise<LoraVersion> {\n    const [created] = await db.insert(loraVersions).values(version).returning();\n    return created;\n  }\n\n  async updateLoraVersion(id: string, data: Partial<InsertLoraVersion>): Promise<LoraVersion | undefined> {\n    const [updated] = await db.update(loraVersions)\n      .set(data)\n      .where(eq(loraVersions.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async getLoraJobs(loraVersionId: string): Promise<LoraJob[]> {\n    return db.select().from(loraJobs)\n      .where(eq(loraJobs.loraVersionId, loraVersionId))\n      .orderBy(desc(loraJobs.createdAt));\n  }\n\n  async getLoraJob(id: string): Promise<LoraJob | undefined> {\n    const [job] = await db.select().from(loraJobs).where(eq(loraJobs.id, id));\n    return job || undefined;\n  }\n\n  async createLoraJob(job: InsertLoraJob): Promise<LoraJob> {\n    const [created] = await db.insert(loraJobs).values(job).returning();\n    return created;\n  }\n\n  async updateLoraJob(id: string, data: Partial<InsertLoraJob>): Promise<LoraJob | undefined> {\n    const [updated] = await db.update(loraJobs)\n      .set(data)\n      .where(eq(loraJobs.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async getUserActiveLora(userId: string): Promise<UserLoraActive | undefined> {\n    const [active] = await db.select().from(userLoraActive).where(eq(userLoraActive.userId, userId));\n    return active || undefined;\n  }\n\n  async setUserActiveLora(userId: string, loraModelId: string, loraVersionId: string, weight: number, targetPlatform?: string): Promise<UserLoraActive> {\n    const existing = await this.getUserActiveLora(userId);\n    \n    if (existing) {\n      const [updated] = await db.update(userLoraActive)\n        .set({ loraModelId, loraVersionId, weight, targetPlatform: targetPlatform || null, updatedAt: new Date() })\n        .where(eq(userLoraActive.userId, userId))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db.insert(userLoraActive)\n        .values({ userId, loraModelId, loraVersionId, weight, targetPlatform: targetPlatform || null })\n        .returning();\n      return created;\n    }\n  }\n\n  async clearUserActiveLora(userId: string): Promise<void> {\n    await db.delete(userLoraActive).where(eq(userLoraActive.userId, userId));\n  }\n\n  async getDatasetItems(datasetId: string): Promise<LoraDatasetItem[]> {\n    return db.select().from(loraDatasetItems).where(eq(loraDatasetItems.datasetId, datasetId));\n  }\n\n  async createDatasetItem(item: { datasetId: string; storageKey: string; sha256: string; width: number; height: number; filename?: string }): Promise<LoraDatasetItem> {\n    const [created] = await db.insert(loraDatasetItems).values(item).returning();\n    return created;\n  }\n\n  async createDatasetItems(items: Array<{ datasetId: string; storageKey: string; sha256: string; width: number; height: number; filename?: string }>): Promise<LoraDatasetItem[]> {\n    if (items.length === 0) return [];\n    return db.insert(loraDatasetItems).values(items).returning();\n  }\n\n  async getBaseModels(): Promise<BaseModel[]> {\n    return db.select().from(baseModels).where(eq(baseModels.isActive, 1));\n  }\n\n  async createBaseModel(model: InsertBaseModel): Promise<BaseModel> {\n    const [created] = await db.insert(baseModels).values(model).returning();\n    return created;\n  }\n\n  // User Blueprints\n  async getUserBlueprints(userId: string): Promise<UserBlueprint[]> {\n    return db.select().from(userBlueprints)\n      .where(and(eq(userBlueprints.userId, userId), eq(userBlueprints.isActive, 1)))\n      .orderBy(desc(userBlueprints.updatedAt));\n  }\n\n  async getUserBlueprint(id: string): Promise<UserBlueprint | undefined> {\n    const [blueprint] = await db.select().from(userBlueprints).where(eq(userBlueprints.id, id));\n    return blueprint || undefined;\n  }\n\n  async createUserBlueprint(\n    blueprint: InsertUserBlueprint, \n    blocks: string[], \n    constraints: string[]\n  ): Promise<{ blueprint: UserBlueprint; version: UserBlueprintVersion }> {\n    const [created] = await db.insert(userBlueprints).values(blueprint).returning();\n    \n    const [version] = await db.insert(userBlueprintVersions).values({\n      blueprintId: created.id,\n      version: 1,\n      blocks,\n      constraints,\n    }).returning();\n    \n    return { blueprint: created, version };\n  }\n\n  async updateUserBlueprint(\n    id: string, \n    userId: string, \n    data: Partial<InsertUserBlueprint>,\n    blocks?: string[],\n    constraints?: string[]\n  ): Promise<{ blueprint: UserBlueprint; version: UserBlueprintVersion } | undefined> {\n    const existing = await this.getUserBlueprint(id);\n    if (!existing || existing.userId !== userId) return undefined;\n\n    const newVersion = existing.version + 1;\n    \n    const [updated] = await db.update(userBlueprints)\n      .set({ ...data, version: newVersion, updatedAt: new Date() })\n      .where(eq(userBlueprints.id, id))\n      .returning();\n\n    if (blocks || constraints) {\n      const latestVersion = await this.getUserBlueprintLatestVersion(id);\n      const [version] = await db.insert(userBlueprintVersions).values({\n        blueprintId: id,\n        version: newVersion,\n        blocks: blocks || latestVersion?.blocks || [],\n        constraints: constraints || latestVersion?.constraints || [],\n      }).returning();\n      \n      return { blueprint: updated, version };\n    }\n\n    const latestVersion = await this.getUserBlueprintLatestVersion(id);\n    return { blueprint: updated, version: latestVersion! };\n  }\n\n  async deleteUserBlueprint(id: string, userId: string): Promise<boolean> {\n    const existing = await this.getUserBlueprint(id);\n    if (!existing || existing.userId !== userId) return false;\n\n    await db.update(userBlueprints)\n      .set({ isActive: 0 })\n      .where(eq(userBlueprints.id, id));\n    \n    return true;\n  }\n\n  async getUserBlueprintVersions(blueprintId: string): Promise<UserBlueprintVersion[]> {\n    return db.select().from(userBlueprintVersions)\n      .where(eq(userBlueprintVersions.blueprintId, blueprintId))\n      .orderBy(desc(userBlueprintVersions.version));\n  }\n\n  async getUserBlueprintLatestVersion(blueprintId: string): Promise<UserBlueprintVersion | undefined> {\n    const [version] = await db.select().from(userBlueprintVersions)\n      .where(eq(userBlueprintVersions.blueprintId, blueprintId))\n      .orderBy(desc(userBlueprintVersions.version))\n      .limit(1);\n    return version || undefined;\n  }\n\n  async countUserBlueprints(userId: string): Promise<number> {\n    const result = await db.select({ count: sql<number>`count(*)` })\n      .from(userBlueprints)\n      .where(and(eq(userBlueprints.userId, userId), eq(userBlueprints.isActive, 1)));\n    return Number(result[0]?.count || 0);\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":18330,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    limit: \"50mb\",\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false, limit: \"50mb\" }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2594,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/pages/studio.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useI18n } from \"@/lib/i18n\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { LlmProfile, PromptBlueprint, Filter, GeneratedPrompt, LoraModel, LoraVersion } from \"@shared/schema\";\nimport { \n  Zap, Copy, Download, Save, Share2, RefreshCw, AlertTriangle, \n  CheckCircle, ChevronDown, ChevronUp, Gauge, Layers, SlidersHorizontal,\n  Sparkles, FileText, Wand2, X, Monitor, Image, Video, Info\n} from \"lucide-react\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\ninterface TrainedLora {\n  model: LoraModel;\n  versions: LoraVersion[];\n}\n\ninterface CharacterPack {\n  promptWithoutLora: string;\n  characterInstructions: string;\n  referenceImagesCount: number;\n  recommendedParams: {\n    aspectRatio: string;\n    duration?: number;\n    style?: string;\n  };\n  targetPlatform: string;\n}\n\ninterface GeneratedPromptWithCharacterPack extends GeneratedPrompt {\n  characterPack?: CharacterPack;\n}\n\ntype FilterValue = Record<string, string>;\n\ninterface UserBlueprint {\n  id: string;\n  userId: string;\n  name: string;\n  description: string | null;\n  category: string;\n  tags: string[];\n  blocks: string[];\n  constraints: string[];\n  compatibleProfiles: string[];\n  version: number;\n  isActive: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function StudioPage() {\n  const { toast } = useToast();\n  const { t } = useI18n();\n  const [selectedProfile, setSelectedProfile] = useState<string>(\"\");\n  const [selectedBlueprint, setSelectedBlueprint] = useState<string>(\"\");\n  const [selectedUserBlueprint, setSelectedUserBlueprint] = useState<string>(\"\");\n  const [blueprintTab, setBlueprintTab] = useState<\"system\" | \"custom\">(\"system\");\n  const [activeFilters, setActiveFilters] = useState<FilterValue>({});\n  const [seed, setSeed] = useState<string>(\"\");\n  const [subject, setSubject] = useState(\"\");\n  const [context, setContext] = useState(\"\");\n  const [items, setItems] = useState(\"\");\n  const [environment, setEnvironment] = useState(\"\");\n  const [restrictions, setRestrictions] = useState(\"\");\n  const [showFilters, setShowFilters] = useState(true);\n  const [result, setResult] = useState<GeneratedPromptWithCharacterPack | null>(null);\n  const [selectedLora, setSelectedLora] = useState<{ versionId: string; weight: number } | null>(null);\n  const [targetPlatform, setTargetPlatform] = useState<string>(\"\");\n\n  // Platforms that support LoRA syntax injection\n  const loraSupportingPlatforms = [\"flux\", \"sdxl\", \"stable_diffusion\", \"sd1.5\"];\n  \n  // All available target platforms\n  const targetPlatforms = [\n    { id: \"flux_dev\", name: \"Flux Dev (LoRA)\", category: \"lora\", icon: \"image\" },\n    { id: \"sdxl\", name: \"SDXL (LoRA)\", category: \"lora\", icon: \"image\" },\n    { id: \"sd1.5\", name: \"SD 1.5 (LoRA)\", category: \"lora\", icon: \"image\" },\n    { id: \"higgsfield\", name: \"Higgsfield / Nano Banana\", category: \"cloud\", icon: \"video\" },\n    { id: \"midjourney\", name: \"Midjourney\", category: \"cloud\", icon: \"image\" },\n    { id: \"dalle\", name: \"DALL-E 3\", category: \"cloud\", icon: \"image\" },\n    { id: \"sora\", name: \"Sora\", category: \"cloud\", icon: \"video\" },\n    { id: \"veo\", name: \"Veo\", category: \"cloud\", icon: \"video\" },\n    { id: \"runway\", name: \"Runway Gen-3\", category: \"cloud\", icon: \"video\" },\n    { id: \"pika\", name: \"Pika\", category: \"cloud\", icon: \"video\" },\n    { id: \"kling\", name: \"Kling\", category: \"cloud\", icon: \"video\" },\n    { id: \"luma\", name: \"Luma Dream Machine\", category: \"cloud\", icon: \"video\" },\n    { id: \"grok\", name: \"Grok\", category: \"cloud\", icon: \"image\" },\n  ];\n\n  const selectedPlatformSupportsLora = targetPlatform && loraSupportingPlatforms.some(p => targetPlatform.includes(p));\n\n  const { data: profiles, isLoading: loadingProfiles } = useQuery<LlmProfile[]>({\n    queryKey: [\"/api/profiles\"],\n  });\n\n  const { data: blueprints, isLoading: loadingBlueprints } = useQuery<PromptBlueprint[]>({\n    queryKey: [\"/api/blueprints\"],\n  });\n\n  const { data: filters, isLoading: loadingFilters } = useQuery<Filter[]>({\n    queryKey: [\"/api/filters\"],\n  });\n\n  const { data: trainedLoras, isLoading: loadingLoras } = useQuery<TrainedLora[]>({\n    queryKey: [\"/api/lora/trained\"],\n  });\n\n  const { data: userBlueprints, isLoading: loadingUserBlueprints } = useQuery<UserBlueprint[]>({\n    queryKey: [\"/api/user-blueprints\"],\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      const isUserBlueprint = blueprintTab === \"custom\" && selectedUserBlueprint;\n      const res = await apiRequest(\"POST\", \"/api/generate\", {\n        profileId: selectedProfile,\n        blueprintId: isUserBlueprint ? undefined : selectedBlueprint,\n        userBlueprintId: isUserBlueprint ? selectedUserBlueprint : undefined,\n        filters: activeFilters,\n        seed: seed || undefined,\n        subject,\n        context,\n        items,\n        environment,\n        restrictions,\n        loraVersionId: selectedLora?.versionId,\n        loraWeight: selectedLora?.weight,\n        targetPlatform: selectedLora && targetPlatform ? targetPlatform : undefined,\n      });\n      return res.json();\n    },\n    onSuccess: (data: GeneratedPromptWithCharacterPack) => {\n      setResult(data);\n      setSeed(data.seed);\n      toast({ title: t.studio.copied });\n      queryClient.invalidateQueries({ queryKey: [\"/api/history\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: t.studio.errorGenerating, description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleRandomSeed = () => {\n    const newSeed = Math.random().toString(36).substring(2, 10);\n    setSeed(newSeed);\n  };\n\n  const handleCopy = async () => {\n    if (result) {\n      await navigator.clipboard.writeText(result.compiledPrompt);\n      toast({ title: t.studio.promptCopied });\n    }\n  };\n\n  const handleExportJSON = () => {\n    if (result) {\n      const blob = new Blob([JSON.stringify(result, null, 2)], { type: \"application/json\" });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `prompt-${result.id}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      toast({ title: \"JSON exported!\" });\n    }\n  };\n\n  const handleFilterChange = (key: string, value: string) => {\n    setActiveFilters((prev) => ({ ...prev, [key]: value }));\n  };\n\n  const canGenerate = selectedProfile && (\n    (blueprintTab === \"system\" && selectedBlueprint) || \n    (blueprintTab === \"custom\" && selectedUserBlueprint)\n  );\n\n  return (\n    <div className=\"min-h-screen pt-16\">\n      <div className=\"max-w-7xl mx-auto px-4 md:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-semibold mb-2\" data-testid=\"text-studio-title\">{t.studio.title}</h1>\n          <p className=\"text-muted-foreground\">{t.studio.subtitle}</p>\n        </div>\n\n        <div className=\"grid lg:grid-cols-[320px_1fr] gap-8\">\n          <aside className=\"space-y-6\">\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                  <Sparkles className=\"w-4 h-4\" />\n                  {t.studio.llmProfile}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {loadingProfiles ? (\n                  <div className=\"space-y-2\">\n                    <Skeleton className=\"h-16 w-full\" />\n                    <Skeleton className=\"h-16 w-full\" />\n                  </div>\n                ) : (\n                  <ScrollArea className=\"h-[200px] pr-4\">\n                    <div className=\"space-y-2\">\n                      {profiles?.map((profile) => (\n                        <button\n                          key={profile.id}\n                          onClick={() => setSelectedProfile(profile.id)}\n                          className={`w-full text-left p-3 rounded-lg border transition-colors ${\n                            selectedProfile === profile.id\n                              ? \"border-primary bg-primary/5\"\n                              : \"border-border hover-elevate\"\n                          }`}\n                          data-testid={`button-profile-${profile.id}`}\n                        >\n                          <div className=\"font-medium text-sm\">{profile.name}</div>\n                          <div className=\"text-xs text-muted-foreground mt-1\">\n                            Max {profile.maxLength} chars\n                          </div>\n                        </button>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                  <Layers className=\"w-4 h-4\" />\n                  {t.studio.blueprint}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                <Tabs value={blueprintTab} onValueChange={(v) => setBlueprintTab(v as \"system\" | \"custom\")}>\n                  <TabsList className=\"w-full grid grid-cols-2\">\n                    <TabsTrigger value=\"system\" className=\"text-xs\" data-testid=\"tab-system-blueprints\">\n                      {t.blueprintBuilder?.systemBlueprints || \"System\"}\n                    </TabsTrigger>\n                    <TabsTrigger value=\"custom\" className=\"text-xs\" data-testid=\"tab-custom-blueprints\">\n                      {t.blueprintBuilder?.myBlueprints || \"My\"}\n                      {userBlueprints && userBlueprints.length > 0 && (\n                        <Badge variant=\"secondary\" className=\"ml-1 text-xs px-1\">{userBlueprints.length}</Badge>\n                      )}\n                    </TabsTrigger>\n                  </TabsList>\n                  \n                  <TabsContent value=\"system\" className=\"mt-2\">\n                    {loadingBlueprints ? (\n                      <div className=\"space-y-2\">\n                        <Skeleton className=\"h-20 w-full\" />\n                        <Skeleton className=\"h-20 w-full\" />\n                      </div>\n                    ) : (\n                      <ScrollArea className=\"h-[240px] pr-4\">\n                        <div className=\"space-y-2\">\n                          {blueprints?.map((blueprint) => (\n                            <button\n                              key={blueprint.id}\n                              onClick={() => {\n                                setSelectedBlueprint(blueprint.id);\n                                setSelectedUserBlueprint(\"\");\n                              }}\n                              className={`w-full text-left p-3 rounded-lg border transition-colors ${\n                                selectedBlueprint === blueprint.id && blueprintTab === \"system\"\n                                  ? \"border-primary bg-primary/5\"\n                                  : \"border-border hover-elevate\"\n                              }`}\n                              data-testid={`button-blueprint-${blueprint.id}`}\n                            >\n                              <div className=\"flex items-center gap-2 mb-1\">\n                                <span className=\"font-medium text-sm\">{blueprint.name}</span>\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {blueprint.category}\n                                </Badge>\n                              </div>\n                              <div className=\"text-xs text-muted-foreground line-clamp-2\">\n                                {blueprint.description}\n                              </div>\n                            </button>\n                          ))}\n                        </div>\n                      </ScrollArea>\n                    )}\n                  </TabsContent>\n                  \n                  <TabsContent value=\"custom\" className=\"mt-2\">\n                    {loadingUserBlueprints ? (\n                      <div className=\"space-y-2\">\n                        <Skeleton className=\"h-20 w-full\" />\n                      </div>\n                    ) : userBlueprints && userBlueprints.length > 0 ? (\n                      <ScrollArea className=\"h-[240px] pr-4\">\n                        <div className=\"space-y-2\">\n                          {userBlueprints.map((blueprint) => (\n                            <button\n                              key={blueprint.id}\n                              onClick={() => {\n                                setSelectedUserBlueprint(blueprint.id);\n                                setSelectedBlueprint(\"\");\n                              }}\n                              className={`w-full text-left p-3 rounded-lg border transition-colors ${\n                                selectedUserBlueprint === blueprint.id && blueprintTab === \"custom\"\n                                  ? \"border-primary bg-primary/5\"\n                                  : \"border-border hover-elevate\"\n                              }`}\n                              data-testid={`button-user-blueprint-${blueprint.id}`}\n                            >\n                              <div className=\"flex items-center gap-2 mb-1\">\n                                <span className=\"font-medium text-sm\">{blueprint.name}</span>\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {blueprint.category}\n                                </Badge>\n                              </div>\n                              <div className=\"text-xs text-muted-foreground line-clamp-2\">\n                                {blueprint.description || \"No description\"}\n                              </div>\n                            </button>\n                          ))}\n                        </div>\n                      </ScrollArea>\n                    ) : (\n                      <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                        <p>{t.blueprintBuilder?.noUserBlueprints || \"No custom blueprints\"}</p>\n                        <p className=\"text-xs mt-1\">{t.blueprintBuilder?.createFirstHint || \"Create one in the Library\"}</p>\n                      </div>\n                    )}\n                  </TabsContent>\n                </Tabs>\n              </CardContent>\n            </Card>\n\n            {/* LoRA Model Selector */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                  <Wand2 className=\"w-4 h-4\" />\n                  {t.studio.loraModel || \"LoRA Model\"}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {loadingLoras ? (\n                  <Skeleton className=\"h-16 w-full\" />\n                ) : trainedLoras && trainedLoras.length > 0 ? (\n                  <>\n                    <ScrollArea className=\"h-[160px] pr-4\">\n                      <div className=\"space-y-2\">\n                        {trainedLoras.map((lora) => (\n                          lora.versions.map((version) => (\n                            <button\n                              key={version.id}\n                              onClick={() => setSelectedLora(\n                                selectedLora?.versionId === version.id \n                                  ? null \n                                  : { versionId: version.id, weight: 1 }\n                              )}\n                              className={`w-full text-left p-3 rounded-lg border transition-colors ${\n                                selectedLora?.versionId === version.id\n                                  ? \"border-primary bg-primary/5\"\n                                  : \"border-border hover-elevate\"\n                              }`}\n                              data-testid={`button-lora-${version.id}`}\n                            >\n                              <div className=\"flex items-center justify-between gap-2\">\n                                <span className=\"font-medium text-sm\">{lora.model.name}</span>\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {version.baseModel}\n                                </Badge>\n                              </div>\n                              {lora.model.description && (\n                                <div className=\"text-xs text-muted-foreground mt-1 line-clamp-1\">\n                                  {lora.model.description}\n                                </div>\n                              )}\n                            </button>\n                          ))\n                        ))}\n                      </div>\n                    </ScrollArea>\n                    \n                    {selectedLora && (\n                      <div className=\"space-y-3 pt-2 border-t\">\n                        <div className=\"flex items-center justify-between gap-2\">\n                          <Label className=\"text-xs text-muted-foreground\">\n                            {t.loraStudio?.weight || \"Weight\"}: {selectedLora.weight.toFixed(2)}\n                          </Label>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => {\n                              setSelectedLora(null);\n                              setTargetPlatform(\"\");\n                            }}\n                            data-testid=\"button-clear-lora\"\n                          >\n                            <X className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                        <Slider\n                          value={[selectedLora.weight]}\n                          onValueChange={([value]) => setSelectedLora({ ...selectedLora, weight: value })}\n                          min={0}\n                          max={2}\n                          step={0.1}\n                          data-testid=\"slider-lora-weight\"\n                        />\n                        \n                        <div className=\"space-y-2 pt-2\">\n                          <div className=\"flex items-center gap-1\">\n                            <Label className=\"text-xs text-muted-foreground\">\n                              {t.studio?.targetPlatform || \"Target Platform\"}\n                            </Label>\n                            <Tooltip>\n                              <TooltipTrigger>\n                                <Info className=\"w-3 h-3 text-muted-foreground\" />\n                              </TooltipTrigger>\n                              <TooltipContent className=\"max-w-xs\">\n                                <p>{t.studio?.platformHint || \"Select where you'll use this prompt. Cloud platforms need Character Pack instead of LoRA syntax.\"}</p>\n                              </TooltipContent>\n                            </Tooltip>\n                          </div>\n                          <Select value={targetPlatform} onValueChange={setTargetPlatform}>\n                            <SelectTrigger data-testid=\"select-target-platform\">\n                              <SelectValue placeholder={t.studio?.selectPlatform || \"Select platform...\"} />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <div className=\"px-2 py-1 text-xs font-medium text-muted-foreground\">\n                                {t.studio?.localWithLora || \"Local (with LoRA)\"}\n                              </div>\n                              {targetPlatforms.filter(p => p.category === \"lora\").map((platform) => (\n                                <SelectItem key={platform.id} value={platform.id}>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Image className=\"w-3 h-3\" />\n                                    {platform.name}\n                                  </div>\n                                </SelectItem>\n                              ))}\n                              <div className=\"px-2 py-1 text-xs font-medium text-muted-foreground mt-2\">\n                                {t.studio?.cloudPlatforms || \"Cloud (Character Pack)\"}\n                              </div>\n                              {targetPlatforms.filter(p => p.category === \"cloud\").map((platform) => (\n                                <SelectItem key={platform.id} value={platform.id}>\n                                  <div className=\"flex items-center gap-2\">\n                                    {platform.icon === \"video\" ? <Video className=\"w-3 h-3\" /> : <Image className=\"w-3 h-3\" />}\n                                    {platform.name}\n                                  </div>\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          \n                          {targetPlatform && !selectedPlatformSupportsLora && (\n                            <div className=\"p-2 rounded-lg bg-amber-500/10 border border-amber-500/20 text-xs\">\n                              <p className=\"text-amber-600 dark:text-amber-400\">\n                                {t.studio?.characterPackNote || \"This platform doesn't support LoRA. A Character Pack with reference image instructions will be generated instead.\"}\n                              </p>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </>\n                ) : (\n                  <div className=\"text-center py-4 text-muted-foreground text-sm\">\n                    <p>{t.studio.noTrainedLoras || \"No trained LoRAs available\"}</p>\n                    <p className=\"text-xs mt-1\">{t.studio.trainLoraHint || \"Train a LoRA in the LoRA Studio\"}</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </aside>\n\n          <main className=\"space-y-6\">\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <button\n                  onClick={() => setShowFilters(!showFilters)}\n                  className=\"flex items-center justify-between w-full\"\n                  data-testid=\"button-toggle-filters\"\n                >\n                  <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                    <SlidersHorizontal className=\"w-4 h-4\" />\n                    {t.studio.filters}\n                  </CardTitle>\n                  {showFilters ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                </button>\n              </CardHeader>\n              {showFilters && (\n                <CardContent>\n                  {loadingFilters ? (\n                    <div className=\"flex flex-wrap gap-4\">\n                      <Skeleton className=\"h-10 w-40\" />\n                      <Skeleton className=\"h-10 w-40\" />\n                      <Skeleton className=\"h-10 w-40\" />\n                    </div>\n                  ) : (\n                    <div className=\"flex flex-wrap gap-4\">\n                      {filters?.map((filter) => (\n                        <div key={filter.id} className=\"space-y-2\">\n                          <Label className=\"text-xs text-muted-foreground\">{filter.label}</Label>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {(filter.schema as { options?: string[] })?.options?.map((option) => (\n                              <Button\n                                key={option}\n                                variant={activeFilters[filter.key] === option ? \"default\" : \"outline\"}\n                                size=\"sm\"\n                                onClick={() => handleFilterChange(filter.key, option)}\n                                data-testid={`button-filter-${filter.key}-${option}`}\n                              >\n                                {option}\n                              </Button>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              )}\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                  <FileText className=\"w-4 h-4\" />\n                  {t.studio.inputFields}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"subject\">{t.studio.subject}</Label>\n                    <Input\n                      id=\"subject\"\n                      placeholder={t.studio.subjectPlaceholder}\n                      value={subject}\n                      onChange={(e) => setSubject(e.target.value)}\n                      data-testid=\"input-subject\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"environment\">{t.studio.environment}</Label>\n                    <Input\n                      id=\"environment\"\n                      placeholder={t.studio.environmentPlaceholder}\n                      value={environment}\n                      onChange={(e) => setEnvironment(e.target.value)}\n                      data-testid=\"input-environment\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"context\">{t.studio.context}</Label>\n                  <Textarea\n                    id=\"context\"\n                    placeholder={t.studio.contextPlaceholder}\n                    className=\"min-h-24\"\n                    value={context}\n                    onChange={(e) => setContext(e.target.value)}\n                    data-testid=\"input-context\"\n                  />\n                </div>\n\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"items\">{t.studio.items}</Label>\n                    <Input\n                      id=\"items\"\n                      placeholder={t.studio.itemsPlaceholder}\n                      value={items}\n                      onChange={(e) => setItems(e.target.value)}\n                      data-testid=\"input-items\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"restrictions\">{t.studio.restrictions}</Label>\n                    <Input\n                      id=\"restrictions\"\n                      placeholder={t.studio.restrictionsPlaceholder}\n                      value={restrictions}\n                      onChange={(e) => setRestrictions(e.target.value)}\n                      data-testid=\"input-restrictions\"\n                    />\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div className=\"flex items-end gap-4\">\n                  <div className=\"flex-1 space-y-2\">\n                    <Label htmlFor=\"seed\">{t.studio.seed}</Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"seed\"\n                        placeholder={t.studio.seedPlaceholder}\n                        value={seed}\n                        onChange={(e) => setSeed(e.target.value)}\n                        className=\"font-mono\"\n                        data-testid=\"input-seed\"\n                      />\n                      <Button\n                        variant=\"outline\"\n                        size=\"icon\"\n                        onClick={handleRandomSeed}\n                        data-testid=\"button-random-seed\"\n                      >\n                        <RefreshCw className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Button\n              size=\"lg\"\n              className=\"w-full md:w-auto gap-2\"\n              onClick={() => generateMutation.mutate()}\n              disabled={!canGenerate || generateMutation.isPending}\n              data-testid=\"button-generate\"\n            >\n              {generateMutation.isPending ? (\n                <>\n                  <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                  {t.studio.generating}\n                </>\n              ) : (\n                <>\n                  <Zap className=\"w-4 h-4\" />\n                  {t.studio.generatePrompt}\n                </>\n              )}\n            </Button>\n\n            {result && (\n              <Card className=\"border-primary/30\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                    <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground\">\n                      {t.studio.generatedPrompt}\n                    </CardTitle>\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <Badge variant=\"secondary\" data-testid=\"badge-profile\">\n                        {result.metadata?.profileName}\n                      </Badge>\n                      <Badge variant=\"secondary\" data-testid=\"badge-blueprint\">\n                        {result.metadata?.blueprintName}\n                      </Badge>\n                      <Badge \n                        variant={result.score >= 80 ? \"default\" : result.score >= 60 ? \"secondary\" : \"outline\"}\n                        className=\"gap-1\"\n                        data-testid=\"badge-score\"\n                      >\n                        <Gauge className=\"w-3 h-3\" />\n                        {t.studio.qualityScore}: {result.score}\n                      </Badge>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {result.warnings && result.warnings.length > 0 && (\n                    <div className=\"flex items-start gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20\">\n                      <AlertTriangle className=\"w-4 h-4 text-amber-500 shrink-0 mt-0.5\" />\n                      <div className=\"text-sm\">\n                        {result.warnings.map((warning, i) => (\n                          <div key={i}>{warning}</div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  <div className=\"p-4 rounded-lg bg-muted/50 font-mono text-sm leading-relaxed whitespace-pre-wrap\" data-testid=\"text-compiled-prompt\">\n                    {result.compiledPrompt}\n                  </div>\n\n                  {result.characterPack && (\n                    <div className=\"space-y-3 p-4 rounded-lg border border-primary/30 bg-primary/5\" data-testid=\"character-pack-section\">\n                      <div className=\"flex items-center gap-2\">\n                        <Wand2 className=\"w-4 h-4 text-primary\" />\n                        <span className=\"font-medium text-sm\">{t.studio.characterPackTitle}</span>\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {result.characterPack.targetPlatform}\n                        </Badge>\n                      </div>\n                      \n                      <div className=\"text-sm text-muted-foreground\">\n                        {result.characterPack.characterInstructions}\n                      </div>\n                      \n                      <div className=\"flex items-center gap-4 text-xs\">\n                        <div className=\"flex items-center gap-1\">\n                          <Image className=\"w-3 h-3\" />\n                          <span>{t.studio.uploadImages}: {result.characterPack.referenceImagesCount}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Monitor className=\"w-3 h-3\" />\n                          <span>{t.studio.recommendedSettings}: {result.characterPack.recommendedParams.aspectRatio}</span>\n                          {result.characterPack.recommendedParams.duration && (\n                            <span>, {result.characterPack.recommendedParams.duration}s</span>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <Button variant=\"outline\" size=\"sm\" onClick={handleCopy} className=\"gap-2\" data-testid=\"button-copy\">\n                      <Copy className=\"w-4 h-4\" />\n                      {t.studio.copyToClipboard}\n                    </Button>\n                    <Button variant=\"outline\" size=\"sm\" onClick={handleExportJSON} className=\"gap-2\" data-testid=\"button-export\">\n                      <Download className=\"w-4 h-4\" />\n                      {t.studio.exportJson}\n                    </Button>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-2\" data-testid=\"button-save\">\n                      <Save className=\"w-4 h-4\" />\n                      {t.studio.saveVersion}\n                    </Button>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-2\" data-testid=\"button-share\">\n                      <Share2 className=\"w-4 h-4\" />\n                      Share\n                    </Button>\n                  </div>\n\n                  <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                    <CheckCircle className=\"w-3 h-3\" />\n                    <span>Seed: <code className=\"font-mono bg-muted px-1 rounded\">{result.seed}</code></span>\n                    <span className=\"mx-2\">|</span>\n                    <span>{result.metadata?.blockCount} {t.studio.blocksUsed}</span>\n                    <span className=\"mx-2\">|</span>\n                    <span>{result.metadata?.filterCount} {t.studio.filtersApplied}</span>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </main>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":35649,"size_tokens":null},"design_guidelines.md":{"content":"# PromptForge Design Guidelines\n\n## Design Approach\n\n**Selected Approach:** Design System (Linear-inspired technical workspace)\n\n**Justification:** PromptForge is a professional productivity tool requiring clarity, efficiency, and sophisticated UI controls. Linear's design language perfectly balances technical precision with modern aesthetics - ideal for a studio-style application handling complex inputs and outputs.\n\n**Key Principles:**\n- Precision over decoration: Every element serves a functional purpose\n- Technical clarity: Information hierarchy guides power users efficiently\n- Professional restraint: Sophisticated without being flashy\n- Studio-grade interface: Workspace tools that feel powerful and refined\n\n---\n\n## Typography\n\n**Font Stack:**\n- Primary: Inter (Google Fonts) - UI text, labels, body\n- Monospace: JetBrains Mono - code output, seeds, technical data\n\n**Hierarchy:**\n- Hero Headlines: text-5xl/text-6xl font-bold (landing only)\n- Page Titles: text-3xl font-semibold\n- Section Headers: text-xl font-semibold\n- Component Labels: text-sm font-medium uppercase tracking-wide text-opacity-60\n- Body Text: text-base font-normal\n- Technical Data: text-sm font-mono\n- Captions/Meta: text-xs font-medium text-opacity-50\n\n---\n\n## Layout System\n\n**Spacing Primitives:** Tailwind units of 2, 4, 6, 8, 12, 16, 24\n- Micro spacing (component internals): p-2, gap-2\n- Standard spacing (between elements): p-4, gap-4, mb-6\n- Section spacing: p-8, py-12, gap-8\n- Page margins: p-16, py-24 (desktop)\n\n**Grid System:**\n- Container: max-w-7xl mx-auto px-8\n- Studio workspace: 2-column split (sidebar + main), lg:grid-cols-[280px_1fr]\n- Library grid: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\n- Filter panels: flex flex-wrap gap-4\n\n---\n\n## Component Library\n\n### Navigation\n**Top Bar:** Fixed header (h-16) with logo left, navigation center, user/account right. Backdrop blur background, border-b separator.\n\n### Studio Workspace Components\n\n**Profile/Blueprint Selectors:**\n- Card-based selection with radio behavior\n- Each card: p-4, border, rounded-lg, hover state with subtle elevation\n- Active state: border accent, background tint\n- Display: name (font-semibold), description (text-sm opacity-60), metadata badges\n\n**Filter Panel:**\n- Organized in collapsible sections\n- Each filter: label + control (chips for discrete, slider for continuous)\n- Chips: px-3 py-1.5 rounded-full, multi-select with active state\n- Sliders: custom range inputs with value display\n\n**Input Form:**\n- Vertical stack with generous spacing (gap-6)\n- Labels: text-sm font-medium mb-2\n- Text inputs: p-3 rounded-lg border, focus ring\n- Textareas: min-h-32 for context fields\n- Seed field: monospace font with \"randomize\" icon button inline\n\n**Generate Button:**\n- Primary CTA: px-8 py-4 text-base font-semibold rounded-lg\n- Full width on mobile, auto width on desktop\n- Loading state with spinner\n\n**Output Display:**\n- Dedicated panel with clear visual separation\n- Header with metadata badges (profile, blueprint, score)\n- Prompt text: font-mono p-6 rounded-lg background subtle\n- Action row: Copy, Export JSON, Save Version, Share (icons + labels)\n- Warnings: amber accent with icon, collapsible details\n- Score visualization: progress bar or circular gauge\n\n### Library Components\n\n**Blueprint Cards:**\n- Hover-lift effect (transform subtle)\n- Preview thumbnail area (16:9 aspect ratio placeholder)\n- Content: title (font-semibold text-lg), category badge, description (2 lines max), block count indicator\n- Footer: \"Use Blueprint\" button\n\n### History Components\n\n**History List:**\n- Table-like rows with: timestamp, blueprint name, score badge, prompt preview (truncated), replay seed button\n- Click row to expand full details\n- Filters: date range, blueprint type, score threshold\n\n---\n\n## Page Layouts\n\n### Landing Page\n**Hero Section (h-screen max-h-[600px]):**\n- Centered layout max-w-4xl\n- Headline + subheadline + CTA stack\n- Below fold: 3-column feature grid highlighting \"Infinite Blueprints\", \"Reproducible Results\", \"Filter Precision\"\n- Social proof section: \"Trusted by prompt engineers\" with placeholder logos\n- Pricing comparison table (Free vs Pro) with feature checkmarks\n- Footer with links, newsletter signup\n\n**Hero Image:** Abstract visualization of prompt compilation - geometric shapes flowing into structured text formation (suggest Midjourney/DALL-E generation with keywords: \"abstract data flow, blueprint wireframes, minimalist tech illustration, purple and blue gradient\")\n\n### Studio Page\n**Layout Structure:**\n- Left Sidebar (280px): Profile selector (sticky top), Blueprint selector (scrollable)\n- Main Area: \n  - Top: Filter Panel (collapsible horizontal chips)\n  - Middle: Input Form (max-w-2xl)\n  - Bottom: Generate button + Output panel (conditional render)\n- Responsive: sidebar becomes drawer on mobile\n\n### Library Page\n- Page header with search bar and category filters\n- Blueprint grid (3 columns desktop, 2 tablet, 1 mobile)\n- Each card showcases blueprint with visual preview area\n\n### History Page\n- Search + filter bar (sticky)\n- Sortable table with pagination\n- Empty state with \"Generate your first prompt\" CTA\n\n---\n\n## Animations\n\n**Minimal, purposeful only:**\n- Page transitions: 150ms ease fade\n- Card hovers: transform scale(1.02) + shadow in 200ms\n- Collapsible sections: height transition 300ms ease\n- Loading states: subtle pulse on skeleton elements\n- No scroll-triggered animations\n\n---\n\n## Images\n\n**Hero Image (Landing):**\n- Position: Full-width background with gradient overlay\n- Description: Abstract visualization of prompt compilation process - flowing data streams converging into structured blueprint format, modern tech aesthetic, depth and dimensionality, color scheme: deep purples, electric blues, subtle gradients\n- Treatment: Subtle blur overlay, centered content with backdrop-blur card\n\n**Blueprint Cards (Library):**\n- Each blueprint displays category-appropriate preview\n- Examples: \"minecraft_style_food\" shows pixelated food grid, \"cctv_detection\" shows surveillance aesthetic, \"lookbook_9frame\" shows 3x3 fashion layout\n- Aspect ratio: 16:9, object-fit: cover\n\n---\n\n## Accessibility & States\n\n- Focus indicators: 2px ring with offset\n- Hover states: opacity-80 or subtle background shift\n- Active states: background deepening + scale(0.98)\n- Disabled states: opacity-40 + cursor-not-allowed\n- Form validation: inline errors with red accent, success with green checkmark\n- Loading skeletons: pulsing placeholder blocks matching content structure\n- Keyboard navigation: full tab order, escape to close modals/drawers\n\n---\n\n## Production Checklist\n\n- Responsive breakpoints: sm(640px), md(768px), lg(1024px), xl(1280px)\n- Dark mode consideration: design supports but not required for MVP\n- Empty states: all lists/grids have illustrated empty state with CTA\n- Error states: user-friendly messages with retry actions\n- Loading states: skeleton screens matching final content structure\n- Touch targets: minimum 44px for mobile interactive elements","path":null,"size_bytes":7013,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useI18n } from \"@/lib/i18n\";\nimport { Zap, Repeat, Sliders, Check, ArrowRight, Sparkles, Layers, Target } from \"lucide-react\";\n\nexport default function LandingPage() {\n  const { t } = useI18n();\n\n  const features = [\n    {\n      icon: Layers,\n      title: t.landing.feature1Title,\n      description: t.landing.feature1Desc,\n    },\n    {\n      icon: Sliders,\n      title: t.landing.feature2Title,\n      description: t.landing.feature2Desc,\n    },\n    {\n      icon: Repeat,\n      title: t.landing.feature3Title,\n      description: t.landing.feature3Desc,\n    },\n  ];\n\n  const pricingPlans = [\n    {\n      name: t.landing.free,\n      price: \"$0\",\n      period: t.landing.freePriceMonth,\n      features: [\n        t.landing.freeFeature1,\n        t.landing.freeFeature2,\n        t.landing.freeFeature3,\n        t.landing.freeFeature4,\n      ],\n      notIncluded: [],\n      cta: t.landing.startFree,\n      variant: \"outline\" as const,\n    },\n    {\n      name: t.landing.pro,\n      price: \"$12\",\n      period: t.landing.proPriceMonth,\n      badge: \"Popular\",\n      features: [\n        t.landing.proFeature1,\n        t.landing.proFeature2,\n        t.landing.proFeature3,\n        t.landing.proFeature4,\n        t.landing.proFeature5,\n      ],\n      notIncluded: [],\n      cta: t.landing.upgradePro,\n      variant: \"default\" as const,\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen\">\n      <section className=\"relative pt-32 pb-24 px-4 md:px-8 overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-primary/10 pointer-events-none\" />\n        <div className=\"absolute top-20 left-1/4 w-96 h-96 bg-primary/10 rounded-full blur-3xl pointer-events-none\" />\n        <div className=\"absolute bottom-0 right-1/4 w-64 h-64 bg-primary/5 rounded-full blur-2xl pointer-events-none\" />\n        \n        <div className=\"max-w-4xl mx-auto text-center relative\">\n          <Badge variant=\"secondary\" className=\"mb-6\" data-testid=\"badge-hero\">\n            <Sparkles className=\"w-3 h-3 mr-1\" />\n            Prompt Engineering\n          </Badge>\n          \n          <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight mb-6\" data-testid=\"text-hero-title\">\n            {t.landing.heroTitle}\n          </h1>\n          \n          <p className=\"text-lg md:text-xl text-muted-foreground max-w-2xl mx-auto mb-10\" data-testid=\"text-hero-description\">\n            {t.landing.heroSubtitle}\n          </p>\n          \n          <div className=\"flex flex-wrap justify-center gap-4\">\n            <Link href=\"/studio\">\n              <Button size=\"lg\" className=\"gap-2\" data-testid=\"button-hero-cta\">\n                <Zap className=\"w-4 h-4\" />\n                {t.landing.getStarted}\n                <ArrowRight className=\"w-4 h-4\" />\n              </Button>\n            </Link>\n            <Link href=\"/library\">\n              <Button size=\"lg\" variant=\"outline\" data-testid=\"button-hero-secondary\">\n                {t.landing.viewLibrary}\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-24 px-4 md:px-8 bg-card/50\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl font-semibold mb-4\" data-testid=\"text-features-title\">\n              {t.landing.featuresTitle}\n            </h2>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              {t.landing.featuresSubtitle}\n            </p>\n          </div>\n          \n          <div className=\"grid md:grid-cols-3 gap-8\">\n            {features.map((feature, i) => (\n              <Card key={feature.title} className=\"border-border/50\" data-testid={`card-feature-${i}`}>\n                <CardHeader>\n                  <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center mb-4\">\n                    <feature.icon className=\"w-6 h-6 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-xl\">{feature.title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground\">{feature.description}</p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-24 px-4 md:px-8\">\n        <div className=\"max-w-5xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl font-semibold mb-4\" data-testid=\"text-pricing-title\">\n              {t.landing.pricingTitle}\n            </h2>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              {t.landing.pricingSubtitle}\n            </p>\n          </div>\n          \n          <div className=\"grid md:grid-cols-2 gap-8 max-w-3xl mx-auto\">\n            {pricingPlans.map((plan) => (\n              <Card\n                key={plan.name}\n                className={`relative ${plan.badge ? \"border-primary\" : \"border-border/50\"}`}\n                data-testid={`card-pricing-${plan.name.toLowerCase()}`}\n              >\n                {plan.badge && (\n                  <Badge className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n                    {plan.badge}\n                  </Badge>\n                )}\n                <CardHeader className=\"text-center pb-2\">\n                  <CardTitle className=\"text-2xl\">{plan.name}</CardTitle>\n                  <div className=\"mt-4\">\n                    <span className=\"text-4xl font-bold\">{plan.price}</span>\n                    <span className=\"text-muted-foreground ml-1\">{plan.period}</span>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <ul className=\"space-y-3\">\n                    {plan.features.map((feature) => (\n                      <li key={feature} className=\"flex items-center gap-3\">\n                        <Check className=\"w-4 h-4 text-primary shrink-0\" />\n                        <span className=\"text-sm\">{feature}</span>\n                      </li>\n                    ))}\n                  </ul>\n                  <Button variant={plan.variant} className=\"w-full\" data-testid={`button-pricing-${plan.name.toLowerCase()}`}>\n                    {plan.cta}\n                  </Button>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-24 px-4 md:px-8 bg-primary text-primary-foreground\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <Target className=\"w-12 h-12 mx-auto mb-6 opacity-80\" />\n          <h2 className=\"text-3xl font-semibold mb-4\" data-testid=\"text-cta-title\">\n            {t.landing.heroTitle}\n          </h2>\n          <p className=\"text-primary-foreground/80 max-w-xl mx-auto mb-8\">\n            {t.landing.footer}\n          </p>\n          <Link href=\"/studio\">\n            <Button size=\"lg\" variant=\"secondary\" className=\"gap-2\" data-testid=\"button-footer-cta\">\n              <Zap className=\"w-4 h-4\" />\n              {t.landing.getStarted}\n            </Button>\n          </Link>\n        </div>\n      </section>\n\n      <footer className=\"py-12 px-4 md:px-8 border-t border-border\">\n        <div className=\"max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-6 h-6 rounded bg-primary flex items-center justify-center\">\n              <Zap className=\"w-4 h-4 text-primary-foreground\" />\n            </div>\n            <span className=\"font-semibold\">PromptForge</span>\n          </div>\n          <p className=\"text-sm text-muted-foreground\">\n            {t.landing.footer}\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":8019,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/pages/lora-studio.tsx":{"content":"import { useState, useCallback } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useI18n } from \"@/lib/i18n\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { LoraModel, LoraVersion, LoraDataset } from \"@shared/schema\";\nimport { \n  Cpu, Plus, Upload, Play, Layers, Settings, Zap, Lock, ChevronRight, \n  Image, X, CheckCircle, AlertCircle, FileImage\n} from \"lucide-react\";\n\ninterface LoraModelWithDetails extends LoraModel {\n  datasets?: LoraDataset[];\n  versions?: LoraVersion[];\n}\n\ninterface ActiveLoraResponse {\n  loraVersionId: string;\n  loraModelId: string;\n  weight: number;\n  targetPlatform?: string;\n  version?: LoraVersion;\n  model?: LoraModel;\n}\n\ninterface UploadUrlInfo {\n  filename: string;\n  uploadUrl: string;\n  storageKey: string;\n}\n\ninterface FileWithPreview {\n  file: File;\n  preview: string;\n  status: \"pending\" | \"uploading\" | \"done\" | \"error\";\n  progress: number;\n  sha256?: string;\n  width?: number;\n  height?: number;\n  storageKey?: string;\n}\n\nconst TARGET_PLATFORMS = [\n  { id: \"sora_2_pro_max\", name: \"Sora 2 Pro Max\", supportsLora: false },\n  { id: \"sora_2_pro\", name: \"Sora 2 Pro\", supportsLora: false },\n  { id: \"sora_2\", name: \"Sora 2\", supportsLora: false },\n  { id: \"veo_3.1\", name: \"Veo 3.1\", supportsLora: false },\n  { id: \"veo_3.1_fast\", name: \"Veo 3.1 Fast\", supportsLora: false },\n  { id: \"grok_3\", name: \"Grok 3\", supportsLora: false },\n  { id: \"flux_dev\", name: \"Flux Dev\", supportsLora: true },\n  { id: \"flux_schnell\", name: \"Flux Schnell\", supportsLora: true },\n  { id: \"sdxl_1.0\", name: \"SDXL 1.0\", supportsLora: true },\n];\n\nconst TRAINABLE_BASE_MODELS = [\n  { id: \"flux_dev\", name: \"Flux Dev\", format: \"safetensors\" },\n  { id: \"flux_schnell\", name: \"Flux Schnell\", format: \"safetensors\" },\n  { id: \"sdxl_1.0\", name: \"SDXL 1.0\", format: \"safetensors\" },\n  { id: \"sd_1.5\", name: \"Stable Diffusion 1.5\", format: \"safetensors\" },\n];\n\nasync function computeSha256(file: File): Promise<string> {\n  const buffer = await file.arrayBuffer();\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\nasync function getImageDimensions(file: File): Promise<{ width: number; height: number }> {\n  return new Promise((resolve, reject) => {\n    const img = new window.Image();\n    img.onload = () => {\n      resolve({ width: img.width, height: img.height });\n      URL.revokeObjectURL(img.src);\n    };\n    img.onerror = reject;\n    img.src = URL.createObjectURL(file);\n  });\n}\n\nexport default function LoraStudioPage() {\n  const { toast } = useToast();\n  const { t } = useI18n();\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const [selectedModel, setSelectedModel] = useState<string | null>(null);\n  const [newModelName, setNewModelName] = useState(\"\");\n  const [newModelDesc, setNewModelDesc] = useState(\"\");\n  const [consentGiven, setConsentGiven] = useState(false);\n  \n  const [targetPlatform, setTargetPlatform] = useState(\"\");\n  const [trainableBaseModel, setTrainableBaseModel] = useState(\"\");\n  const [trainingSteps, setTrainingSteps] = useState(1000);\n  const [learningRate, setLearningRate] = useState(0.0001);\n  const [resolution, setResolution] = useState(1024);\n  const [rank, setRank] = useState(32);\n  const [activationWeight, setActivationWeight] = useState([0.8]);\n  \n  const [files, setFiles] = useState<FileWithPreview[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [currentDatasetId, setCurrentDatasetId] = useState<string | null>(null);\n\n  const { data: models, isLoading: loadingModels } = useQuery<LoraModel[]>({\n    queryKey: [\"/api/lora/models\"],\n  });\n\n  const { data: activeLora } = useQuery<ActiveLoraResponse | null>({\n    queryKey: [\"/api/lora/active\"],\n  });\n\n  const { data: modelDetails, isLoading: loadingDetails } = useQuery<LoraModelWithDetails>({\n    queryKey: [\"/api/lora/models\", selectedModel],\n    enabled: !!selectedModel,\n  });\n\n  const createModelMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/lora/models\", {\n        name: newModelName,\n        description: newModelDesc || undefined,\n        consent: consentGiven,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: t.loraStudio.modelCreated });\n      queryClient.invalidateQueries({ queryKey: [\"/api/lora/models\"] });\n      setShowCreateDialog(false);\n      setNewModelName(\"\");\n      setNewModelDesc(\"\");\n      setConsentGiven(false);\n    },\n    onError: (error: Error) => {\n      toast({ title: t.loraStudio.errorCreating, description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const validateDatasetMutation = useMutation({\n    mutationFn: async (datasetId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/lora/dataset/validate\", { datasetId });\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: t.loraStudio.validated });\n      queryClient.invalidateQueries({ queryKey: [\"/api/lora/models\", selectedModel] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Validation failed\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const startTrainingMutation = useMutation({\n    mutationFn: async (datasetId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/lora/jobs\", {\n        loraModelId: selectedModel,\n        datasetId,\n        baseModel: trainableBaseModel,\n        params: {\n          steps: trainingSteps,\n          learningRate,\n          resolution,\n          rank,\n        },\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: t.loraStudio.trainingStarted });\n      queryClient.invalidateQueries({ queryKey: [\"/api/lora/models\", selectedModel] });\n    },\n    onError: (error: Error) => {\n      toast({ title: t.loraStudio.errorTraining, description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const activateLoraMutation = useMutation({\n    mutationFn: async (versionId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/lora/activate\", {\n        loraVersionId: versionId,\n        weight: activationWeight[0],\n        targetPlatform: targetPlatform || undefined,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: t.loraStudio.loraActivated });\n      queryClient.invalidateQueries({ queryKey: [\"/api/lora/active\"] });\n    },\n  });\n\n  const deactivateLoraMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"DELETE\", \"/api/lora/active\", {});\n    },\n    onSuccess: () => {\n      toast({ title: t.loraStudio.loraDeactivated });\n      queryClient.invalidateQueries({ queryKey: [\"/api/lora/active\"] });\n    },\n  });\n\n  const handleFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    const droppedFiles = Array.from(e.dataTransfer.files).filter(\n      f => f.type.startsWith(\"image/\")\n    );\n    addFiles(droppedFiles);\n  }, []);\n\n  const handleFilesSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      const selectedFiles = Array.from(e.target.files).filter(\n        f => f.type.startsWith(\"image/\")\n      );\n      addFiles(selectedFiles);\n    }\n  }, []);\n\n  const addFiles = (newFiles: File[]) => {\n    const fileObjects: FileWithPreview[] = newFiles.map(file => ({\n      file,\n      preview: URL.createObjectURL(file),\n      status: \"pending\" as const,\n      progress: 0,\n    }));\n    setFiles(prev => [...prev, ...fileObjects]);\n  };\n\n  const removeFile = (index: number) => {\n    setFiles(prev => {\n      const updated = [...prev];\n      URL.revokeObjectURL(updated[index].preview);\n      updated.splice(index, 1);\n      return updated;\n    });\n  };\n\n  const uploadDataset = async () => {\n    if (!selectedModel || files.length < 15) {\n      toast({ \n        title: \"Invalid dataset\", \n        description: \"Minimum 15 images required\", \n        variant: \"destructive\" \n      });\n      return;\n    }\n\n    setIsUploading(true);\n    setUploadProgress(0);\n\n    try {\n      const initRes = await apiRequest(\"POST\", \"/api/lora/dataset/init\", {\n        loraModelId: selectedModel,\n        imageCount: files.length,\n        filenames: files.map(f => f.file.name),\n      });\n      const initData = await initRes.json() as { datasetId: string; uploadUrls: UploadUrlInfo[] };\n      setCurrentDatasetId(initData.datasetId);\n\n      const updatedFiles = [...files];\n      const totalFiles = files.length;\n      let completedFiles = 0;\n\n      for (let i = 0; i < files.length; i++) {\n        const fileObj = updatedFiles[i];\n        const uploadInfo = initData.uploadUrls[i];\n\n        if (!uploadInfo) continue;\n\n        updatedFiles[i] = { ...fileObj, status: \"uploading\" };\n        setFiles([...updatedFiles]);\n\n        try {\n          const [sha256, dimensions] = await Promise.all([\n            computeSha256(fileObj.file),\n            getImageDimensions(fileObj.file),\n          ]);\n\n          await fetch(uploadInfo.uploadUrl, {\n            method: \"PUT\",\n            body: fileObj.file,\n            headers: { \"Content-Type\": fileObj.file.type },\n          });\n\n          updatedFiles[i] = {\n            ...fileObj,\n            status: \"done\",\n            progress: 100,\n            sha256,\n            width: dimensions.width,\n            height: dimensions.height,\n            storageKey: uploadInfo.storageKey,\n          };\n        } catch {\n          updatedFiles[i] = { ...fileObj, status: \"error\", progress: 0 };\n        }\n\n        completedFiles++;\n        setUploadProgress(Math.round((completedFiles / totalFiles) * 100));\n        setFiles([...updatedFiles]);\n      }\n\n      const successfulUploads = updatedFiles.filter(f => f.status === \"done\" && f.sha256 && f.storageKey);\n      \n      if (successfulUploads.length >= 15) {\n        await apiRequest(\"POST\", \"/api/lora/dataset/commit\", {\n          datasetId: initData.datasetId,\n          items: successfulUploads.map(f => ({\n            storageKey: f.storageKey!,\n            sha256: f.sha256!,\n            width: f.width!,\n            height: f.height!,\n            filename: f.file.name,\n          })),\n        });\n\n        toast({ title: \"Dataset uploaded successfully\" });\n        queryClient.invalidateQueries({ queryKey: [\"/api/lora/models\", selectedModel] });\n        setFiles([]);\n        setCurrentDatasetId(null);\n      } else {\n        toast({ \n          title: \"Upload incomplete\", \n          description: `Only ${successfulUploads.length} of ${files.length} files uploaded successfully. Minimum 15 required.`,\n          variant: \"destructive\" \n        });\n      }\n    } catch (error) {\n      toast({ \n        title: \"Upload failed\", \n        description: error instanceof Error ? error.message : \"Unknown error\",\n        variant: \"destructive\" \n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\" | \"outline\"> = {\n      pending: \"secondary\",\n      uploaded: \"outline\",\n      validated: \"default\",\n      invalid: \"destructive\",\n      processing: \"outline\",\n      completed: \"default\",\n      failed: \"destructive\",\n    };\n    const statusText: Record<string, string> = {\n      pending: t.loraStudio.pending,\n      uploaded: \"Uploaded\",\n      validated: t.loraStudio.validated,\n      invalid: t.loraStudio.invalid,\n      processing: t.loraStudio.training,\n      completed: t.loraStudio.completed,\n      failed: t.loraStudio.failed,\n    };\n    return <Badge variant={variants[status] || \"secondary\"}>{statusText[status] || status}</Badge>;\n  };\n\n  const isPro = true;\n  const canTrain = trainableBaseModel && files.length === 0;\n  const selectedPlatformSupportsLora = TARGET_PLATFORMS.find(p => p.id === targetPlatform)?.supportsLora;\n\n  if (!isPro) {\n    return (\n      <div className=\"min-h-screen pt-16\">\n        <div className=\"max-w-2xl mx-auto px-4 md:px-8 py-16 text-center\">\n          <div className=\"w-16 h-16 rounded-full bg-muted mx-auto mb-6 flex items-center justify-center\">\n            <Lock className=\"w-8 h-8 text-muted-foreground\" />\n          </div>\n          <h1 className=\"text-2xl font-semibold mb-2\" data-testid=\"text-pro-required\">{t.loraStudio.proRequired}</h1>\n          <p className=\"text-muted-foreground mb-6\">{t.loraStudio.proRequiredDesc}</p>\n          <Button data-testid=\"button-upgrade-pro\">{t.loraStudio.upgradePro}</Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen pt-16\">\n      <div className=\"max-w-7xl mx-auto px-4 md:px-8 py-8\">\n        <div className=\"flex flex-wrap items-center justify-between gap-4 mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-semibold mb-2\" data-testid=\"text-lora-title\">{t.loraStudio.title}</h1>\n            <p className=\"text-muted-foreground\">{t.loraStudio.subtitle}</p>\n          </div>\n          <Button onClick={() => setShowCreateDialog(true)} data-testid=\"button-create-model\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            {t.loraStudio.createModel}\n          </Button>\n        </div>\n\n        {activeLora && (\n          <Card className=\"mb-8 border-primary/50\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                <Zap className=\"w-4 h-4\" />\n                {t.loraStudio.activeLora}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                  <p className=\"font-medium\">{activeLora.model?.name || \"LoRA Model\"}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {t.loraStudio.weight}: {activeLora.weight}\n                    {activeLora.targetPlatform && ` | Platform: ${activeLora.targetPlatform}`}\n                  </p>\n                </div>\n                <Button \n                  variant=\"outline\" \n                  onClick={() => deactivateLoraMutation.mutate()}\n                  data-testid=\"button-deactivate-lora\"\n                >\n                  {t.loraStudio.deactivate}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"grid lg:grid-cols-[320px_1fr] gap-8\">\n          <aside>\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                  <Layers className=\"w-4 h-4\" />\n                  {t.loraStudio.myModels}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-0\">\n                {loadingModels ? (\n                  <div className=\"p-4 space-y-2\">\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                  </div>\n                ) : models && models.length > 0 ? (\n                  <ScrollArea className=\"h-[400px]\">\n                    <div className=\"p-2\">\n                      {models.map((model) => (\n                        <button\n                          key={model.id}\n                          onClick={() => setSelectedModel(model.id)}\n                          className={`w-full text-left p-3 rounded-md mb-1 transition-colors hover-elevate ${\n                            selectedModel === model.id ? \"bg-accent\" : \"\"\n                          }`}\n                          data-testid={`button-select-model-${model.id}`}\n                        >\n                          <div className=\"flex items-center justify-between gap-2\">\n                            <span className=\"font-medium truncate\">{model.name}</span>\n                            <ChevronRight className=\"w-4 h-4 text-muted-foreground shrink-0\" />\n                          </div>\n                          {model.description && (\n                            <p className=\"text-xs text-muted-foreground mt-1 truncate\">\n                              {model.description}\n                            </p>\n                          )}\n                        </button>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                ) : (\n                  <div className=\"p-6 text-center text-muted-foreground\">\n                    <Cpu className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                    <p className=\"text-sm\">{t.loraStudio.noModels}</p>\n                    <p className=\"text-xs mt-1\">{t.loraStudio.noModelsDesc}</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </aside>\n\n          <main>\n            {selectedModel && modelDetails ? (\n              <div className=\"space-y-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>{modelDetails.name}</CardTitle>\n                    {modelDetails.description && (\n                      <CardDescription>{modelDetails.description}</CardDescription>\n                    )}\n                  </CardHeader>\n                </Card>\n\n                <div className=\"grid sm:grid-cols-2 gap-4\">\n                  <Card>\n                    <CardHeader className=\"pb-3\">\n                      <CardTitle className=\"text-sm font-medium\">{t.loraStudio.targetPlatform}</CardTitle>\n                      <CardDescription className=\"text-xs\">\n                        {t.loraStudio.targetPlatformDesc}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <Select value={targetPlatform} onValueChange={setTargetPlatform}>\n                        <SelectTrigger data-testid=\"select-target-platform\">\n                          <SelectValue placeholder=\"Select platform...\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {TARGET_PLATFORMS.map((platform) => (\n                            <SelectItem key={platform.id} value={platform.id}>\n                              <div className=\"flex items-center gap-2\">\n                                {platform.name}\n                                {platform.supportsLora && (\n                                  <Badge variant=\"secondary\" className=\"text-xs\">LoRA</Badge>\n                                )}\n                              </div>\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      {targetPlatform && !selectedPlatformSupportsLora && (\n                        <p className=\"text-xs text-muted-foreground mt-2\">\n                          This platform uses Character Pack export instead of LoRA injection\n                        </p>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-3\">\n                      <CardTitle className=\"text-sm font-medium\">{t.loraStudio.trainableBaseModel}</CardTitle>\n                      <CardDescription className=\"text-xs\">\n                        {t.loraStudio.trainableBaseModelDesc}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <Select value={trainableBaseModel} onValueChange={setTrainableBaseModel}>\n                        <SelectTrigger data-testid=\"select-trainable-model\">\n                          <SelectValue placeholder=\"Select base model...\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {TRAINABLE_BASE_MODELS.map((model) => (\n                            <SelectItem key={model.id} value={model.id}>\n                              {model.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                      <Image className=\"w-4 h-4\" />\n                      {t.loraStudio.uploadDataset}\n                    </CardTitle>\n                    <CardDescription>\n                      Upload 15-50 images of your subject from different angles\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div\n                      onDragOver={(e) => e.preventDefault()}\n                      onDrop={handleFilesDrop}\n                      className=\"border-2 border-dashed border-border rounded-md p-8 text-center mb-4 transition-colors hover:border-primary/50\"\n                    >\n                      <Upload className=\"w-10 h-10 mx-auto mb-3 text-muted-foreground\" />\n                      <p className=\"text-sm text-muted-foreground mb-2\">\n                        Drag and drop images here, or click to select\n                      </p>\n                      <input\n                        type=\"file\"\n                        multiple\n                        accept=\"image/*\"\n                        onChange={handleFilesSelect}\n                        className=\"hidden\"\n                        id=\"file-upload\"\n                        data-testid=\"input-file-upload\"\n                      />\n                      <Button variant=\"outline\" asChild>\n                        <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\n                          Select Images\n                        </label>\n                      </Button>\n                    </div>\n\n                    {files.length > 0 && (\n                      <div className=\"space-y-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <p className=\"text-sm font-medium\">\n                            {files.length} image{files.length !== 1 ? 's' : ''} selected\n                            {files.length < 15 && (\n                              <span className=\"text-destructive ml-2\">\n                                (minimum 15 required)\n                              </span>\n                            )}\n                          </p>\n                          <Button\n                            onClick={uploadDataset}\n                            disabled={isUploading || files.length < 15}\n                            data-testid=\"button-upload-dataset\"\n                          >\n                            {isUploading ? `Uploading ${uploadProgress}%` : \"Upload Dataset\"}\n                          </Button>\n                        </div>\n\n                        {isUploading && (\n                          <Progress value={uploadProgress} className=\"h-2\" />\n                        )}\n\n                        <div className=\"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2\">\n                          {files.map((fileObj, index) => (\n                            <div key={index} className=\"relative group aspect-square\">\n                              <img\n                                src={fileObj.preview}\n                                alt={fileObj.file.name}\n                                className=\"w-full h-full object-cover rounded-md\"\n                              />\n                              <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-md flex items-center justify-center\">\n                                <button\n                                  onClick={() => removeFile(index)}\n                                  className=\"p-1 bg-white/20 rounded-full\"\n                                  disabled={isUploading}\n                                >\n                                  <X className=\"w-4 h-4 text-white\" />\n                                </button>\n                              </div>\n                              {fileObj.status === \"done\" && (\n                                <div className=\"absolute top-1 right-1\">\n                                  <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                                </div>\n                              )}\n                              {fileObj.status === \"error\" && (\n                                <div className=\"absolute top-1 right-1\">\n                                  <AlertCircle className=\"w-4 h-4 text-red-500\" />\n                                </div>\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n\n                    {modelDetails.datasets && modelDetails.datasets.length > 0 && (\n                      <div className=\"mt-6 pt-6 border-t\">\n                        <h4 className=\"text-sm font-medium mb-3\">Existing Datasets</h4>\n                        <div className=\"space-y-3\">\n                          {modelDetails.datasets.map((dataset) => (\n                            <div \n                              key={dataset.id} \n                              className=\"flex flex-wrap items-center justify-between gap-4 p-3 rounded-md bg-muted/50\"\n                            >\n                              <div className=\"flex items-center gap-3\">\n                                <FileImage className=\"w-5 h-5 text-muted-foreground\" />\n                                <div>\n                                  {getStatusBadge(dataset.status)}\n                                  <span className=\"text-sm ml-2\">\n                                    {dataset.imageCount} {t.loraStudio.imageCount}\n                                  </span>\n                                </div>\n                              </div>\n                              <div className=\"flex gap-2\">\n                                {dataset.status === \"uploaded\" && (\n                                  <Button \n                                    size=\"sm\" \n                                    variant=\"outline\"\n                                    onClick={() => validateDatasetMutation.mutate(dataset.id)}\n                                    disabled={validateDatasetMutation.isPending}\n                                    data-testid={`button-validate-dataset-${dataset.id}`}\n                                  >\n                                    Validate\n                                  </Button>\n                                )}\n                                {dataset.status === \"validated\" && (\n                                  <Button \n                                    size=\"sm\" \n                                    onClick={() => startTrainingMutation.mutate(dataset.id)}\n                                    disabled={!trainableBaseModel || startTrainingMutation.isPending}\n                                    data-testid={`button-train-dataset-${dataset.id}`}\n                                  >\n                                    <Play className=\"w-4 h-4 mr-1\" />\n                                    {t.loraStudio.startTraining}\n                                  </Button>\n                                )}\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                      <Settings className=\"w-4 h-4\" />\n                      {t.loraStudio.trainingParams}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid sm:grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label>{t.loraStudio.steps}: {trainingSteps}</Label>\n                        <Slider\n                          value={[trainingSteps]}\n                          onValueChange={(v) => setTrainingSteps(v[0])}\n                          min={500}\n                          max={3000}\n                          step={100}\n                          data-testid=\"slider-steps\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>{t.loraStudio.resolution}: {resolution}</Label>\n                        <Select value={String(resolution)} onValueChange={(v) => setResolution(Number(v))}>\n                          <SelectTrigger data-testid=\"select-resolution\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"512\">512px</SelectItem>\n                            <SelectItem value=\"768\">768px</SelectItem>\n                            <SelectItem value=\"1024\">1024px</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>{t.loraStudio.rank}: {rank}</Label>\n                        <Slider\n                          value={[rank]}\n                          onValueChange={(v) => setRank(v[0])}\n                          min={4}\n                          max={128}\n                          step={4}\n                          data-testid=\"slider-rank\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>Learning Rate: {learningRate}</Label>\n                        <Slider\n                          value={[learningRate * 10000]}\n                          onValueChange={(v) => setLearningRate(v[0] / 10000)}\n                          min={1}\n                          max={100}\n                          step={1}\n                          data-testid=\"slider-learning-rate\"\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium uppercase tracking-wide text-muted-foreground flex items-center gap-2\">\n                      <Cpu className=\"w-4 h-4\" />\n                      {t.loraStudio.versions}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {modelDetails.versions && modelDetails.versions.length > 0 ? (\n                      <div className=\"space-y-3\">\n                        {modelDetails.versions.map((version) => (\n                          <div \n                            key={version.id} \n                            className=\"flex flex-wrap items-center justify-between gap-4 p-3 rounded-md bg-muted/50\"\n                          >\n                            <div className=\"flex items-center gap-3\">\n                              <Badge variant=\"secondary\">{version.baseModel}</Badge>\n                              <span className=\"text-sm text-muted-foreground\">\n                                {(version.params as { steps?: number })?.steps || 0} steps\n                              </span>\n                              {version.artifactUrl ? (\n                                <Badge variant=\"default\" className=\"bg-green-600\">{t.loraStudio.completed}</Badge>\n                              ) : (\n                                <Badge variant=\"outline\" className=\"animate-pulse\">{t.loraStudio.training}</Badge>\n                              )}\n                            </div>\n                            {version.artifactUrl && (\n                              <div className=\"flex items-center gap-2\">\n                                <div className=\"w-32\">\n                                  <Slider\n                                    value={activationWeight}\n                                    onValueChange={setActivationWeight}\n                                    min={0}\n                                    max={1.5}\n                                    step={0.1}\n                                    data-testid={`slider-weight-${version.id}`}\n                                  />\n                                </div>\n                                <Button \n                                  size=\"sm\"\n                                  onClick={() => activateLoraMutation.mutate(version.id)}\n                                  disabled={activateLoraMutation.isPending}\n                                  data-testid={`button-activate-${version.id}`}\n                                >\n                                  <Zap className=\"w-4 h-4 mr-1\" />\n                                  {t.loraStudio.activate}\n                                </Button>\n                              </div>\n                            )}\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        <Cpu className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                        <p className=\"text-sm\">{t.loraStudio.noVersions}</p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            ) : (\n              <Card className=\"h-full flex items-center justify-center min-h-[400px]\">\n                <div className=\"text-center text-muted-foreground p-8\">\n                  <Cpu className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                  <p>{t.loraStudio.noModels}</p>\n                  <p className=\"text-sm mt-2\">{t.loraStudio.noModelsDesc}</p>\n                </div>\n              </Card>\n            )}\n          </main>\n        </div>\n      </div>\n\n      <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t.loraStudio.createModel}</DialogTitle>\n            <DialogDescription>{t.loraStudio.subtitle}</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"model-name\">{t.loraStudio.modelName}</Label>\n              <Input\n                id=\"model-name\"\n                value={newModelName}\n                onChange={(e) => setNewModelName(e.target.value)}\n                placeholder={t.loraStudio.modelNamePlaceholder}\n                data-testid=\"input-model-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"model-desc\">{t.loraStudio.description}</Label>\n              <Textarea\n                id=\"model-desc\"\n                value={newModelDesc}\n                onChange={(e) => setNewModelDesc(e.target.value)}\n                placeholder={t.loraStudio.descriptionPlaceholder}\n                data-testid=\"input-model-desc\"\n              />\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <Checkbox\n                id=\"consent\"\n                checked={consentGiven}\n                onCheckedChange={(checked) => setConsentGiven(checked === true)}\n                data-testid=\"checkbox-consent\"\n              />\n              <Label htmlFor=\"consent\" className=\"text-sm leading-relaxed cursor-pointer\">\n                {t.loraStudio.consent}\n              </Label>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowCreateDialog(false)}>\n              {t.common.cancel}\n            </Button>\n            <Button\n              onClick={() => createModelMutation.mutate()}\n              disabled={!newModelName || !consentGiven || createModelMutation.isPending}\n              data-testid=\"button-submit-create\"\n            >\n              {createModelMutation.isPending ? t.loraStudio.creating : t.loraStudio.create}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":37566,"size_tokens":null},"server/lib/storage-provider.ts":{"content":"import { createHmac, randomBytes } from \"crypto\";\nimport path from \"path\";\nimport fs from \"fs/promises\";\n\nexport interface StorageProvider {\n  getPresignedUploadUrl(key: string, expiresIn?: number): Promise<{ uploadUrl: string; publicUrl: string }>;\n  getPresignedDownloadUrl(key: string, expiresIn?: number): Promise<string>;\n  deleteObject(key: string): Promise<void>;\n}\n\nclass LocalStorageProvider implements StorageProvider {\n  private basePath: string;\n  private baseUrl: string;\n\n  constructor() {\n    this.basePath = path.join(process.cwd(), \"uploads\");\n    this.baseUrl = process.env.REPLIT_DEV_DOMAIN \n      ? `https://${process.env.REPLIT_DEV_DOMAIN}` \n      : \"http://localhost:5000\";\n  }\n\n  async ensureDir(filePath: string) {\n    const dir = path.dirname(filePath);\n    await fs.mkdir(dir, { recursive: true });\n  }\n\n  async getPresignedUploadUrl(key: string, _expiresIn?: number): Promise<{ uploadUrl: string; publicUrl: string }> {\n    const fullPath = path.join(this.basePath, key);\n    await this.ensureDir(fullPath);\n    \n    const token = randomBytes(16).toString(\"hex\");\n    const uploadUrl = `${this.baseUrl}/api/upload/${encodeURIComponent(key)}?token=${token}`;\n    const publicUrl = `${this.baseUrl}/uploads/${key}`;\n    \n    return { uploadUrl, publicUrl };\n  }\n\n  async getPresignedDownloadUrl(key: string, _expiresIn?: number): Promise<string> {\n    return `${this.baseUrl}/uploads/${key}`;\n  }\n\n  async deleteObject(key: string): Promise<void> {\n    const fullPath = path.join(this.basePath, key);\n    try {\n      await fs.unlink(fullPath);\n    } catch (error) {\n      console.warn(`Failed to delete ${key}:`, error);\n    }\n  }\n}\n\nclass S3StorageProvider implements StorageProvider {\n  private bucket: string;\n  private region: string;\n  private accessKey: string;\n  private secretKey: string;\n\n  constructor() {\n    this.bucket = process.env.STORAGE_BUCKET || \"\";\n    this.region = process.env.STORAGE_REGION || \"us-east-1\";\n    this.accessKey = process.env.STORAGE_ACCESS_KEY || \"\";\n    this.secretKey = process.env.STORAGE_SECRET_KEY || \"\";\n  }\n\n  async getPresignedUploadUrl(key: string, expiresIn = 3600): Promise<{ uploadUrl: string; publicUrl: string }> {\n    const uploadUrl = await this.generatePresignedUrl(key, \"PUT\", expiresIn);\n    const publicUrl = `https://${this.bucket}.s3.${this.region}.amazonaws.com/${key}`;\n    return { uploadUrl, publicUrl };\n  }\n\n  async getPresignedDownloadUrl(key: string, expiresIn = 3600): Promise<string> {\n    return this.generatePresignedUrl(key, \"GET\", expiresIn);\n  }\n\n  async deleteObject(key: string): Promise<void> {\n    console.log(`S3 delete not fully implemented: ${key}`);\n  }\n\n  private async generatePresignedUrl(key: string, method: string, expiresIn: number): Promise<string> {\n    const now = new Date();\n    const dateStamp = now.toISOString().slice(0, 10).replace(/-/g, \"\");\n    const amzDate = dateStamp + \"T\" + now.toISOString().slice(11, 19).replace(/:/g, \"\") + \"Z\";\n    \n    const credential = `${this.accessKey}/${dateStamp}/${this.region}/s3/aws4_request`;\n    \n    const queryParams = new URLSearchParams({\n      \"X-Amz-Algorithm\": \"AWS4-HMAC-SHA256\",\n      \"X-Amz-Credential\": credential,\n      \"X-Amz-Date\": amzDate,\n      \"X-Amz-Expires\": String(expiresIn),\n      \"X-Amz-SignedHeaders\": \"host\",\n    });\n\n    const host = `${this.bucket}.s3.${this.region}.amazonaws.com`;\n    const canonicalUri = `/${key}`;\n    const canonicalQueryString = queryParams.toString();\n    const canonicalHeaders = `host:${host}\\n`;\n    const signedHeaders = \"host\";\n    const payloadHash = \"UNSIGNED-PAYLOAD\";\n\n    const canonicalRequest = [\n      method,\n      canonicalUri,\n      canonicalQueryString,\n      canonicalHeaders,\n      signedHeaders,\n      payloadHash,\n    ].join(\"\\n\");\n\n    const hashedCanonicalRequest = createHmac(\"sha256\", canonicalRequest).digest(\"hex\");\n    const stringToSign = [\n      \"AWS4-HMAC-SHA256\",\n      amzDate,\n      `${dateStamp}/${this.region}/s3/aws4_request`,\n      hashedCanonicalRequest,\n    ].join(\"\\n\");\n\n    const signingKey = this.getSignatureKey(this.secretKey, dateStamp, this.region, \"s3\");\n    const signature = createHmac(\"sha256\", signingKey).update(stringToSign).digest(\"hex\");\n\n    queryParams.set(\"X-Amz-Signature\", signature);\n    \n    return `https://${host}${canonicalUri}?${queryParams.toString()}`;\n  }\n\n  private getSignatureKey(key: string, dateStamp: string, region: string, service: string): Buffer {\n    const kDate = createHmac(\"sha256\", `AWS4${key}`).update(dateStamp).digest();\n    const kRegion = createHmac(\"sha256\", kDate).update(region).digest();\n    const kService = createHmac(\"sha256\", kRegion).update(service).digest();\n    const kSigning = createHmac(\"sha256\", kService).update(\"aws4_request\").digest();\n    return kSigning;\n  }\n}\n\nexport function getStorageProvider(): StorageProvider {\n  const provider = process.env.STORAGE_PROVIDER || \"local\";\n  \n  switch (provider) {\n    case \"s3\":\n    case \"r2\":\n      return new S3StorageProvider();\n    case \"local\":\n    default:\n      return new LocalStorageProvider();\n  }\n}\n\nexport const storageProvider = getStorageProvider();\n","path":null,"size_bytes":5127,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/header.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/components/theme-provider\";\nimport { useI18n, LanguageToggle } from \"@/lib/i18n\";\nimport { Moon, Sun, Zap, Menu, X } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport function Header() {\n  const { theme, toggleTheme } = useTheme();\n  const { t } = useI18n();\n  const [location] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n\n  const navItems = [\n    { href: \"/\", label: t.nav.home },\n    { href: \"/studio\", label: t.nav.studio },\n    { href: \"/library\", label: t.nav.library },\n    { href: \"/history\", label: t.nav.history },\n    { href: \"/lora-studio\", label: t.nav.loraStudio },\n    { href: \"/image-studio\", label: t.nav.imageStudio },\n  ];\n\n  return (\n    <header className=\"fixed top-0 left-0 right-0 z-50 h-16 border-b border-border bg-background/80 backdrop-blur-md\">\n      <div className=\"max-w-7xl mx-auto h-full px-4 md:px-8 flex items-center justify-between gap-4\">\n        <Link href=\"/\" className=\"flex items-center gap-2 shrink-0\" data-testid=\"link-home-logo\">\n          <div className=\"w-8 h-8 rounded-lg bg-primary flex items-center justify-center\">\n            <Zap className=\"w-5 h-5 text-primary-foreground\" />\n          </div>\n          <span className=\"text-lg font-semibold\" data-testid=\"text-logo\">PromptForge</span>\n        </Link>\n\n        <nav className=\"hidden md:flex items-center gap-1\">\n          {navItems.map((item) => (\n            <Link key={item.href} href={item.href}>\n              <Button\n                variant={location === item.href ? \"secondary\" : \"ghost\"}\n                size=\"sm\"\n                data-testid={`link-nav-${item.label.toLowerCase()}`}\n              >\n                {item.label}\n              </Button>\n            </Link>\n          ))}\n        </nav>\n\n        <div className=\"flex items-center gap-2\">\n          <LanguageToggle />\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={toggleTheme}\n            data-testid=\"button-theme-toggle\"\n          >\n            {theme === \"dark\" ? <Sun className=\"w-4 h-4\" /> : <Moon className=\"w-4 h-4\" />}\n          </Button>\n\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            className=\"md:hidden\"\n            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n            data-testid=\"button-mobile-menu\"\n          >\n            {mobileMenuOpen ? <X className=\"w-5 h-5\" /> : <Menu className=\"w-5 h-5\" />}\n          </Button>\n        </div>\n      </div>\n\n      {mobileMenuOpen && (\n        <div className=\"md:hidden absolute top-16 left-0 right-0 bg-background border-b border-border p-4\">\n          <nav className=\"flex flex-col gap-2\">\n            {navItems.map((item) => (\n              <Link key={item.href} href={item.href}>\n                <Button\n                  variant={location === item.href ? \"secondary\" : \"ghost\"}\n                  className=\"w-full justify-start\"\n                  onClick={() => setMobileMenuOpen(false)}\n                  data-testid={`link-mobile-nav-${item.label.toLowerCase()}`}\n                >\n                  {item.label}\n                </Button>\n              </Link>\n            ))}\n          </nav>\n        </div>\n      )}\n    </header>\n  );\n}\n","path":null,"size_bytes":3333,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ninterface ThemeContextValue {\n  theme: Theme;\n  toggleTheme: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextValue | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"theme\");\n      if (stored === \"dark\" || stored === \"light\") return stored;\n      return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n    }\n    return \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    if (theme === \"dark\") {\n      root.classList.add(\"dark\");\n    } else {\n      root.classList.remove(\"dark\");\n    }\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"dark\" ? \"light\" : \"dark\"));\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1317,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { I18nProvider } from \"@/lib/i18n\";\nimport { Header } from \"@/components/header\";\nimport LandingPage from \"@/pages/landing\";\nimport StudioPage from \"@/pages/studio\";\nimport LibraryPage from \"@/pages/library\";\nimport HistoryPage from \"@/pages/history\";\nimport LoraStudioPage from \"@/pages/lora-studio\";\nimport ModelsLabStudioPage from \"@/pages/modelslab-studio\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={LandingPage} />\n      <Route path=\"/studio\" component={StudioPage} />\n      <Route path=\"/library\" component={LibraryPage} />\n      <Route path=\"/history\" component={HistoryPage} />\n      <Route path=\"/lora-studio\" component={LoraStudioPage} />\n      <Route path=\"/image-studio\" component={ModelsLabStudioPage} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <I18nProvider>\n          <TooltipProvider>\n            <Header />\n            <Router />\n            <Toaster />\n          </TooltipProvider>\n        </I18nProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":1532,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/blueprint-builder.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useI18n } from \"@/lib/i18n\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { PromptBlock, LlmProfile } from \"@shared/schema\";\nimport { Plus, X, GripVertical, Save, Loader2 } from \"lucide-react\";\n\ninterface UserBlueprintData {\n  id?: string;\n  name: string;\n  description: string;\n  category: string;\n  tags: string[];\n  blocks: string[];\n  constraints: string[];\n  compatibleProfiles: string[];\n}\n\ninterface BlueprintBuilderProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  editData?: UserBlueprintData | null;\n  onSuccess?: () => void;\n}\n\nconst CATEGORIES = [\n  { id: \"aesthetic\", label: \"Aesthetic\" },\n  { id: \"product\", label: \"Product\" },\n  { id: \"portrait\", label: \"Portrait\" },\n  { id: \"scene\", label: \"Scene\" },\n  { id: \"technical\", label: \"Technical\" },\n  { id: \"custom\", label: \"Custom\" },\n];\n\nexport function BlueprintBuilder({ open, onOpenChange, editData, onSuccess }: BlueprintBuilderProps) {\n  const { toast } = useToast();\n  const { t } = useI18n();\n\n  const [name, setName] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [category, setCategory] = useState(\"custom\");\n  const [selectedBlocks, setSelectedBlocks] = useState<string[]>([]);\n  const [tagInput, setTagInput] = useState(\"\");\n  const [tags, setTags] = useState<string[]>([]);\n  const [compatibleProfiles, setCompatibleProfiles] = useState<string[]>([]);\n\n  const { data: blocks, isLoading: loadingBlocks } = useQuery<PromptBlock[]>({\n    queryKey: [\"/api/blocks\"],\n  });\n\n  const { data: profiles } = useQuery<LlmProfile[]>({\n    queryKey: [\"/api/profiles\"],\n  });\n\n  useEffect(() => {\n    if (editData) {\n      setName(editData.name);\n      setDescription(editData.description || \"\");\n      setCategory(editData.category);\n      setSelectedBlocks(editData.blocks);\n      setTags(editData.tags || []);\n      setCompatibleProfiles(editData.compatibleProfiles || []);\n    } else {\n      setName(\"\");\n      setDescription(\"\");\n      setCategory(\"custom\");\n      setSelectedBlocks([]);\n      setTags([]);\n      setCompatibleProfiles([]);\n    }\n  }, [editData, open]);\n\n  const createMutation = useMutation({\n    mutationFn: async () => {\n      const endpoint = editData?.id \n        ? `/api/user-blueprints/${editData.id}` \n        : \"/api/user-blueprints\";\n      const method = editData?.id ? \"PATCH\" : \"POST\";\n      \n      const res = await apiRequest(method, endpoint, {\n        name,\n        description,\n        category,\n        blocks: selectedBlocks,\n        tags,\n        constraints: [],\n        compatibleProfiles,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ \n        title: editData?.id \n          ? (t.blueprintBuilder?.updated || \"Blueprint updated\") \n          : (t.blueprintBuilder?.created || \"Blueprint created\") \n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-blueprints\"] });\n      onOpenChange(false);\n      onSuccess?.();\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: t.blueprintBuilder?.error || \"Error\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const handleAddBlock = (blockKey: string) => {\n    if (!selectedBlocks.includes(blockKey)) {\n      setSelectedBlocks([...selectedBlocks, blockKey]);\n    }\n  };\n\n  const handleRemoveBlock = (blockKey: string) => {\n    setSelectedBlocks(selectedBlocks.filter(b => b !== blockKey));\n  };\n\n  const handleMoveBlock = (index: number, direction: \"up\" | \"down\") => {\n    const newBlocks = [...selectedBlocks];\n    const newIndex = direction === \"up\" ? index - 1 : index + 1;\n    if (newIndex >= 0 && newIndex < newBlocks.length) {\n      [newBlocks[index], newBlocks[newIndex]] = [newBlocks[newIndex], newBlocks[index]];\n      setSelectedBlocks(newBlocks);\n    }\n  };\n\n  const handleAddTag = () => {\n    if (tagInput.trim() && !tags.includes(tagInput.trim())) {\n      setTags([...tags, tagInput.trim()]);\n      setTagInput(\"\");\n    }\n  };\n\n  const handleRemoveTag = (tag: string) => {\n    setTags(tags.filter(t => t !== tag));\n  };\n\n  const handleToggleProfile = (profileId: string) => {\n    if (compatibleProfiles.includes(profileId)) {\n      setCompatibleProfiles(compatibleProfiles.filter(p => p !== profileId));\n    } else {\n      setCompatibleProfiles([...compatibleProfiles, profileId]);\n    }\n  };\n\n  const canSave = name.trim() && selectedBlocks.length > 0;\n\n  const getBlockByKey = (key: string) => blocks?.find(b => b.key === key);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <DialogHeader>\n          <DialogTitle data-testid=\"text-builder-title\">\n            {editData?.id \n              ? (t.blueprintBuilder?.editTitle || \"Edit Blueprint\") \n              : (t.blueprintBuilder?.createTitle || \"Create Blueprint\")}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden grid lg:grid-cols-2 gap-6\">\n          <div className=\"space-y-4 overflow-y-auto pr-2\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"bp-name\">{t.blueprintBuilder?.name || \"Name\"}</Label>\n              <Input\n                id=\"bp-name\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                placeholder={t.blueprintBuilder?.namePlaceholder || \"My Custom Blueprint\"}\n                data-testid=\"input-blueprint-name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"bp-description\">{t.blueprintBuilder?.description || \"Description\"}</Label>\n              <Textarea\n                id=\"bp-description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder={t.blueprintBuilder?.descriptionPlaceholder || \"Describe what this blueprint generates...\"}\n                className=\"min-h-20\"\n                data-testid=\"input-blueprint-description\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>{t.blueprintBuilder?.category || \"Category\"}</Label>\n              <Select value={category} onValueChange={setCategory}>\n                <SelectTrigger data-testid=\"select-blueprint-category\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {CATEGORIES.map(cat => (\n                    <SelectItem key={cat.id} value={cat.id}>\n                      {cat.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>{t.blueprintBuilder?.tags || \"Tags\"}</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  value={tagInput}\n                  onChange={(e) => setTagInput(e.target.value)}\n                  placeholder={t.blueprintBuilder?.tagPlaceholder || \"Add tag...\"}\n                  onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), handleAddTag())}\n                  data-testid=\"input-blueprint-tag\"\n                />\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  size=\"icon\" \n                  onClick={handleAddTag}\n                  data-testid=\"button-add-tag\"\n                >\n                  <Plus className=\"w-4 h-4\" />\n                </Button>\n              </div>\n              {tags.length > 0 && (\n                <div className=\"flex flex-wrap gap-1 mt-2\">\n                  {tags.map(tag => (\n                    <Badge key={tag} variant=\"secondary\" className=\"gap-1\">\n                      {tag}\n                      <button \n                        onClick={() => handleRemoveTag(tag)}\n                        className=\"hover:text-destructive\"\n                        data-testid={`button-remove-tag-${tag}`}\n                      >\n                        <X className=\"w-3 h-3\" />\n                      </button>\n                    </Badge>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>{t.blueprintBuilder?.compatibleProfiles || \"Compatible Profiles\"}</Label>\n              <div className=\"flex flex-wrap gap-2\">\n                {profiles?.map(profile => (\n                  <Button\n                    key={profile.id}\n                    type=\"button\"\n                    variant={compatibleProfiles.includes(profile.id) ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => handleToggleProfile(profile.id)}\n                    data-testid={`button-profile-compat-${profile.id}`}\n                  >\n                    {profile.name}\n                  </Button>\n                ))}\n              </div>\n              {compatibleProfiles.length === 0 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  {t.blueprintBuilder?.allProfilesHint || \"Leave empty to support all profiles\"}\n                </p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"space-y-4 overflow-hidden flex flex-col\">\n            <div className=\"flex-1 space-y-3 overflow-hidden\">\n              <Label>{t.blueprintBuilder?.selectedBlocks || \"Selected Blocks\"} ({selectedBlocks.length})</Label>\n              \n              {selectedBlocks.length === 0 ? (\n                <div className=\"p-4 rounded-lg border border-dashed text-center text-muted-foreground text-sm\">\n                  {t.blueprintBuilder?.noBlocksHint || \"Add blocks from below to define your blueprint structure\"}\n                </div>\n              ) : (\n                <ScrollArea className=\"h-[180px] border rounded-lg p-2\">\n                  <div className=\"space-y-1\">\n                    {selectedBlocks.map((blockKey, index) => {\n                      const block = getBlockByKey(blockKey);\n                      return (\n                        <div\n                          key={blockKey}\n                          className=\"flex items-center gap-2 p-2 rounded-lg bg-muted/50 border\"\n                        >\n                          <GripVertical className=\"w-4 h-4 text-muted-foreground cursor-grab\" />\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"font-medium text-sm truncate\">{block?.key || blockKey}</div>\n                          </div>\n                          <div className=\"flex gap-1\">\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6\"\n                              disabled={index === 0}\n                              onClick={() => handleMoveBlock(index, \"up\")}\n                              data-testid={`button-move-up-${blockKey}`}\n                            >\n                              <span className=\"sr-only\">Move up</span>\n                              <span className=\"text-xs\">&#9650;</span>\n                            </Button>\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6\"\n                              disabled={index === selectedBlocks.length - 1}\n                              onClick={() => handleMoveBlock(index, \"down\")}\n                              data-testid={`button-move-down-${blockKey}`}\n                            >\n                              <span className=\"sr-only\">Move down</span>\n                              <span className=\"text-xs\">&#9660;</span>\n                            </Button>\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6 text-destructive\"\n                              onClick={() => handleRemoveBlock(blockKey)}\n                              data-testid={`button-remove-block-${blockKey}`}\n                            >\n                              <X className=\"w-3 h-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </ScrollArea>\n              )}\n\n              <Label>{t.blueprintBuilder?.availableBlocks || \"Available Blocks\"}</Label>\n              {loadingBlocks ? (\n                <div className=\"text-sm text-muted-foreground\">{t.blueprintBuilder?.loading || \"Loading...\"}</div>\n              ) : (\n                <ScrollArea className=\"h-[200px] border rounded-lg p-2\">\n                  <div className=\"grid grid-cols-2 gap-1\">\n                    {blocks?.filter(b => !selectedBlocks.includes(b.key)).map(block => (\n                      <button\n                        key={block.id}\n                        type=\"button\"\n                        onClick={() => handleAddBlock(block.key)}\n                        className=\"text-left p-2 rounded-lg border hover-elevate active-elevate-2 transition-colors\"\n                        data-testid={`button-add-block-${block.key}`}\n                      >\n                        <div className=\"font-medium text-sm truncate\">{block.key}</div>\n                        <div className=\"text-xs text-muted-foreground truncate\">\n                          {typeof block.template === 'string' \n                            ? block.template.slice(0, 50) \n                            : JSON.stringify(block.template).slice(0, 50)}...\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </ScrollArea>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"mt-4 pt-4 border-t\">\n          <Button \n            variant=\"outline\" \n            onClick={() => onOpenChange(false)}\n            data-testid=\"button-cancel-blueprint\"\n          >\n            {t.blueprintBuilder?.cancel || \"Cancel\"}\n          </Button>\n          <Button\n            onClick={() => createMutation.mutate()}\n            disabled={!canSave || createMutation.isPending}\n            data-testid=\"button-save-blueprint\"\n          >\n            {createMutation.isPending ? (\n              <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n            ) : (\n              <Save className=\"w-4 h-4 mr-2\" />\n            )}\n            {editData?.id \n              ? (t.blueprintBuilder?.update || \"Update\") \n              : (t.blueprintBuilder?.save || \"Save Blueprint\")}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":15626,"size_tokens":null},"client/src/pages/modelslab-studio.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useI18n } from \"@/lib/i18n\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Loader2, ImagePlus, Sparkles, X, Download, ExternalLink, Upload, Clipboard } from \"lucide-react\";\n\ninterface ModelsLabResponse {\n  status: string;\n  generationTime?: number;\n  id?: number;\n  output?: string[];\n  fetch_result?: string;\n  eta?: number;\n  message?: string;\n}\n\ninterface UploadedImage {\n  id: string;\n  dataUrl: string;\n  name: string;\n}\n\nexport default function ModelsLabStudioPage() {\n  const { toast } = useToast();\n  const { t } = useI18n();\n  \n  const [prompt, setPrompt] = useState(\"\");\n  const [images, setImages] = useState<UploadedImage[]>([]);\n  const [aspectRatio, setAspectRatio] = useState(\"1:1\");\n  const [result, setResult] = useState<ModelsLabResponse | null>(null);\n  const [isPolling, setIsPolling] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n  \n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const dropZoneRef = useRef<HTMLDivElement>(null);\n\n  const processFile = useCallback(async (file: File): Promise<UploadedImage | null> => {\n    if (!file.type.startsWith('image/')) {\n      toast({\n        title: t.modelslab.error,\n        description: t.modelslab.invalidFileType || \"Invalid file type. Only images allowed.\",\n        variant: \"destructive\",\n      });\n      return null;\n    }\n\n    if (file.size > 10 * 1024 * 1024) {\n      toast({\n        title: t.modelslab.error,\n        description: t.modelslab.fileTooLarge || \"File too large. Max 10MB.\",\n        variant: \"destructive\",\n      });\n      return null;\n    }\n\n    return new Promise((resolve) => {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const dataUrl = e.target?.result as string;\n        resolve({\n          id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n          dataUrl,\n          name: file.name,\n        });\n      };\n      reader.onerror = () => resolve(null);\n      reader.readAsDataURL(file);\n    });\n  }, [toast, t]);\n\n  const addImages = useCallback(async (files: FileList | File[]) => {\n    const fileArray = Array.from(files);\n    const remainingSlots = 14 - images.length;\n    const filesToProcess = fileArray.slice(0, remainingSlots);\n\n    if (fileArray.length > remainingSlots) {\n      toast({\n        title: t.modelslab.warning || \"Warning\",\n        description: t.modelslab.maxImagesReached || `Only ${remainingSlots} more images can be added.`,\n      });\n    }\n\n    const newImages: UploadedImage[] = [];\n    for (const file of filesToProcess) {\n      const processed = await processFile(file);\n      if (processed) {\n        newImages.push(processed);\n      }\n    }\n\n    if (newImages.length > 0) {\n      setImages(prev => [...prev, ...newImages]);\n    }\n  }, [images.length, processFile, toast, t]);\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      addImages(e.target.files);\n      e.target.value = '';\n    }\n  };\n\n  const handlePaste = useCallback(async (e: ClipboardEvent) => {\n    const items = e.clipboardData?.items;\n    if (!items) return;\n\n    const imageFiles: File[] = [];\n    for (const item of Array.from(items)) {\n      if (item.type.startsWith('image/')) {\n        const file = item.getAsFile();\n        if (file) {\n          imageFiles.push(file);\n        }\n      }\n    }\n\n    if (imageFiles.length > 0) {\n      e.preventDefault();\n      addImages(imageFiles);\n    }\n  }, [addImages]);\n\n  useEffect(() => {\n    document.addEventListener('paste', handlePaste);\n    return () => document.removeEventListener('paste', handlePaste);\n  }, [handlePaste]);\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  };\n\n  const handleDrop = async (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n    \n    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n      addImages(e.dataTransfer.files);\n    }\n  };\n\n  const removeImage = (id: string) => {\n    setImages(prev => prev.filter(img => img.id !== id));\n  };\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      if (images.length === 0) {\n        throw new Error(t.modelslab.noImages);\n      }\n      \n      const imageUrls = images.map(img => img.dataUrl);\n      \n      const res = await apiRequest(\"POST\", \"/api/modelslab/generate\", {\n        prompt,\n        images: imageUrls,\n        aspectRatio,\n      });\n      return res.json() as Promise<ModelsLabResponse>;\n    },\n    onSuccess: async (data) => {\n      if (data.status === \"processing\" && data.fetch_result) {\n        setIsPolling(true);\n        pollForResult(data.fetch_result);\n      } else if (data.status === \"success\" && data.output) {\n        setResult(data);\n        toast({\n          title: t.modelslab.success,\n          description: t.modelslab.imageGenerated,\n        });\n      } else if (data.status === \"error\") {\n        toast({\n          title: t.modelslab.error,\n          description: data.message || t.modelslab.generationFailed,\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t.modelslab.error,\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const pollForResult = async (fetchUrl: string) => {\n    let attempts = 0;\n    const maxAttempts = 60;\n    \n    const poll = async () => {\n      try {\n        const res = await apiRequest(\"POST\", \"/api/modelslab/status\", { fetchUrl });\n        const data = await res.json() as ModelsLabResponse;\n        \n        if (data.status === \"success\" && data.output) {\n          setResult(data);\n          setIsPolling(false);\n          toast({\n            title: t.modelslab.success,\n            description: t.modelslab.imageGenerated,\n          });\n        } else if (data.status === \"processing\" && attempts < maxAttempts) {\n          attempts++;\n          setTimeout(poll, 5000);\n        } else if (data.status === \"processing\" && attempts >= maxAttempts) {\n          setIsPolling(false);\n          toast({\n            title: t.modelslab.error,\n            description: t.modelslab.timeout || \"Generation timed out. Please try again.\",\n            variant: \"destructive\",\n          });\n        } else if (data.status === \"error\") {\n          setIsPolling(false);\n          toast({\n            title: t.modelslab.error,\n            description: data.message || t.modelslab.generationFailed,\n            variant: \"destructive\",\n          });\n        }\n      } catch {\n        setIsPolling(false);\n        toast({\n          title: t.modelslab.error,\n          description: t.modelslab.pollingFailed,\n          variant: \"destructive\",\n        });\n      }\n    };\n    \n    poll();\n  };\n\n  const aspectRatios = [\n    \"1:1\", \"9:16\", \"2:3\", \"3:4\", \"4:5\", \"5:4\", \"4:3\", \"3:2\", \"16:9\", \"21:9\"\n  ];\n\n  const isGenerating = generateMutation.isPending || isPolling;\n\n  return (\n    <div className=\"min-h-screen bg-background pt-20 pb-12\">\n      <div className=\"max-w-6xl mx-auto px-4 md:px-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"text-modelslab-title\">\n            {t.modelslab.title}\n          </h1>\n          <p className=\"text-muted-foreground\" data-testid=\"text-modelslab-subtitle\">\n            {t.modelslab.subtitle}\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* Input Panel */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <ImagePlus className=\"w-5 h-5\" />\n                {t.modelslab.inputTitle}\n              </CardTitle>\n              <CardDescription>{t.modelslab.inputDescription}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {/* Image Upload Area */}\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <Label>{t.modelslab.referenceImages || \"Reference Images\"}</Label>\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    {images.length}/14\n                  </Badge>\n                </div>\n                \n                {/* Hidden file input */}\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  multiple\n                  onChange={handleFileSelect}\n                  className=\"hidden\"\n                  data-testid=\"input-file-upload\"\n                />\n                \n                {/* Drop zone / Upload area */}\n                <div\n                  ref={dropZoneRef}\n                  onDragOver={handleDragOver}\n                  onDragLeave={handleDragLeave}\n                  onDrop={handleDrop}\n                  onClick={() => images.length < 14 && fileInputRef.current?.click()}\n                  className={`\n                    border-2 border-dashed rounded-lg p-4 transition-colors cursor-pointer\n                    ${isDragging \n                      ? 'border-primary bg-primary/5' \n                      : 'border-muted-foreground/25 hover:border-primary/50'\n                    }\n                    ${images.length >= 14 ? 'opacity-50 cursor-not-allowed' : ''}\n                  `}\n                  data-testid=\"dropzone-images\"\n                >\n                  {images.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n                      <Upload className=\"w-10 h-10 text-muted-foreground mb-3\" />\n                      <p className=\"text-sm font-medium\">\n                        {t.modelslab.dropOrClick || \"Drop images here or click to upload\"}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n                        <Clipboard className=\"w-3 h-3\" />\n                        {t.modelslab.pasteHint || \"You can also paste images (Ctrl+V)\"}\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-3\">\n                      {/* Image thumbnails grid */}\n                      <div className=\"grid grid-cols-3 sm:grid-cols-4 gap-2\">\n                        {images.map((img) => (\n                          <div\n                            key={img.id}\n                            className=\"relative group aspect-square rounded-md overflow-hidden border bg-muted\"\n                            data-testid={`thumbnail-${img.id}`}\n                          >\n                            <img\n                              src={img.dataUrl}\n                              alt={img.name}\n                              className=\"w-full h-full object-cover\"\n                            />\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                removeImage(img.id);\n                              }}\n                              className=\"absolute top-1 right-1 p-1 rounded-full bg-background/80 opacity-0 group-hover:opacity-100 transition-opacity\"\n                              data-testid={`button-remove-${img.id}`}\n                            >\n                              <X className=\"w-3 h-3\" />\n                            </button>\n                          </div>\n                        ))}\n                        \n                        {/* Add more button in grid */}\n                        {images.length < 14 && (\n                          <div\n                            className=\"aspect-square rounded-md border-2 border-dashed border-muted-foreground/25 flex items-center justify-center hover:border-primary/50 transition-colors\"\n                          >\n                            <ImagePlus className=\"w-6 h-6 text-muted-foreground\" />\n                          </div>\n                        )}\n                      </div>\n                      \n                      <p className=\"text-xs text-muted-foreground text-center flex items-center justify-center gap-1\">\n                        <Clipboard className=\"w-3 h-3\" />\n                        {t.modelslab.pasteHint || \"Paste images with Ctrl+V\"}\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Prompt */}\n              <div className=\"space-y-2\">\n                <Label>{t.modelslab.prompt}</Label>\n                <Textarea\n                  value={prompt}\n                  onChange={(e) => setPrompt(e.target.value)}\n                  placeholder={t.modelslab.promptPlaceholder}\n                  rows={4}\n                  data-testid=\"textarea-prompt\"\n                />\n              </div>\n\n              {/* Aspect Ratio */}\n              <div className=\"space-y-2\">\n                <Label>{t.modelslab.aspectRatio}</Label>\n                <Select value={aspectRatio} onValueChange={setAspectRatio}>\n                  <SelectTrigger data-testid=\"select-aspect-ratio\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {aspectRatios.map((ratio) => (\n                      <SelectItem key={ratio} value={ratio}>\n                        {ratio}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Generate Button */}\n              <Button\n                onClick={() => generateMutation.mutate()}\n                disabled={isGenerating || !prompt.trim() || images.length === 0}\n                className=\"w-full\"\n                data-testid=\"button-generate\"\n              >\n                {isGenerating ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    {isPolling ? t.modelslab.processing : t.modelslab.generating}\n                  </>\n                ) : (\n                  <>\n                    <Sparkles className=\"w-4 h-4 mr-2\" />\n                    {t.modelslab.generate}\n                  </>\n                )}\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Output Panel */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Sparkles className=\"w-5 h-5\" />\n                {t.modelslab.outputTitle}\n              </CardTitle>\n              <CardDescription>{t.modelslab.outputDescription}</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {result?.output && result.output.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {result.output.map((imageUrl, index) => (\n                    <div key={index} className=\"relative group\">\n                      <img\n                        src={imageUrl}\n                        alt={`Generated ${index + 1}`}\n                        className=\"w-full rounded-lg border\"\n                        data-testid={`img-result-${index}`}\n                      />\n                      <div className=\"absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"secondary\"\n                          onClick={() => window.open(imageUrl, \"_blank\")}\n                          data-testid={`button-open-image-${index}`}\n                        >\n                          <ExternalLink className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"secondary\"\n                          onClick={() => {\n                            const link = document.createElement(\"a\");\n                            link.href = imageUrl;\n                            link.download = `modelslab-${Date.now()}.png`;\n                            link.click();\n                          }}\n                          data-testid={`button-download-image-${index}`}\n                        >\n                          <Download className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                  \n                  {result.generationTime && (\n                    <p className=\"text-sm text-muted-foreground text-center\">\n                      {t.modelslab.generatedIn} {result.generationTime.toFixed(2)}s\n                    </p>\n                  )}\n                </div>\n              ) : (\n                <div className=\"h-64 flex items-center justify-center border border-dashed rounded-lg\">\n                  <p className=\"text-muted-foreground text-center\">\n                    {isGenerating ? (\n                      <span className=\"flex items-center gap-2\">\n                        <Loader2 className=\"w-5 h-5 animate-spin\" />\n                        {t.modelslab.waitingResult}\n                      </span>\n                    ) : (\n                      t.modelslab.noResult\n                    )}\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Model Info */}\n        <Card className=\"mt-6\">\n          <CardHeader>\n            <CardTitle>{t.modelslab.aboutTitle}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n              <div>\n                <p className=\"text-muted-foreground\">{t.modelslab.resolution}</p>\n                <p className=\"font-medium\">Up to 4K</p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">{t.modelslab.maxImages}</p>\n                <p className=\"font-medium\">14 images</p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">{t.modelslab.consistency}</p>\n                <p className=\"font-medium\">95%+</p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">{t.modelslab.model}</p>\n                <p className=\"font-medium\">Nano Banana Pro</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":19119,"size_tokens":null}},"version":2}